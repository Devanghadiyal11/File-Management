import{r as e,a as s}from"./vendor-react-DJcYfsJ3.js";import{R as t,r as i,C as a,a as l,b as n,c as r,d as o,e as c,f as d,g as m,h,i as x,j as u,k as p,l as f,m as g,n as j,o as b,p as N,q as y,s as v,t as w,u as k,v as C,w as S,x as z,y as F}from"./vendor-ui-Dn4ZVKCE.js";import{S as P,A as _,U as I,a as D,F as $,b as T,E,D as A,c as L,T as U,V as O,M as W,I as B,d as M,C as R,X as J,e as H,P as G,f as V,R as K,H as q,u as Q,G as Y,g as X,h as Z,i as ee,B as se,j as te,L as ie,k as ae,l as le,m as ne,n as re,o as oe,p as ce,q as de,r as me,s as he,t as xe,v as ue}from"./vendor-utils-Da378Kep.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)}).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();var pe,fe,ge={exports:{}},je={};var be,Ne=(fe||(fe=1,ge.exports=function(){if(pe)return je;pe=1;var s=e(),t=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n={key:!0,ref:!0,__self:!0,__source:!0};function r(e,s,i){var r,o={},c=null,d=null;for(r in void 0!==i&&(c=""+i),void 0!==s.key&&(c=""+s.key),void 0!==s.ref&&(d=s.ref),s)a.call(s,r)&&!n.hasOwnProperty(r)&&(o[r]=s[r]);if(e&&e.defaultProps)for(r in s=e.defaultProps)void 0===o[r]&&(o[r]=s[r]);return{$$typeof:t,type:e,key:c,ref:d,props:o,_owner:l.current}}return je.Fragment=i,je.jsx=r,je.jsxs=r,je}()),ge.exports),ye={};var ve=function(){if(be)return ye;be=1;var e=s();return ye.createRoot=e.createRoot,ye.hydrateRoot=e.hydrateRoot,ye}();const we=[{key:"title",getter:e=>e.getTitle()},{key:"html",getter:e=>e.getHtmlContainer()},{key:"confirmButtonText",getter:e=>e.getConfirmButton()},{key:"denyButtonText",getter:e=>e.getDenyButton()},{key:"cancelButtonText",getter:e=>e.getCancelButton()},{key:"footer",getter:e=>e.getFooter()},{key:"closeButtonHtml",getter:e=>e.getCloseButton()},{key:"iconHtml",getter:e=>e.getIconContent()},{key:"loaderHtml",getter:e=>e.getLoader()}],ke=()=>{};const Ce=i.createContext(null),Se=({children:e})=>{const s=i.useMemo(()=>function(e){function s(e){const s={},i={},a=we.map(e=>e.key);return Object.entries(e).forEach(e=>{let[l,n]=e;a.includes(l)&&t.isValidElement(n)?(s[l]=n,i[l]=" "):i[l]=n}),[s,i]}function i(s,t){Object.entries(t).forEach(t=>{let[i,a]=t;const l=we.find(e=>e.key===i).getter(e),n=ve.createRoot(l);n.render(a),s.__roots.push(n)})}function a(e){e.__roots.forEach(e=>{e.unmount()}),e.__roots=[]}return class extends e{static argsToParams(s){if(t.isValidElement(s[0])||t.isValidElement(s[1])){const e={};return["title","html","icon"].forEach((t,i)=>{void 0!==s[i]&&(e[t]=s[i])}),e}return e.argsToParams(s)}_main(e,t){this.__roots=[],this.__params=Object.assign({},t,e);const[l,n]=s(this.__params),r=n.willOpen||ke,o=n.didOpen||ke,c=n.didDestroy||ke;return super._main(Object.assign({},n,{willOpen:e=>{i(this,l),r(e)},didOpen:e=>{setTimeout(()=>{o(e)})},didDestroy:e=>{c(e),a(this)}}))}update(e){Object.assign(this.__params,e),a(this);const[t,l]=s(this.__params);super.update(l),i(this,t)}}}(P),[]),a=i.useMemo(()=>s.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timerProgressBar:!0,didOpen:e=>{e.addEventListener("mouseenter",P.stopTimer),e.addEventListener("mouseleave",P.resumeTimer)}}),[s]),l=i.useCallback((e,{type:s="info",duration:t=4e3}={})=>{const i="error"===s?"error":"success"===s?"success":"warning"===s?"warning":"info",l="success"===s?Math.min(t,3e3):t;a.fire({icon:i,title:e,timer:l})},[a]),n=i.useCallback(()=>{},[]);return Ne.jsx(Ce.Provider,{value:{showToast:l,removeToast:n},children:e})},ze=({folder:e,onClick:s,onEdit:t,onDelete:i,isLocked:r,hasMembers:o,fileCount:c,folderSize:d,totalItems:m,subfolderCount:h,isUnlocked:x})=>{const u=o?Math.floor(10*Math.random())+1:0;return Ne.jsx(a,{className:"folder-card h-100 fade-in",role:"button",onClick:()=>s(e),children:Ne.jsxs(l,{className:"p-3",children:[Ne.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[Ne.jsxs("div",{className:"d-flex align-items-center gap-2",children:[Ne.jsx("div",{className:"storage-icon documents",children:Ne.jsx(_,{size:18})}),Ne.jsxs("div",{className:"flex-grow-1 min-width-0",children:[Ne.jsxs("h6",{className:"mb-0 fw-semibold text-truncate",children:[e.name,m>0&&Ne.jsxs("span",{className:"text-muted fw-normal ms-2",children:["(",m," item",1!==m?"s":"",")"]})]}),Ne.jsxs("div",{className:"d-flex flex-column",children:[(c>0||h>0)&&Ne.jsxs("small",{className:"text-muted",children:[c>0&&`${c} file${1!==c?"s":""}`,c>0&&h>0&&" • ",h>0&&`${h} folder${1!==h?"s":""}`]}),d>0&&Ne.jsxs("small",{className:"text-muted fw-semibold",style:{color:"#059669",fontSize:"0.8rem"},children:["📦 ",(p=d,p&&0!==p?p<1024?`${Math.round(p)} B`:p<1048576?`${(p/1024).toFixed(1)} KB`:p<1073741824?`${(p/1048576).toFixed(1)} MB`:`${(p/1073741824).toFixed(1)} GB`:"0 B")]})]})]})]}),r&&Ne.jsx(n,{color:"warning",className:"small",children:"Locked"})]}),u>0&&Ne.jsx("div",{className:"d-flex align-items-center justify-content-between",children:Ne.jsxs("div",{className:"d-flex align-items-center gap-1",children:[Ne.jsx("div",{className:"d-flex",style:{marginLeft:"-4px"},children:[...Array(Math.min(u,3))].map((e,s)=>Ne.jsx("div",{className:"rounded-circle bg-primary d-flex align-items-center justify-content-center text-white",style:{width:"24px",height:"24px",fontSize:"10px",marginLeft:s>0?"-4px":"0",zIndex:3-s,border:"2px solid white"},children:String.fromCharCode(65+s)},s))}),u>3&&Ne.jsxs("span",{className:"small text-muted ms-1",children:["+",u-3]})]})})]})});var p},Fe=({files:e=[]})=>{const s=(e=>{const s={documents:{count:0,size:0,icon:M,color:"#6B7280",bgColor:"#F3F4F6"},photos:{count:0,size:0,icon:B,color:"#3B82F6",bgColor:"#DBEAFE"},audio:{count:0,size:0,icon:W,color:"#10B981",bgColor:"#D1FAE5"},videos:{count:0,size:0,icon:O,color:"#F59E0B",bgColor:"#FEF3C7"}};return e.forEach(e=>{const t=e.type||"",i=e.size||0;t.startsWith("image/")?(s.photos.count++,s.photos.size+=i):t.startsWith("audio/")?(s.audio.count++,s.audio.size+=i):t.startsWith("video/")?(s.videos.count++,s.videos.size+=i):(s.documents.count++,s.documents.size+=i)}),s})(e);return Ne.jsx("div",{className:"row g-3 mb-4",children:Object.entries(s).map(([e,s],t)=>{const i=s.icon,n=(r=s.size)<1024?`${r} B`:r<1048576?`${(r/1024).toFixed(1)} KB`:r<1073741824?`${(r/1048576).toFixed(1)} MB`:`${(r/1073741824).toFixed(1)} GB`;var r;return Ne.jsx("div",{className:"col-md-3 col-sm-6",children:Ne.jsx(a,{className:"h-100 border-0 shadow-sm hover-lift hover-glow scale-in stagger-item",style:{animationDelay:150*t+"ms"},children:Ne.jsxs(l,{className:"p-4",children:[Ne.jsx("div",{className:"d-flex align-items-center justify-content-between mb-3",children:Ne.jsx("div",{className:"rounded-3 p-3 d-flex align-items-center justify-content-center",style:{backgroundColor:s.bgColor,width:"56px",height:"56px"},children:Ne.jsx(i,{size:24,style:{color:s.color}})})}),Ne.jsxs("div",{children:[Ne.jsxs("div",{className:"h5 fw-bold mb-1 counter-animate",style:{color:s.color},children:["Total ",n]}),Ne.jsx("div",{className:"text-capitalize fw-semibold mb-0 slide-up",children:e}),Ne.jsxs("small",{className:"text-muted fade-in",children:[s.count," files"]})]})]})})},e)})})},Pe=({files:e=[],onFileClick:s,onViewAll:t,onUpload:i,onFileDelete:n,onToggleFavorite:r,isFavorited:o})=>{const c=e.sort((e,s)=>new Date(s.uploadDate||s.createdAt)-new Date(e.uploadDate||e.createdAt)).slice(0,6),d=e=>{const s=e.type||"";return s.startsWith("image/")?Ne.jsx(B,{size:16,className:"text-primary"}):s.includes("pdf")?Ne.jsx(M,{size:16,className:"text-danger"}):s.includes("document")?Ne.jsx(M,{size:16,className:"text-primary"}):s.startsWith("video/")?Ne.jsx(O,{size:16,className:"text-warning"}):s.startsWith("audio/")?Ne.jsx(W,{size:16,className:"text-success"}):Ne.jsx(T,{size:16,className:"text-muted"})};return Ne.jsx(a,{className:"border-0 shadow-sm",children:Ne.jsxs(l,{className:"p-0",children:[Ne.jsx("div",{className:"p-4 border-bottom",children:Ne.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[Ne.jsx("h5",{className:"mb-0 fw-bold",children:"Recent Files"}),Ne.jsxs("div",{className:"d-flex align-items-center gap-2",children:[Ne.jsxs("button",{className:"btn btn-sm btn-primary hover-lift",onClick:i,title:"Upload Files",children:[Ne.jsx(I,{size:14,className:"me-1",style:{transition:"transform 0.2s ease"},onMouseEnter:e=>e.target.style.transform="rotate(10deg)",onMouseLeave:e=>e.target.style.transform="rotate(0deg)"}),"Upload"]}),Ne.jsx("button",{className:"btn btn-sm btn-outline-secondary",children:Ne.jsx(D,{size:14})}),Ne.jsx("button",{className:"btn btn-sm btn-outline-secondary",children:Ne.jsx($,{size:14})})]})]})}),Ne.jsx("div",{className:"p-4",children:Ne.jsx("div",{className:"row g-3",children:0===c.length?Ne.jsxs("div",{className:"col-12 text-center py-4 text-muted",children:[Ne.jsx(T,{size:32,className:"mb-2 opacity-50"}),Ne.jsx("div",{children:"No recent files"})]}):c.map((e,t)=>{return Ne.jsx("div",{className:"col-md-6 col-lg-4",children:Ne.jsx(a,{className:"border file-preview-card h-100 hover-lift hover-glow scale-in stagger-item",role:"button",onClick:()=>s&&s(e),style:{animationDelay:100*t+"ms"},children:Ne.jsxs(l,{className:"p-3",children:[Ne.jsx("div",{className:"rounded-2 mb-3 d-flex align-items-center justify-content-center position-relative",style:{height:"120px",backgroundColor:"#f8f9fa"},children:e.type?.startsWith("image/")&&e.url?Ne.jsx("img",{src:e.url,alt:e.name,className:"img-fluid rounded-2",style:{maxHeight:"100%",maxWidth:"100%",objectFit:"cover"}}):Ne.jsxs("div",{className:"text-center",children:[d(e),Ne.jsx("div",{className:"mt-2",children:Ne.jsx("small",{className:"text-muted text-uppercase",children:e.name?.split(".").pop()||"FILE"})})]})}),Ne.jsxs("div",{className:"mb-3",children:[Ne.jsx("div",{className:"fw-semibold text-truncate mb-1",title:e.name,children:e.name}),Ne.jsx("div",{className:"text-muted small",children:Ne.jsxs("span",{children:["Last Modified on ",(i=e.uploadDate||e.createdAt,i?new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(new Date(i)):"Unknown")]})})]}),Ne.jsxs("div",{className:"d-flex align-items-center justify-content-between border-top pt-3",children:[Ne.jsxs("div",{className:"d-flex gap-2",children:[Ne.jsx("button",{className:"btn btn-sm btn-outline-primary d-flex align-items-center gap-1",onClick:t=>{t.stopPropagation(),s&&s(e)},title:"Preview File",children:Ne.jsx(E,{size:14})}),Ne.jsx("button",{className:"btn btn-sm btn-outline-secondary d-flex align-items-center gap-1",onClick:e=>e.stopPropagation(),title:"Download File",children:Ne.jsx(A,{size:14})}),Ne.jsx("button",{className:"btn btn-sm d-flex align-items-center gap-1 "+(o&&o(e)?"btn-warning":"btn-outline-warning"),onClick:s=>{s.stopPropagation(),r&&r(e)},title:o&&o(e)?"Remove from Favorites":"Add to Favorites",children:Ne.jsx(L,{size:14,fill:o&&o(e)?"currentColor":"none"})}),Ne.jsx("button",{className:"btn btn-sm btn-outline-danger d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),n&&n(e)},title:"Delete File",children:Ne.jsx(U,{size:14})})]}),Ne.jsx("small",{className:"text-muted",children:e.size?`${(e.size/1048576).toFixed(1)} MB`:"0 MB"})]})]})})},e._id||e.id||t);var i})})})]})})},_e=({files:e=[]})=>{const s=e=>e<1073741824?`${(e/1048576).toFixed(1)} MB`:`${(e/1073741824).toFixed(1)} GB`,t=e.reduce((e,s)=>e+(s.size||0),0);const i=t/21474836480*100,r=e.reduce((e,s)=>{const t=s.type||"",i=s.size||0;return t.startsWith("video/")?e.video+=i:t.startsWith("audio/")?e.audio+=i:t.startsWith("image/")?e.photos+=i:e.documents+=i,e},{video:0,audio:0,photos:0,documents:0});return Ne.jsx(a,{className:"border-0 shadow-sm",children:Ne.jsxs(l,{className:"p-4",children:[Ne.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-4",children:[Ne.jsxs("div",{children:[Ne.jsx("h6",{className:"mb-1",children:"Storage Usage"}),Ne.jsx(n,{color:"success",className:"small",children:Ne.jsxs("div",{className:"d-flex align-items-center gap-1",children:[Ne.jsx("div",{className:"bg-success rounded-circle",style:{width:"6px",height:"6px"}}),"Live"]})})]}),Ne.jsxs("div",{className:"text-muted small",children:[i.toFixed(1),"% of 20GB used"]})]}),Ne.jsx("div",{className:"text-center mb-4",children:Ne.jsxs("div",{className:"position-relative d-inline-block",children:[Ne.jsxs("svg",{width:"200",height:"200",className:"donut-chart",children:[Ne.jsx("circle",{cx:"100",cy:"100",r:"70",fill:"none",stroke:"#f1f5f9",strokeWidth:"20"}),Ne.jsx("circle",{cx:"100",cy:"100",r:"70",fill:"none",stroke:"url(#gradient1)",strokeWidth:"20",strokeDasharray:`${2*Math.PI*70*(i/100)} ${2*Math.PI*70}`,strokeLinecap:"round",transform:"rotate(-90 100 100)"}),Ne.jsx("defs",{children:Ne.jsxs("linearGradient",{id:"gradient1",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[Ne.jsx("stop",{offset:"0%",stopColor:"var(--color-primary)"}),Ne.jsx("stop",{offset:"50%",stopColor:"var(--color-accent)"}),Ne.jsx("stop",{offset:"100%",stopColor:"#059669"})]})})]}),Ne.jsxs("div",{className:"position-absolute top-50 start-50 translate-middle text-center",children:[Ne.jsxs("div",{className:"h5 fw-bold mb-1",children:[i.toFixed(1),"%"]}),Ne.jsx("small",{className:"text-muted",children:"Used"}),Ne.jsx("div",{className:"mt-1",children:Ne.jsx("small",{className:"text-muted",children:s(t)})})]})]})}),Ne.jsxs("div",{className:"mb-4",children:[Ne.jsx("h6",{className:"fw-bold mb-3",children:"Overview"}),Ne.jsx("div",{className:"row g-2",children:[{label:"Videos",value:s(r.video),color:"var(--color-danger)"},{label:"Audio",value:s(r.audio),color:"var(--color-primary)"},{label:"Photos",value:s(r.photos),color:"var(--color-accent)"},{label:"Documents",value:s(r.documents),color:"var(--color-warning)"}].map((e,s)=>Ne.jsx("div",{className:"col-6",children:Ne.jsxs("div",{className:"d-flex align-items-center gap-2",children:[Ne.jsx("div",{className:"rounded-circle",style:{width:"12px",height:"12px",backgroundColor:e.color}}),Ne.jsxs("div",{className:"flex-grow-1 min-width-0",children:[Ne.jsx("small",{className:"text-muted",children:e.label}),Ne.jsx("div",{className:"fw-semibold small",children:e.value})]})]})},s))})]})]})})},Ie=({files:e=[]})=>{const s=e.sort((e,s)=>(s.size||0)-(e.size||0)).slice(0,5),t=e=>{const s=e.type||"";return s.startsWith("video/")?Ne.jsx(O,{size:16,className:"text-warning"}):s.startsWith("image/")?Ne.jsx(B,{size:16,className:"text-primary"}):s.startsWith("audio/")?Ne.jsx(W,{size:16,className:"text-success"}):Ne.jsx(M,{size:16,className:"text-muted"})};return Ne.jsx(a,{className:"border-0 shadow-sm",children:Ne.jsxs(l,{className:"p-0",children:[Ne.jsx("div",{className:"p-4 border-bottom",children:Ne.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[Ne.jsx("h6",{className:"mb-0 fw-bold",children:"Largest files"}),Ne.jsx("button",{className:"btn btn-sm btn-outline-secondary",children:Ne.jsx(D,{size:14})})]})}),Ne.jsx("div",{className:"p-4",children:0===s.length?Ne.jsxs("div",{className:"text-center py-4 text-muted",children:[Ne.jsx(T,{size:32,className:"mb-2 opacity-50"}),Ne.jsx("div",{children:"No files"})]}):Ne.jsx("div",{className:"d-flex flex-column gap-3",children:s.map((e,s)=>{return Ne.jsxs("div",{className:"d-flex align-items-center gap-3 p-2 rounded-2 hover-bg-light",role:"button",children:[t(e),Ne.jsx("div",{className:"flex-grow-1 min-width-0",children:Ne.jsx("div",{className:"fw-semibold text-truncate small",children:e.name})}),Ne.jsx("div",{className:"text-end",children:Ne.jsx("div",{className:"fw-semibold small",children:(i=e.size||0,i<1048576?`${Math.round(i/1024)} KB`:i<1073741824?`${Math.round(i/1048576)} MB`:`${(i/1073741824).toFixed(1)} GB`)})})]},e._id||e.id||s);var i})})})]})})},De=({user:e,onClose:s,onPhotoUpdate:t,showToast:a,token:l})=>{const[n,p]=i.useState(null),[f,g]=i.useState(e?.profilePhoto||null),[j,b]=i.useState(!1),[N,y]=i.useState(""),v=i.useRef(null),w="/api",k=i.useCallback(e=>{const s=e.target.files?.[0];if(!s)return;const t=[".jpg",".jpeg",".png",".gif",".webp",".bmp",".heic",".heif"],i=s.name.toLowerCase(),a=i.substring(i.lastIndexOf(".")),l=s.type&&["image/jpeg","image/jpg","image/png","image/gif","image/webp","image/bmp","image/heic","image/heif"].includes(s.type.toLowerCase()),n=t.includes(a);if(!l&&!n)return void y(`Please select a valid image file (${t.join(", ")})`);if(s.size>20971520)return void y("Image size must be less than 20MB");y(""),p(s);const r=new FileReader;r.onload=e=>{g(e.target.result)},r.readAsDataURL(s)},[]),C=i.useCallback(e=>{e.preventDefault(),e.stopPropagation();const s=e.dataTransfer.files;if(s.length>0){const e=s[0],t=["image/jpeg","image/jpg","image/png","image/gif","image/webp","image/bmp","image/heic","image/heif"],i=[".jpg",".jpeg",".png",".gif",".webp",".bmp",".heic",".heif"],a=e.name.toLowerCase(),l=a.substring(a.lastIndexOf(".")),n=e.type&&t.includes(e.type.toLowerCase()),r=i.includes(l);n||r?k({target:{files:[e]}}):y(`Please drop a valid image file (${i.join(", ")})`)}},[k]),S=e=>new Promise(s=>{const t=new FileReader;t.onload=e=>s(e.target.result),t.readAsDataURL(e)}),z=e=>new Promise(s=>{const t=document.createElement("canvas"),i=t.getContext("2d"),a=new Image;a.onload=()=>{const e=1024;let{width:l,height:n}=a;l>n?l>e&&(n=n*e/l,l=e):n>e&&(l=l*e/n,n=e);const r=window.devicePixelRatio||1;t.width=l*r,t.height=n*r,t.style.width=l+"px",t.style.height=n+"px",i.scale(r,r),i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(a,0,0,l,n),t.toBlob(s,"image/jpeg",.95)},a.src=URL.createObjectURL(e)});return Ne.jsxs(r,{visible:!0,onClose:s,alignment:"center",size:"lg",children:[Ne.jsx(o,{children:Ne.jsxs(c,{className:"d-flex align-items-center gap-2",children:[Ne.jsx(R,{size:20}),"Profile Photo"]})}),Ne.jsx(d,{children:Ne.jsxs("div",{className:"text-center",children:[Ne.jsx("div",{className:"mb-4",children:Ne.jsx("div",{className:"position-relative d-inline-block",children:f?Ne.jsxs("div",{className:"position-relative",children:[Ne.jsx("img",{src:f,alt:"Profile preview",className:"rounded-circle border",style:{width:"180px",height:"180px",objectFit:"cover",border:"3px solid var(--color-border-glass)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.1)",imageRendering:"high-quality"}}),n&&Ne.jsx("div",{className:"position-absolute top-0 end-0",children:Ne.jsx("button",{type:"button",className:"btn btn-sm btn-danger rounded-circle p-1",onClick:()=>{p(null),g(e?.profilePhoto||null),y(""),v.current&&(v.current.value="")},style:{width:"24px",height:"24px"},children:Ne.jsx(J,{size:12})})})]}):Ne.jsx("div",{className:"rounded-circle border d-flex align-items-center justify-content-center bg-light",style:{width:"180px",height:"180px",border:"3px solid var(--color-border-glass)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.1)"},children:Ne.jsx(H,{size:72,className:"text-muted"})})})}),Ne.jsxs("div",{className:"border-2 border-dashed rounded-3 p-4 mb-3 text-center",style:{borderColor:n?"var(--color-primary)":"var(--color-border)",backgroundColor:n?"rgba(102, 126, 234, 0.05)":"var(--color-bg-light)"},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:C,children:[Ne.jsx("input",{ref:v,type:"file",accept:"image/*,.heic,.heif",onChange:k,className:"d-none"}),Ne.jsx(I,{size:32,className:"text-muted mb-2"}),Ne.jsx("div",{className:"h6 mb-2",children:n?"New photo selected":"Choose a profile photo"}),Ne.jsx("div",{className:"text-muted small mb-3",children:"Drag and drop an image here, or click to browse"}),Ne.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>v.current?.click(),disabled:j,children:[Ne.jsx(I,{size:16,className:"me-1"}),"Browse Files"]}),Ne.jsx("div",{className:"text-muted small mt-2",children:"Supports JPG, JPEG, PNG, GIF, WebP, BMP, HEIC, HEIF. Max size 20MB."})]}),N&&Ne.jsx(m,{color:"danger",className:"py-2 text-start",children:N}),Ne.jsxs("div",{className:"d-flex gap-2 justify-content-center",children:[n&&Ne.jsx("button",{type:"button",className:"btn btn-success",onClick:async()=>{if(n||f){b(!0),y("");try{let r=f;if(n){const e=await z(n);r=await S(e)}try{const e=new FormData;if(n){const s=await z(n);e.append("profilePhoto",s)}const i=await fetch(`${w}/auth/profile-photo`,{method:"POST",headers:{Authorization:`Bearer ${l}`},body:e});if(i.ok){const e=await i.json();return t&&t(e.profilePhoto),a?.("Profile photo updated successfully!",{type:"success"}),void s()}}catch(i){}const o=`profilePhoto_${e?.email||e?.id||"default"}`;localStorage.setItem(o,r),t&&t(r),a?.("Profile photo updated successfully! (Stored locally)",{type:"success"}),s()}catch(r){y(r.message||"Failed to upload profile photo"),a?.(`Upload failed: ${r.message}`,{type:"error"})}finally{b(!1)}}else y("Please select an image first")},disabled:j,children:j?Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(h,{size:"sm",className:"me-1"}),"Uploading..."]}):Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(I,{size:16,className:"me-1"}),"Upload Photo"]})}),f&&e?.profilePhoto&&!n&&Ne.jsxs(Ne.Fragment,{children:[Ne.jsxs("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>v.current?.click(),disabled:j,children:[Ne.jsx(G,{size:16,className:"me-1"}),"Change Photo"]}),Ne.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:async()=>{b(!0),y("");try{try{if((await fetch(`${w}/auth/profile-photo`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}})).ok)return t&&t(null),a?.("Profile photo deleted successfully!",{type:"success"}),void s()}catch(i){}const n=`profilePhoto_${e?.email||e?.id||"default"}`;localStorage.removeItem(n),t&&t(null),a?.("Profile photo deleted successfully! (Removed locally)",{type:"success"}),s()}catch(n){y(n.message||"Failed to delete profile photo"),a?.(`Delete failed: ${n.message}`,{type:"error"})}finally{b(!1)}},disabled:j,children:j?Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(h,{size:"sm",className:"me-1"}),"Deleting..."]}):Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(U,{size:16,className:"me-1"}),"Delete Photo"]})})]})]}),Ne.jsx("div",{className:"text-muted small mt-3",children:"Your profile photo will be visible to other team members and in shared folders."})]})}),Ne.jsx(x,{children:Ne.jsx(u,{color:"secondary",variant:"outline",onClick:s,children:"Cancel"})})]})};class $e extends t.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,s){this.setState({error:e,errorInfo:s})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){if(this.state.hasError){const e=!1;return Ne.jsx("div",{className:"min-vh-100 d-flex align-items-center justify-content-center p-4",children:Ne.jsx(a,{className:"shadow-sm",style:{maxWidth:"500px",width:"100%"},children:Ne.jsxs(l,{className:"text-center p-4",children:[Ne.jsxs("div",{className:"mb-4",children:[Ne.jsx(V,{size:64,className:"text-warning mb-3"}),Ne.jsx("h3",{className:"text-danger mb-2",children:"Oops! Something went wrong"}),Ne.jsx("p",{className:"text-muted",children:"We encountered an unexpected error. This usually happens when there's a problem loading data or rendering the interface."})]}),e,Ne.jsxs("div",{className:"d-flex gap-2 justify-content-center",children:[Ne.jsxs(u,{color:"primary",onClick:this.handleReset,className:"d-flex align-items-center gap-2",children:[Ne.jsx(K,{size:16}),"Try Again"]}),Ne.jsxs(u,{color:"outline-secondary",onClick:()=>window.location.reload(),className:"d-flex align-items-center gap-2",children:[Ne.jsx(q,{size:16}),"Reload Page"]})]}),Ne.jsx("div",{className:"mt-4",children:Ne.jsx("small",{className:"text-muted",children:"If this problem persists, try refreshing the page or clearing your browser cache."})})]})})})}return this.props.children}}const Te=new class{constructor(){this.workers=new Map,this.workerPools=new Map,this.taskQueue=new Map,this.activeJobs=new Map,this.workerStats=new Map,this.cpuCores=navigator.hardwareConcurrency||4,this.workerConfigs={fileProcessor:{script:new URL("/assets/fileProcessor-FUSmGNhb.js",import.meta.url),poolSize:Math.min(this.cpuCores,4),maxRetries:3,timeout:3e4}},this.initialized=!1,this.initPromise=null}async initialize(){if(!this.initialized){if(this.initPromise)return this.initPromise;this.initPromise=this.doInitialize(),await this.initPromise,this.initialized=!0}}async doInitialize(){for(const[e,s]of Object.entries(this.workerConfigs))await this.createWorkerPool(e,s);this.startPerformanceMonitoring()}async createWorkerPool(e,s){const t=[],i={created:Date.now(),tasksCompleted:0,tasksErrored:0,totalProcessingTime:0,averageProcessingTime:0,activeWorkers:0};for(let a=0;a<s.poolSize;a++)try{const i={id:`${e}-${a}`,worker:new Worker(s.script,{type:"module",name:`${e}-${a}`}),busy:!1,tasksProcessed:0,errors:0,created:Date.now(),lastUsed:null};this.setupWorkerHandlers(i,e),t.push(i)}catch(error){}this.workerPools.set(e,t),this.workerStats.set(e,i),this.taskQueue.set(e,[])}setupWorkerHandlers(e,s){const{worker:t,id:i}=e;t.addEventListener("message",e=>{const{type:t,taskId:a,result:l,error:n,processingTime:r}=e.data;switch(t){case"result":case"task_complete":this.handleTaskComplete(i,s,a,l,r);break;case"error":case"task_error":this.handleTaskError(i,s,a,n,r)}}),t.addEventListener("error",t=>{this.handleWorkerError(e,s,t)}),t.addEventListener("messageerror",e=>{})}async executeTask(e,s,t,i={}){await this.initialize();const a=`${e}_${s}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l=i.timeout||this.workerConfigs[e]?.timeout||3e4;return new Promise((n,r)=>{const o={taskId:a,workerType:e,operation:s,data:t,options:i,resolve:n,reject:r,created:Date.now(),retries:0,maxRetries:this.workerConfigs[e]?.maxRetries||3};o.timeoutId=setTimeout(()=>{this.handleTaskTimeout(o)},l),this.activeJobs.set(a,o);if(!this.tryAssignTask(o)){(this.taskQueue.get(e)||[]).push(o)}})}tryAssignTask(e){const s=this.workerPools.get(e.workerType);if(!s)return!1;const t=s.find(e=>!e.busy);return!!t&&(this.assignTaskToWorker(e,t),!0)}assignTaskToWorker(e,s){s.busy=!0,s.lastUsed=Date.now(),s.currentTask=e.taskId;const t={type:e.operation,data:e.data,options:e.options,taskId:e.taskId};s.worker.postMessage(t)}handleTaskComplete(e,s,t,i,a){const l=this.activeJobs.get(t);l&&(l.timeoutId&&clearTimeout(l.timeoutId),this.updateWorkerStats(s,e,a,!1),this.markWorkerAvailable(s,e),l.resolve(i),this.activeJobs.delete(t),this.processNextTask(s))}handleTaskError(e,s,t,i,a){const l=this.activeJobs.get(t);if(l){if(this.updateWorkerStats(s,e,a,!0),this.markWorkerAvailable(s,e),l.retries<l.maxRetries){l.retries++;if(!this.tryAssignTask(l)){(this.taskQueue.get(s)||[]).unshift(l)}return}l.timeoutId&&clearTimeout(l.timeoutId),l.reject(new Error(`Task failed after ${l.maxRetries} retries: ${i}`)),this.activeJobs.delete(t),this.processNextTask(s)}}handleTaskTimeout(e){const s=this.workerPools.get(e.workerType);if(s){const t=s.find(s=>s.currentTask===e.taskId);t&&this.markWorkerAvailable(e.workerType,t.id)}if(e.retries<e.maxRetries){e.retries++;if(!this.tryAssignTask(e)){(this.taskQueue.get(e.workerType)||[]).unshift(e)}}else e.reject(new Error(`Task timed out after ${e.maxRetries} retries`)),this.activeJobs.delete(e.taskId)}markWorkerAvailable(e,s){const t=this.workerPools.get(e);if(!t)return;const i=t.find(e=>e.id===s);i&&(i.busy=!1,i.currentTask=null)}processNextTask(e){const s=this.taskQueue.get(e);if(!s||0===s.length)return;const t=s.shift();this.tryAssignTask(t)||s.unshift(t)}updateWorkerStats(e,s,t,i){const a=this.workerStats.get(e),l=this.workerPools.get(e);if(a&&l){i?a.tasksErrored++:(a.tasksCompleted++,a.totalProcessingTime+=t||0,a.averageProcessingTime=a.totalProcessingTime/a.tasksCompleted);const e=l.find(e=>e.id===s);e&&(i?e.errors++:e.tasksProcessed++)}}handleWorkerError(e,s,t){this.recreateWorker(e,s)}async recreateWorker(e,s){const t=this.workerConfigs[s],i=this.workerPools.get(s);if(t&&i)try{e.worker.terminate();const a=new Worker(t.script,{type:"module",name:e.id}),l={...e,worker:a,busy:!1,currentTask:null,created:Date.now()};this.setupWorkerHandlers(l,s);const n=i.findIndex(s=>s.id===e.id);-1!==n&&(i[n]=l)}catch(error){}}startPerformanceMonitoring(){setInterval(()=>{this.logPerformanceStats()},3e4)}logPerformanceStats(){for(const[e,s]of this.workerStats.entries()){const s=this.workerPools.get(e);s&&s.filter(e=>e.busy).length,this.taskQueue.get(e)}}getStats(){const e={};for(const[s,t]of this.workerStats.entries()){const i=this.workerPools.get(s),a=i?i.filter(e=>e.busy).length:0,l=this.taskQueue.get(s)?.length||0;e[s]={...t,activeWorkers:a,queueLength:l,totalWorkers:i?.length||0,successRate:t.tasksCompleted/(t.tasksCompleted+t.tasksErrored)||0}}return e}async processFile(e,s,t){return this.executeTask("fileProcessor","process_file",{file:s,operation:e,options:t},t)}destroy(){for(const e of this.activeJobs.values())e.timeoutId&&clearTimeout(e.timeoutId);for(const e of this.workerPools.values())for(const s of e)s.worker.terminate();this.workers.clear(),this.workerPools.clear(),this.taskQueue.clear(),this.activeJobs.clear(),this.workerStats.clear(),this.initialized=!1}};(()=>{const e=[];for(let s=0;s<localStorage.length;s++){const t=localStorage.key(s);t&&(t.includes("sfm_face_")||t.includes("face_descriptor")||t.includes("face_profile")||t.includes("face_mongodb"))&&e.push(t)}e.forEach(e=>{localStorage.removeItem(e)}),e.length})();const Ee=(e,s)=>(e=>btoa(`hashed_${e}_salted`))(e)===s,Ae=({onSignIn:e,onSignUp:s})=>{const[t,n]=i.useState(!1),[r,o]=i.useState(""),[c,d]=i.useState(""),[h,x]=i.useState(""),p=async()=>{if(r&&c)try{t?await s(r,c):await e(r,c)}catch(i){x(i.message)}};return Ne.jsx(C,{className:"min-vh-100 d-flex align-items-center justify-content-center py-4",children:Ne.jsx(b,{className:"w-100 justify-content-center",children:Ne.jsx(N,{xs:12,sm:10,md:8,lg:5,xl:4,children:Ne.jsxs(a,{className:"shadow-sm",children:[Ne.jsxs(y,{className:"text-center py-4",children:[Ne.jsx(S,{color:"primary",textColor:"white",children:"SFM"}),Ne.jsx("h3",{className:"mt-2 mb-0",children:"Secure File Manager"}),Ne.jsx("small",{className:"text-body-secondary",children:"Your files, protected and organized"})]}),Ne.jsx(l,{children:Ne.jsxs(z,{onSubmit:e=>{e.preventDefault(),p()},children:[Ne.jsxs("div",{className:"mb-3",children:[Ne.jsx("label",{className:"form-label",children:"Email"}),Ne.jsx(F,{type:"email",value:r,onChange:e=>o(e.target.value),onKeyDown:e=>"Enter"===e.key&&p(),required:!0,autoFocus:!0})]}),Ne.jsxs("div",{className:"mb-3",children:[Ne.jsx("label",{className:"form-label",children:"Password"}),Ne.jsx(F,{type:"password",value:c,onChange:e=>d(e.target.value),onKeyDown:e=>"Enter"===e.key&&p(),required:!0})]}),h&&Ne.jsx(m,{color:"danger",className:"text-center py-2",children:h}),Ne.jsx(u,{color:"primary",className:"w-100 mt-2",size:"lg",onClick:p,children:t?"Sign Up":"Sign In"}),Ne.jsx("div",{className:"text-center mt-3",children:Ne.jsx(u,{color:"link",className:"text-decoration-none",onClick:()=>n(!t),children:t?"Already have an account? Sign In":"Don't have an account? Sign Up"})})]})})]})})})})},Le=({folder:e,onClose:s,onUnlock:t,user:a,token:l})=>{const[n,h]=i.useState(""),[p,f]=i.useState(0),[g,j]=i.useState(""),[b,N]=i.useState(!1),y=async()=>{if(4===n.length){N(!0),j("");try{const i=Ee(n,e.pinHash);if(l&&await fetch("/api/unlock-attempts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({folderId:e._id||e.id,success:i,method:"pin"})}).catch(()=>{}),i)t();else{const e=p+1;f(e),h(""),e>=5?(j("⛔ Too many failed attempts. Access blocked."),setTimeout(s,3e3)):j(`❌ Incorrect PIN. ${5-e} attempts remaining`)}}catch(i){j("❌ Unlock failed. Please try again.")}finally{N(!1)}}else j("⚠️ PIN must be exactly 4 digits")};return Ne.jsxs(r,{visible:!0,onClose:s,alignment:"center",children:[Ne.jsx(o,{children:Ne.jsxs(c,{children:['\\ud83d\\udd12 Unlock "',e.name,'"']})}),Ne.jsxs(d,{children:[Ne.jsxs("div",{className:"text-center mb-4",children:[Ne.jsx(ce,{size:48,className:"text-primary mb-2"}),Ne.jsx("h5",{className:"text-primary",children:"Secure Folder Access"}),Ne.jsx("p",{className:"text-muted small",children:"Enter your 4-digit PIN to access this protected folder"})]}),Ne.jsxs("div",{className:"mb-3",children:[Ne.jsxs("label",{className:"form-label fw-semibold d-flex align-items-center justify-content-center gap-2",children:["\\ud83d\\udd22 Enter 4-Digit PIN",Ne.jsxs("small",{className:"text-muted",children:["(",n.length,"/4)"]})]}),Ne.jsx(F,{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:n,onChange:e=>{const s=e.target.value.replace(/\D/g,"");s.length<=4&&(h(s),j(""))},onKeyDown:e=>"Enter"===e.key&&4===n.length&&y(),maxLength:4,placeholder:"0000",className:"text-center fs-4 fw-bold "+(4===n.length?"border-success":n.length>0?"border-warning":""),style:{letterSpacing:"0.5rem",fontFamily:"monospace"},autoFocus:!0,disabled:b}),Ne.jsx("div",{className:"d-flex justify-content-center gap-2 mt-2",children:[0,1,2,3].map(e=>Ne.jsx("div",{className:"rounded-circle "+(e<n.length?"bg-primary":"bg-light border"),style:{width:"12px",height:"12px"}},e))}),g&&Ne.jsx(m,{color:"danger",className:"mt-3 py-2 text-center",children:g})]}),Ne.jsx("div",{className:"d-grid",children:Ne.jsx(u,{color:"primary",size:"lg",onClick:y,disabled:4!==n.length||b,children:b?Ne.jsxs(Ne.Fragment,{children:[Ne.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Unlocking..."]}):Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(he,{size:16,className:"me-1"}),"Unlock Folder"]})})}),p>0&&Ne.jsx("div",{className:"text-center mt-3",children:Ne.jsxs("small",{className:"text-warning",children:["\\u26a0\\ufe0f ",p," failed attempt",p>1?"s":""," | ",5-p," remaining"]})})]}),Ne.jsx(x,{children:Ne.jsx(u,{color:"secondary",variant:"outline",onClick:s,children:"Cancel"})})]})},Ue=({file:e,onClose:s})=>{const i=e.type?.startsWith("image/"),a="application/pdf"===e.type,l=e.type?.startsWith("video/"),n=e.type?.startsWith("audio/"),m=e.type?.startsWith("text/")||["application/json","application/xml","application/xhtml+xml"].includes(e.type||""),h=e.url?.startsWith("http")?e.url:e.url||"",[p,f]=t.useState(null),[g,j]=t.useState(null);t.useEffect(()=>{let e=!1;return(async()=>{if(m)try{const s=await fetch(h);if(!s.ok)throw new Error(`HTTP ${s.status}`);const t=await s.text();if(!e){const e=204800;f(t.length>e?t.slice(0,e)+"\n\n…(truncated)…":t)}}catch(s){e||j(s.message)}})(),()=>{e=!0}},[h,m]);return Ne.jsxs(r,{visible:!0,onClose:s,size:"lg",fullscreen:"sm",children:[Ne.jsx(o,{children:Ne.jsx(c,{children:e.name})}),Ne.jsxs(d,{style:{maxHeight:"80vh",overflow:"auto"},children:[Ne.jsxs("div",{className:"d-flex gap-2 justify-content-end mb-3",children:[Ne.jsx(u,{color:"secondary",variant:"outline",size:"sm",onClick:()=>window.open(h,"_blank"),children:"Open"}),Ne.jsx(u,{color:"success",variant:"outline",size:"sm",onClick:()=>{const s=document.createElement("a");s.href=h,s.download=e.name||"download",document.body.appendChild(s),s.click(),document.body.removeChild(s)},children:"Download"}),Ne.jsx(u,{color:"primary",variant:"outline",size:"sm",onClick:async()=>{try{await navigator.clipboard.writeText(h)}catch(e){}},children:"Copy Link"})]}),i&&Ne.jsx("img",{src:h,alt:e.name,className:"img-fluid rounded",style:{width:"100%",height:"auto",maxHeight:"75vh",objectFit:"contain"}}),l&&Ne.jsx("video",{src:h,controls:!0,className:"w-100 rounded",style:{width:"100%",height:"auto",maxHeight:"75vh"}}),n&&Ne.jsx("audio",{src:h,controls:!0,className:"w-100"}),a&&Ne.jsx("iframe",{src:h,className:"w-100",style:{height:"75vh"},title:e.name}),m&&Ne.jsx("div",{className:"border rounded p-3 bg-light",style:{maxHeight:"75vh",overflow:"auto"},children:g?Ne.jsxs("div",{className:"text-danger",children:["Failed to load text: ",g]}):Ne.jsx("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",margin:0},children:p??"Loading…"})}),!i&&!l&&!n&&!a&&!m&&Ne.jsxs("div",{className:"text-center py-5 text-muted",children:[Ne.jsx(T,{size:64,className:"mb-3"}),Ne.jsx("div",{children:"Preview not available for this file type"})]})]}),Ne.jsx(x,{children:Ne.jsx(u,{color:"secondary",onClick:s,children:"Close"})})]})},Oe=({folder:e,onClose:s,onSave:t})=>{const[a,l]=i.useState(e?.name||""),[n,m]=i.useState(""),[h,p]=i.useState(!e?.locked),f=()=>{t({name:a,pin:n}),s()};return Ne.jsxs(r,{visible:!0,onClose:s,alignment:"center",children:[Ne.jsx(o,{children:Ne.jsx(c,{children:"Edit Folder"})}),Ne.jsxs(d,{children:[Ne.jsxs("div",{className:"mb-3",children:[Ne.jsx("label",{className:"form-label",children:"Folder Name"}),Ne.jsx(F,{type:"text",value:a,onChange:e=>l(e.target.value),onKeyDown:e=>"Enter"===e.key&&f(),autoFocus:!0})]}),Ne.jsxs("div",{className:"mb-2 form-check",children:[Ne.jsx("input",{id:"removePinChk",className:"form-check-input",type:"checkbox",checked:h,onChange:e=>p(e.target.checked)}),Ne.jsx("label",{className:"form-check-label",htmlFor:"removePinChk",children:"No PIN (unlocked)"})]}),!h&&Ne.jsxs("div",{children:[Ne.jsx("label",{className:"form-label",children:"New PIN (4 digits)"}),Ne.jsx(F,{type:"password",value:n,onChange:e=>m(e.target.value),onKeyDown:e=>"Enter"===e.key&&f(),placeholder:"••••",maxLength:4})]})]}),Ne.jsxs(x,{children:[Ne.jsx(u,{color:"secondary",variant:"outline",onClick:s,children:"Cancel"}),Ne.jsx(u,{color:"primary",onClick:f,children:"Save"})]})]})},We=({onClose:e,onCreate:s})=>{const[t,a]=i.useState(""),[l,n]=i.useState(""),[m,h]=i.useState(""),[p,f]=i.useState(!1),g=()=>p&&4!==l.length?(h("PIN must be exactly 4 digits"),!1):(h(""),!0),j=()=>{t.trim()&&(p&&!g()||(s(t,p?l:""),e()))},b=t.trim()&&(!p||p&&4===l.length);return Ne.jsxs(r,{visible:!0,onClose:e,alignment:"center",children:[Ne.jsx(o,{children:Ne.jsx(c,{children:"Create New Folder"})}),Ne.jsxs(d,{children:[Ne.jsxs("div",{className:"mb-3",children:[Ne.jsx("label",{className:"form-label",children:"Folder Name"}),Ne.jsx(F,{type:"text",value:t,onChange:e=>a(e.target.value),onKeyDown:e=>"Enter"===e.key&&j(),placeholder:"Enter folder name...",autoFocus:!0})]}),Ne.jsxs("div",{className:"mb-3",children:[Ne.jsxs("div",{className:"form-check",children:[Ne.jsx("input",{className:"form-check-input",type:"checkbox",id:"wantsLock",checked:p,onChange:e=>{f(e.target.checked),e.target.checked||(n(""),h(""))}}),Ne.jsx("label",{className:"form-check-label",htmlFor:"wantsLock",children:"🔒 Lock this folder with a PIN"})]}),Ne.jsx("small",{className:"text-muted",children:"Check this to require a 4-digit PIN to access this folder"})]}),p&&Ne.jsxs("div",{className:"fade-in",children:[Ne.jsx("label",{className:"form-label",children:"4-Digit PIN"}),Ne.jsxs("div",{className:"position-relative",children:[Ne.jsx(F,{type:"password",value:l,onChange:e=>{const s=e.target.value.replace(/\D/g,"");s.length<=4&&(n(s),h(""))},onKeyDown:e=>"Enter"===e.key&&j(),onBlur:g,placeholder:"Enter 4 digits...",maxLength:4,className:"pin-input "+(m?"is-invalid":4===l.length?"is-valid":""),style:{fontSize:"1.2rem",letterSpacing:"0.5rem",textAlign:"center",paddingRight:"2.5rem"}}),Ne.jsx("div",{className:"position-absolute",style:{right:"0.75rem",top:"50%",transform:"translateY(-50%)",pointerEvents:"none"},children:4===l.length?Ne.jsx(xe,{size:20,className:"text-success"}):p?Ne.jsx(ce,{size:20,className:"text-muted"}):null})]}),m&&Ne.jsxs("div",{className:"invalid-feedback d-block",children:[Ne.jsx(ue,{size:16,className:"me-1"}),m]}),Ne.jsx("div",{className:"form-text mt-2",children:Ne.jsxs("div",{className:"d-flex align-items-center gap-2",children:[Ne.jsx("span",{children:"PIN strength: "}),Ne.jsx("div",{className:"flex-grow-1",style:{maxWidth:"100px"},children:Ne.jsx("div",{className:"progress",style:{height:"4px"},children:Ne.jsx("div",{className:"progress-bar "+(0===l.length?"bg-light":l.length<4?"bg-warning":"bg-success"),style:{width:l.length/4*100+"%"}})})}),Ne.jsxs("small",{className:"text-muted",children:[l.length,"/4"]})]})})]})]}),Ne.jsxs(x,{children:[Ne.jsx(u,{color:"secondary",variant:"outline",onClick:e,children:"Cancel"}),Ne.jsx(u,{color:"primary",onClick:j,disabled:!b,children:"Create Folder"})]})]})};function Be({show:e,title:s,message:t,onCancel:i,onConfirm:a}){return Ne.jsxs(r,{visible:e,onClose:i,alignment:"center",children:[Ne.jsx(o,{children:Ne.jsx(c,{children:s||"Confirm"})}),Ne.jsx(d,{children:Ne.jsxs("div",{className:"d-flex align-items-start gap-2",children:[Ne.jsx(ue,{className:"text-danger flex-shrink-0"}),Ne.jsx("div",{children:t||"Are you sure?"})]})}),Ne.jsxs(x,{children:[Ne.jsx(u,{color:"secondary",variant:"outline",onClick:i,children:"Cancel"}),Ne.jsx(u,{color:"danger",onClick:a,children:"Delete"})]})]})}function Me({show:e,folder:s,contentsAnalysis:t,onCancel:i,onConfirm:a}){const l=e=>e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":e<1073741824?(e/1048576).toFixed(1)+" MB":(e/1073741824).toFixed(1)+" GB";if(!e||!s||!t)return null;const{fileCount:n,subfolderCount:h,totalSize:p,fileTypes:f,isEmpty:g}=t;return Ne.jsxs(r,{visible:e,onClose:i,alignment:"center",size:"lg",children:[Ne.jsx(o,{children:Ne.jsxs(c,{className:"text-danger",children:[Ne.jsx(ue,{size:20,className:"me-2"}),'Delete Folder "',s.name,'"']})}),Ne.jsx(d,{children:g?Ne.jsxs("div",{className:"text-center py-3",children:[Ne.jsx(X,{size:48,className:"text-muted mb-3 opacity-50"}),Ne.jsx("h5",{className:"fw-bold mb-2",children:"Delete Empty Folder?"}),Ne.jsx("p",{className:"text-muted mb-0",children:"This folder is empty and can be safely deleted."})]}):Ne.jsxs("div",{children:[Ne.jsxs("div",{className:"d-flex align-items-center gap-3 mb-4 p-3 bg-danger-subtle border border-danger-subtle rounded",children:[Ne.jsx(ue,{size:32,className:"text-danger flex-shrink-0"}),Ne.jsxs("div",{children:[Ne.jsx("h5",{className:"fw-bold mb-1 text-danger",children:"⚠️ Warning: This folder contains data!"}),Ne.jsxs("p",{className:"mb-0 text-danger-emphasis",children:["Deleting this folder will ",Ne.jsx("strong",{children:"permanently remove all its contents"}),". This action cannot be undone."]})]})]}),Ne.jsxs("div",{className:"mb-4",children:[Ne.jsx("h6",{className:"fw-bold mb-3",children:"📊 Folder Contents Summary:"}),Ne.jsxs("div",{className:"row g-3 mb-3",children:[n>0&&Ne.jsx("div",{className:"col-md-6",children:Ne.jsxs("div",{className:"d-flex align-items-center gap-2 p-2 bg-light rounded",children:[Ne.jsx(T,{size:20,className:"text-primary"}),Ne.jsxs("div",{children:[Ne.jsxs("div",{className:"fw-semibold",children:[n," File",1!==n?"s":""]}),Ne.jsx("small",{className:"text-muted",children:l(p)})]})]})}),h>0&&Ne.jsx("div",{className:"col-md-6",children:Ne.jsxs("div",{className:"d-flex align-items-center gap-2 p-2 bg-light rounded",children:[Ne.jsx(X,{size:20,className:"text-warning"}),Ne.jsxs("div",{children:[Ne.jsxs("div",{className:"fw-semibold",children:[h," Subfolder",1!==h?"s":""]}),Ne.jsx("small",{className:"text-muted",children:"May contain additional files"})]})]})})]}),n>0&&Ne.jsxs("div",{className:"mb-3",children:[Ne.jsx("h6",{className:"small fw-semibold mb-2",children:"📁 File Types:"}),Ne.jsx("div",{className:"p-2 bg-light rounded",children:Ne.jsx("small",{className:"text-muted",children:(e=>{const s=[];return e.images>0&&s.push(`${e.images} image${e.images>1?"s":""}`),e.documents>0&&s.push(`${e.documents} document${e.documents>1?"s":""}`),e.videos>0&&s.push(`${e.videos} video${e.videos>1?"s":""}`),e.audio>0&&s.push(`${e.audio} audio file${e.audio>1?"s":""}`),e.other>0&&s.push(`${e.other} other file${e.other>1?"s":""}`),s.join(", ")})(f)})})]})]}),Ne.jsx(m,{color:"danger",className:"mb-0",children:Ne.jsxs("div",{className:"d-flex align-items-start gap-2",children:[Ne.jsx(ue,{size:16,className:"flex-shrink-0 mt-1"}),Ne.jsxs("div",{children:[Ne.jsx("strong",{children:"Are you absolutely sure?"}),Ne.jsxs("div",{className:"mt-1",children:["This will delete:",Ne.jsxs("ul",{className:"mb-1 mt-1",children:[n>0&&Ne.jsxs("li",{children:[n," file",1!==n?"s":""," (",l(p),")"]}),h>0&&Ne.jsxs("li",{children:[h," subfolder",1!==h?"s":""," and all their contents"]})]}),Ne.jsx("strong",{children:"This action cannot be undone!"})]})]})]})})]})}),Ne.jsxs(x,{children:[Ne.jsx(u,{color:"secondary",variant:"outline",onClick:i,children:"Cancel"}),Ne.jsx(u,{color:"danger",onClick:a,children:g?"Delete Empty Folder":"Delete Folder & All Contents"})]})]})}function Re(){const{user:e,token:s,loading:r,signIn:o,signUp:c,signOut:d,updateUserProfile:m}=(()=>{const[e,s]=i.useState(null),[t,a]=i.useState(null),[l,n]=i.useState(!0);i.useEffect(()=>{const e=sessionStorage.getItem("sfm_user"),t=sessionStorage.getItem("sfm_token");if(e&&t){const i=JSON.parse(e),l=`profilePhoto_${i?.email||i?.id||"default"}`,n=localStorage.getItem(l);n&&!i.profilePhoto&&(i.profilePhoto=n),s(i),a(t)}n(!1)},[]);const r="/api/auth";return{user:e,token:t,loading:l,signIn:async(e,t)=>{const i=await fetch(`${r}/signin`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!i.ok){const e=await i.json().catch(()=>({}));throw new Error(e.error||"Sign in failed")}const l=await i.json();return sessionStorage.setItem("sfm_user",JSON.stringify(l.user)),sessionStorage.setItem("sfm_token",l.token),s(l.user),a(l.token),l.user},signUp:async(e,t)=>{const i=await fetch(`${r}/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!i.ok){const e=await i.json().catch(()=>({}));throw new Error(e.error||"Sign up failed")}const l=await i.json();return sessionStorage.setItem("sfm_user",JSON.stringify(l.user)),sessionStorage.setItem("sfm_token",l.token),s(l.user),a(l.token),l.user},signOut:()=>{s(null),a(null),sessionStorage.removeItem("sfm_user"),sessionStorage.removeItem("sfm_token")},updateUserProfile:t=>{const i={...e,...t};if(s(i),sessionStorage.setItem("sfm_user",JSON.stringify(i)),void 0!==t.profilePhoto){const e=`profilePhoto_${i?.email||i?.id||"default"}`;t.profilePhoto?localStorage.setItem(e,t.profilePhoto):localStorage.removeItem(e)}}}})(),[x,u]=i.useState([]),[C,S]=i.useState([]),[z,F]=i.useState([]),[P,_]=i.useState(null),[$,J]=i.useState(new Set),[G,V]=i.useState(null),[K,he]=i.useState(null),[xe,ue]=i.useState(!1),[pe,fe]=i.useState(null),[ge,je]=i.useState(!1),[be,ye]=i.useState(""),[ve,we]=i.useState("grid"),ke=(()=>{const e=i.useContext(Ce);if(!e)throw new Error("useToast must be used within ToastProvider");return e.showToast})(),[Se,Ee]=i.useState(!1),Re=i.useRef(null),[Je,He]=i.useState({show:!1,title:"",message:"",onConfirm:null}),[Ge,Ve]=i.useState(!1),[Ke,qe]=i.useState(0),[Qe,Ye]=i.useState(!1),[Xe,Ze]=i.useState(!1),[es,ss]=i.useState({show:!1,folder:null,contentsAnalysis:null}),[ts,is]=i.useState(!1),[as,ls]=i.useState([]),[ns,rs]=i.useState("dashboard"),os="/api";i.useCallback(()=>{if(e)try{const s=`sfm_favorites_${e?.id||e?.email||"anon"}`,t=localStorage.getItem(s);t&&ls(JSON.parse(t))}catch(s){ls([])}},[e]);const cs=i.useCallback(s=>{if(e)try{const t=`sfm_favorites_${e?.id||e?.email||"anon"}`;localStorage.setItem(t,JSON.stringify(s)),ls(s)}catch(t){}},[e]),ds=i.useCallback(e=>{const s=e._id||e.id,t=as.some(e=>(e._id||e.id)===s);let i;t?(i=as.filter(e=>(e._id||e.id)!==s),ke(`Removed "${e.name}" from favorites`,{type:"info"})):(i=[...as,{...e,favoritedAt:(new Date).toISOString()}],ke(`Added "${e.name}" to favorites`,{type:"success"})),cs(i),js(t?"FILE_UNFAVORITE":"FILE_FAVORITE",{fileName:e.name,fileId:s,fileType:e.type||"unknown"})},[as,cs,ke,js]),ms=i.useCallback(e=>{const s=e._id||e.id;return as.some(e=>(e._id||e.id)===s)},[as]),hs=i.useCallback(e=>{if(!e||!z||!x)return 0;try{let s=z.filter(s=>s&&String(s.folderId)===String(e)).reduce((e,s)=>e+(s.size||0),0);const t=x.filter(s=>s&&String(s.parentId)===String(e)),i=10;return t.length>0&&i>0&&t.forEach(t=>{t&&(t._id||t.id)!==e&&(s+=hs(t._id||t.id))}),s}catch(s){return 0}},[z,x]),{getRootProps:xs,getInputProps:us,isDragActive:ps}=Q({onDrop:e=>{(async e=>{if(!e||0===e.length)return;Ve(!0),Ee(!0),qe(0);const t=e.length,i=Array.from(e).map(e=>e.name).join(", ");try{ke(`Processing and uploading ${t} file${t>1?"s":""} using multicore processing...`,{type:"info"}),await Te.initialize();const a=[],l=[];let n=0;const r=()=>{n++;const e=Math.floor(n/t*50);qe(e)};for(const s of e){const e=(async()=>{try{const t=await Te.processFile("analyze",s,{timeout:15e3});let i=s;if(s.type.startsWith("image/")&&s.size>1048576)try{const e=await Te.processFile("compress",s,{quality:.8,format:"webp",timeout:3e4});i=new T([e],s.name.replace(/\.[^/.]+$/,".webp"),{type:"image/webp"})}catch(e){}return r(),{original:s,processed:i,analysis:t}}catch(t){return r(),{original:s,processed:s,analysis:null}}})();l.push(e)}const o=await Promise.all(l);a.push(...o),qe(50);const c=new FormData;for(const e of a)c.append("files",e.processed),e.analysis&&c.append(`analysis_${e.processed.name}`,JSON.stringify(e.analysis));c.append("folderId",P||"");const d=setInterval(()=>{qe(e=>{const s=e+2;return s>=95?95:s})},200),m=await fetch(`${os}/files/upload`,{method:"POST",headers:{Authorization:`Bearer ${s}`},body:c});if(clearInterval(d),qe(100),!m.ok){const e=await m.text();throw new Error(e||`Upload failed (${m.status})`)}const h=await m.json();F(e=>[...e,...h]);const x=Array.from(e).reduce((e,s)=>e+s.size,0),u=a.reduce((e,s)=>e+s.processed.size,0),p=x-u;await js("FILE_UPLOAD",{fileCount:t,fileNames:i,folderId:P||"root",folderName:vs?.name||"Root",originalSize:x,processedSize:u,compressionSavings:p,multicore:!0}),await bs();const f=p>0?` (saved ${Math.round(p/1024)}KB through optimization)`:"";ke(`Successfully uploaded: ${i}${f}`,{type:"success"})}catch(a){ke(`Upload failed: ${a.message}`,{type:"error"})}finally{Ve(!1),Ee(!1),qe(0)}})(e)},noClick:!0,noKeyboard:!0,multiple:!0}),fs=async(e,t={})=>{const i=t.headers||{};s&&(i.Authorization=`Bearer ${s}`),!t.body||t.body instanceof FormData||(i["Content-Type"]="application/json");const a=await fetch(`${os}${e}`,{...t,headers:i});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.error||`Request failed: ${a.status}`)}return a.json().catch(()=>({}))},gs=(e,s="file")=>{const t=JSON.parse(localStorage.getItem("sfm_trash_items")||"[]"),i=new Date(Date.now()-6048e5);return t.some(t=>{const a=t._id||t.id,l=new Date(t.deletedAt)>i,n=t.type===s;return String(a)===String(e)&&n&&l})},js=async(t,i={})=>{if(e&&s)try{const a={userId:e.id||e._id,userEmail:e.email,userName:e.name||e.username,action:t,details:i,timestamp:(new Date).toISOString(),sessionId:sessionStorage.getItem("sfm_session_id")||"unknown",userAgent:navigator.userAgent,ipAddress:"client-side"};await fetch(`${os}/activity-logs`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(a)}).catch(e=>{const s=JSON.parse(localStorage.getItem("sfm_activity_logs_backup")||"[]");s.push(a),s.length>100&&s.shift(),localStorage.setItem("sfm_activity_logs_backup",JSON.stringify(s))})}catch(a){}},bs=i.useCallback(async(t=!1)=>{if(e&&s){Ze(!0);try{t&&ke("Refreshing data...",{type:"info"});const e=P?`?parentId=${P}`:"",s=await fs(`/folders${e}`);u(s||[]);const i=P?`/files?folderId=${P}`:"/files",a=await fs(i);if(F(a||[]),!P){const e=await fs("/folders");S(e||[])}t&&ke("Data refreshed successfully",{type:"success"})}catch(i){t&&ke("Failed to refresh data",{type:"error"})}finally{Ze(!1)}}},[e,s,P,ke,fs]);i.useEffect(()=>{if(!e||!s)return;const t=setInterval(()=>{bs()},3e4);return()=>clearInterval(t)},[bs,e,s]),i.useEffect(()=>{e&&s&&(js("USER_LOGIN",{loginTime:(new Date).toISOString(),userAgent:navigator.userAgent}),(async()=>{try{const e=await fs("/folders");S(e||[])}catch(e){}})())},[e,s]),i.useEffect(()=>{if(!e||!s)return;if(ts)return;(async()=>{try{Ze(!0);const e=P?`?parentId=${P}`:"",s=await fs(`/folders${e}`);Array.isArray(s),u(s||[]);const t=P?`/files?folderId=${P}`:"/files",i=await fs(t);Array.isArray(i),F(i||[])}catch(e){ke(`Failed to load folder contents: ${e.message}`,{type:"error"}),u([]),F([])}finally{Ze(!1)}})()},[e,s,P,ts]);const Ns=i.useMemo(()=>{const e=z.length,s=x.filter(e=>!e.parentId).length,t=z.reduce((e,s)=>e+(s.size||0),0),i=new Date(Date.now()-864e5),a=t/21474836480*100;return{totalFiles:e,totalFolders:s,totalSize:t,recentFiles:z.filter(e=>new Date(e.uploadDate||e.createdAt||e.dateModified)>i).length,fileTypes:{images:z.filter(e=>e.type?.startsWith("image/")).length,documents:z.filter(e=>e.type?.includes("pdf")||e.type?.includes("doc")||e.type?.includes("text")).length,videos:z.filter(e=>e.type?.startsWith("video/")).length,audio:z.filter(e=>e.type?.startsWith("audio/")).length,other:z.filter(e=>!(e.type&&(e.type.startsWith("image/")||e.type.startsWith("video/")||e.type.startsWith("audio/")||e.type.includes("pdf")||e.type.includes("doc")||e.type.includes("text")))).length},storageUsed:Math.min(a,100),storageUsedGB:(t/1073741824).toFixed(2),storageLimitGB:20,lastUpdated:(new Date).toLocaleTimeString()}},[z,x]);if(r)return Ne.jsxs("div",{className:"d-flex align-items-center justify-content-center vh-100",children:[Ne.jsx(h,{color:"primary",style:{width:"3rem",height:"3rem"}}),Ne.jsx("span",{className:"ms-3 fw-semibold text-primary",children:"Loading..."})]});if(!e)return Ne.jsx(Ae,{onSignIn:o,onSignUp:c});const ys=e=>e?._id||e?.id||null,vs=x.find(e=>ys(e)===P),ws=[];let ks=vs;for(;ks;){ws.unshift(ks);const e=ks.parentId||null;ks=x.find(s=>String(ys(s))===String(e))}const Cs=z.filter(e=>P?String(e.folderId)===String(P):!e.folderId).filter(e=>!gs(e._id||e.id,"file")),Ss=x.filter(e=>P?String(e.parentId)===String(P):!e.parentId).filter(e=>!gs(e._id||e.id,"folder")),zs=Cs.filter(e=>e.name.toLowerCase().includes(be.toLowerCase())),Fs=Ss.filter(e=>e.name.toLowerCase().includes(be.toLowerCase()));ws.map(e=>e.name);const Ps=async e=>{try{const t=await fetch(`${os}/files/${e._id||e.id}/download`,{headers:s?{Authorization:`Bearer ${s}`}:{}});if(!t.ok){if(404===t.status&&e.url){const s=(e.url.startsWith("http"),e.url);return void window.open(s,"_blank")}const s=await t.text();throw new Error(s||`HTTP ${t.status}`)}const i=await t.blob(),a=window.URL.createObjectURL(i),l=document.createElement("a");l.href=a,l.download=e.name||"download",document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(a),await js("FILE_DOWNLOAD",{fileName:e.name||"download",fileId:e._id||e.id,fileSize:e.size||0,fileType:e.type||"unknown"})}catch(t){ke(`Download failed: ${t.message}`,{type:"error"})}},_s=e=>{try{if(!e)return void ke("Invalid folder selected",{type:"error"});const s=e._id||e.id;if(!s)return void ke("Folder ID is missing",{type:"error"});e.locked&&!$.has(s)?V(e):(is(!0),rs("folder"),_(s),ke(`Opening folder "${e.name}"...`,{type:"info"}))}catch(s){ke(`Failed to open folder: ${s.message}`,{type:"error"})}},Is=e=>{let s;if(s="object"==typeof e&&null!==e?e._id||e.id:e,s=String(s),!/^[0-9a-fA-F]{24}$/.test(s))return void ke("Invalid file ID format",{type:"error"});const t=z.find(e=>String(e._id||e.id)===s),i=t?.name||"this file";He({show:!0,title:"Move to trash",message:`Are you sure you want to move "${i}" to trash? You can restore it within 7 days.`,onConfirm:async()=>{try{Ee(!0),ke("Moving to trash...",{type:"info"});const a=JSON.parse(localStorage.getItem("sfm_trash_items")||"[]"),l={...t,_id:s,id:s,deletedAt:(new Date).toISOString(),type:"file",originalLocation:P?`folder-${P}`:"root"};a.push(l),localStorage.setItem("sfm_trash_items",JSON.stringify(a)),await fs(`/files/${e}`,{method:"DELETE"}),F(s=>s.filter(s=>(s._id||s.id)!==e)),await js("FILE_DELETE",{fileName:i,fileId:s,fileSize:t.size||0,fileType:t.type||"unknown",folderId:P||"root",folderName:vs?.name||"Root",movedToTrash:!0}),await fs(`/files/${s}`,{method:"DELETE"}),F(e=>e.filter(e=>(e._id||e.id)!==s)),ke(`Failed to move file to trash: ${error.message}`,{type:"error"})}finally{Ee(!1),He({show:!1,title:"",message:"",onConfirm:null})}}})},Ds=e=>{let s;if(s="object"==typeof e&&null!==e?e._id||e.id:e,s=String(s),!/^[0-9a-fA-F]{24}$/.test(s))return void ke("Invalid folder ID format",{type:"error"});const t=[...x,...C].find(e=>String(e._id||e.id)===s);if(!t)return void ke("Folder not found",{type:"error"});const i=Ls(s);ss({show:!0,folder:t,contentsAnalysis:i})},$s=e=>e&&0!==e?e<1024?Math.round(e)+" B":e<1048576?(e/1024).toFixed(1)+" KB":e<1073741824?(e/1048576).toFixed(1)+" MB":(e/1073741824).toFixed(1)+" GB":"0 B",Ts=e=>{if(!e||!z)return 0;try{return z.filter(s=>s&&String(s.folderId)===String(e)).length}catch(s){return 0}},Es=e=>{if(!e||!z||!x)return 0;try{const s=z.filter(s=>s&&String(s.folderId)===String(e)).length;return s+x.filter(s=>s&&String(s.parentId)===String(e)).length}catch(s){return 0}},As=e=>{if(!e||!x)return 0;try{return x.filter(s=>s&&String(s.parentId)===String(e)).length}catch(s){return 0}},Ls=e=>{const s=z.filter(s=>String(s.folderId)===String(e)),t=x.filter(s=>String(s.parentId)===String(e)),i=s.reduce((e,s)=>e+(s.size||0),0),a={images:s.filter(e=>e.type?.startsWith("image/")).length,documents:s.filter(e=>e.type?.includes("pdf")||e.type?.includes("doc")||e.type?.includes("text")).length,videos:s.filter(e=>e.type?.startsWith("video/")).length,audio:s.filter(e=>e.type?.startsWith("audio/")).length,other:s.filter(e=>!(e.type&&(e.type.startsWith("image/")||e.type.startsWith("video/")||e.type.startsWith("audio/")||e.type.includes("pdf")||e.type.includes("doc")||e.type.includes("text")))).length};return{fileCount:s.length,subfolderCount:t.length,totalSize:i,fileTypes:a,isEmpty:0===s.length&&0===t.length}};return Ne.jsx($e,{children:Ne.jsxs("div",{className:"filearlo-container d-flex",children:[Ne.jsxs("div",{className:"filearlo-sidebar d-flex flex-column",style:{width:"380px",minWidth:"380px"},children:[Ne.jsxs("div",{className:"p-4",children:[Ne.jsx("div",{className:"d-flex align-items-center gap-3 mb-5",children:Ne.jsx("div",{className:"fw-bold h3 mb-0",style:{color:"var(--color-text-primary)"},children:"FileArlo"})}),Ne.jsxs("div",{className:"position-relative mb-0",children:[Ne.jsx(D,{size:16,className:"position-absolute",style:{left:"12px",top:"12px",color:"var(--color-text-muted)"}}),Ne.jsx("input",{type:"text",className:"search-input-enhanced w-100",placeholder:"Search anything..",value:be,onChange:e=>ye(e.target.value)})]})]}),Ne.jsxs("div",{className:"flex-grow-1 overflow-auto px-4 py-3",children:[Ne.jsx("div",{className:"mb-4",children:Ne.jsxs("button",{className:"sidebar-nav-item btn w-100 text-start d-flex align-items-center gap-4 px-4 py-3 "+("dashboard"===ns?"active":""),onClick:()=>{js("VIEW_CHANGE",{from:ns,to:"dashboard"}),rs("dashboard"),_(null)},children:[Ne.jsx(Y,{size:20}),Ne.jsx("span",{className:"fw-semibold",style:{fontSize:"1rem"},children:"Dashboard"})]})}),Ne.jsxs("div",{className:"mb-4",children:[Ne.jsxs("button",{className:"sidebar-nav-item btn w-100 text-start d-flex align-items-center gap-4 px-4 py-3 "+("storage"===ns?"active":""),onClick:()=>{js("VIEW_CHANGE",{from:ns,to:"storage"}),rs("storage"),_(null)},children:[Ne.jsx(X,{size:20}),Ne.jsx("span",{className:"fw-semibold",style:{fontSize:"1rem"},children:"My Storage"}),Ne.jsx(n,{color:"info",className:"ms-auto",children:[...C||[],...x||[]].filter((e,s,t)=>{const i=t.findIndex(s=>ys(s)===ys(e))===s,a=!gs(ys(e),"folder");return i&&a}).length})]}),Ne.jsxs("button",{className:"sidebar-nav-item btn w-100 text-start d-flex align-items-center gap-4 px-4 py-3 "+("photos"===ns?"active":""),onClick:()=>{rs("photos"),_(null)},children:[Ne.jsx(B,{size:20}),Ne.jsx("span",{className:"fw-semibold",style:{fontSize:"1rem"},children:"Photos"}),Ne.jsx(n,{color:"danger",className:"ms-auto",children:z.filter(e=>e.type?.startsWith("image/")&&!gs(e._id||e.id,"file")).length})]}),Ne.jsxs("button",{className:"sidebar-nav-item btn w-100 text-start d-flex align-items-center gap-4 px-4 py-3 "+("audio"===ns?"active":""),onClick:()=>{rs("audio"),_(null)},children:[Ne.jsx(W,{size:20}),Ne.jsx("span",{className:"fw-semibold",style:{fontSize:"1rem"},children:"Audio"}),Ne.jsx(n,{color:"info",className:"ms-auto",children:z.filter(e=>e.type?.startsWith("audio/")&&!gs(e._id||e.id,"file")).length})]}),Ne.jsxs("button",{className:"sidebar-nav-item btn w-100 text-start d-flex align-items-center gap-4 px-4 py-3 "+("documents"===ns?"active":""),onClick:()=>{rs("documents"),_(null)},children:[Ne.jsx(M,{size:20}),Ne.jsx("span",{className:"fw-semibold",style:{fontSize:"1rem"},children:"Documents"}),Ne.jsx(n,{color:"primary",className:"ms-auto",children:z.filter(e=>(e.type?.includes("pdf")||e.type?.includes("doc")||e.type?.includes("text")||e.type?.includes("sheet")||e.type?.includes("presentation"))&&!gs(e._id||e.id,"file")).length})]}),Ne.jsxs("button",{className:"sidebar-nav-item btn w-100 text-start d-flex align-items-center gap-4 px-4 py-3 "+("videos"===ns?"active":""),onClick:()=>{rs("videos"),_(null)},children:[Ne.jsx(O,{size:20}),Ne.jsx("span",{className:"fw-semibold",style:{fontSize:"1rem"},children:"Videos"}),Ne.jsx(n,{color:"warning",className:"ms-auto",children:z.filter(e=>e.type?.startsWith("video/")&&!gs(e._id||e.id,"file")).length})]})]}),Ne.jsxs("div",{className:"mb-4",children:[Ne.jsxs("button",{className:"sidebar-nav-item btn w-100 text-start d-flex align-items-center gap-4 px-4 py-3",children:[Ne.jsx(Z,{size:20}),Ne.jsx("span",{className:"fw-semibold",style:{fontSize:"1rem"},children:"Recent"})]}),Ne.jsxs("button",{className:"sidebar-nav-item btn w-100 text-start d-flex align-items-center gap-4 px-4 py-3",children:[Ne.jsx(ee,{size:20}),Ne.jsx("span",{className:"fw-semibold",style:{fontSize:"1rem"},children:"Shared Link"})]}),Ne.jsxs("button",{className:"sidebar-nav-item btn w-100 text-start d-flex align-items-center gap-4 px-4 py-3 "+("favorites"===ns?"active":""),onClick:()=>{rs("favorites"),_(null)},children:[Ne.jsx(L,{size:20}),Ne.jsx("span",{className:"fw-semibold",style:{fontSize:"1rem"},children:"Favorites"}),Ne.jsx(n,{color:"primary",className:"ms-auto",children:as.length})]}),Ne.jsxs("button",{className:"sidebar-nav-item btn w-100 text-start d-flex align-items-center gap-4 px-4 py-3 "+("trash"===ns?"active":""),onClick:()=>{rs("trash"),_(null)},children:[Ne.jsx(U,{size:20}),Ne.jsx("span",{className:"fw-semibold",style:{fontSize:"1rem"},children:"Trash"}),Ne.jsx(n,{color:"danger",className:"ms-auto",children:(()=>{const e=JSON.parse(localStorage.getItem("sfm_trash_items")||"[]"),s=new Date(Date.now()-6048e5);return e.filter(e=>new Date(e.deletedAt)>s).length})()})]})]})]}),Ne.jsxs("div",{className:"p-4 border-top",children:[Ne.jsxs("div",{className:"mb-4",children:[Ne.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[Ne.jsx("span",{className:"fw-semibold",children:"Storage"}),Ne.jsxs("span",{className:"small text-muted",children:[Math.round(Ns.storageUsed),"%"]})]}),Ne.jsxs("div",{className:"text-muted small mb-2",children:[Ns.storageUsedGB," GB out of ",Ns.storageLimitGB," GB used"]}),Ne.jsx("div",{className:"storage-progress",children:Ne.jsx("div",{className:"storage-progress-bar",style:{width:`${Ns.storageUsed}%`,background:Ns.storageUsed>80?"linear-gradient(90deg, #ef4444, #dc2626)":Ns.storageUsed>60?"linear-gradient(90deg, #f59e0b, #d97706)":"linear-gradient(90deg, var(--color-primary), var(--color-primary-light))",transition:"all 0.3s ease"}})}),Ne.jsxs("div",{className:"d-flex justify-content-between mt-2",children:[Ne.jsxs("small",{className:"text-muted",children:[Ns.totalFiles," files"]}),Ne.jsxs("small",{className:"text-muted",children:[Ns.totalFolders," folders"]})]})]}),Ne.jsx("button",{className:"btn btn-primary w-100 fw-semibold py-2",children:"Upgrade Now"})]})]}),Ne.jsxs("div",{className:"flex-grow-1 d-flex flex-column",children:[Ne.jsxs("div",{className:"filearlo-header d-flex align-items-center justify-content-between",style:{padding:"1.5rem 2.5rem"},children:[Ne.jsxs("div",{className:"d-flex align-items-center gap-4",children:[Ne.jsx("h1",{className:"filearlo-title mb-0",children:"favorites"===ns?"My Favorites":"dashboard"===ns?"My Storage":"profile"===ns?"My Profile":"storage"===ns?"All Folders":"photos"===ns?"Photos":"audio"===ns?"Audio Files":"documents"===ns?"Documents":"videos"===ns?"Videos":"trash"===ns?"Trash":vs?.name||"Folder"}),Xe&&Ne.jsxs("div",{className:"d-flex align-items-center gap-2 text-primary",children:[Ne.jsx(h,{size:"sm"}),Ne.jsx("small",{className:"fw-medium",children:"Refreshing..."})]})]}),Ne.jsxs("div",{className:"d-flex align-items-center gap-3",children:[Ge&&Ne.jsxs("div",{className:"d-flex align-items-center gap-3 me-3",children:[Ne.jsxs("div",{className:"d-flex align-items-center gap-2",children:[Ne.jsx(h,{size:"sm",color:"primary"}),Ne.jsx("span",{className:"small text-primary",children:"Uploading..."})]}),Ne.jsx("div",{className:"progress",style:{width:"120px",height:"6px"},children:Ne.jsx("div",{className:"progress-bar bg-primary",role:"progressbar",style:{width:`${Ke}%`,transition:"width 0.3s ease"},"aria-valuenow":Ke,"aria-valuemin":"0","aria-valuemax":"100"})})]}),Ne.jsx("div",{className:"position-relative",children:Ne.jsxs("button",{className:"btn btn-link p-2",children:[Ne.jsx(se,{size:20,style:{color:"var(--color-text-secondary)"}}),Ne.jsx("div",{className:"notification-badge",children:Ns.recentFiles})]})}),Ne.jsxs("div",{className:"d-flex align-items-center gap-3",children:[Ne.jsxs("div",{className:"text-end",children:[Ne.jsx("div",{className:"fw-medium",style:{fontSize:"0.875rem",color:"var(--color-text-primary)"},children:e?.email}),Ne.jsx("small",{className:"text-muted",children:"Free Account"})]}),Ne.jsxs(p,{alignment:"end",children:[Ne.jsx(f,{caret:!1,className:"p-0 border-0 bg-transparent",style:{position:"relative"},children:Ne.jsx("div",{className:"position-relative",children:e?.profilePhoto?Ne.jsx("img",{src:e.profilePhoto,alt:"Profile",className:"rounded-circle",style:{width:"56px",height:"56px",objectFit:"cover",border:"3px solid var(--color-border-glass)",transition:"all 0.2s ease",cursor:"pointer"}}):Ne.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center",style:{width:"56px",height:"56px",backgroundColor:"var(--color-primary)",color:"white",border:"3px solid var(--color-border-glass)",transition:"all 0.2s ease",cursor:"pointer"},children:Ne.jsx(H,{size:24})})})}),Ne.jsxs(g,{children:[Ne.jsxs(j,{onClick:()=>{rs("profile"),_(null)},children:[Ne.jsx(H,{size:16,className:"me-2"})," View Profile"]}),Ne.jsxs(j,{href:"#",children:[Ne.jsx(te,{size:16,className:"me-2"})," Account Settings"]}),Ne.jsxs(j,{href:"#",children:[Ne.jsx(se,{size:16,className:"me-2"})," Notifications"]}),Ne.jsx(j,{divider:!0}),Ne.jsxs(j,{onClick:d,children:[Ne.jsx(ie,{size:16,className:"me-2"})," Sign Out"]})]})]})]})]})]}),Ne.jsxs("main",{className:"flex-grow-1",...xs(),style:{backgroundColor:"var(--color-bg-primary)",padding:"2.5rem"},children:[Ne.jsx("input",{...us()}),Ne.jsx("input",{type:"file",multiple:!0,accept:"*/*",ref:Re,style:{display:"none"},onChange:e=>{const t=e.target.files?Array.from(e.target.files):[];if(!t.length)return;const i=new FormData;for(const s of t)i.append("files",s);i.append("folderId",P||""),Ee(!0),fetch(`${os}/files/upload`,{method:"POST",headers:{Authorization:`Bearer ${s}`},body:i}).then(async e=>{if(!e.ok){const s=await e.text();throw new Error(s||`Upload failed (${e.status})`)}return e.json()}).then(e=>{F(s=>[...s,...e]),ke("Upload successful",{type:"success"})}).catch(e=>{ke(`Upload failed: ${e.message}`,{type:"error"})}).finally(()=>{Ee(!1),e&&e.target&&(e.target.value=null)})}}),ps&&Ne.jsxs("div",{className:"border border-primary border-2 rounded-3 p-4 text-primary text-center mb-4",style:{backgroundColor:"rgba(79, 70, 229, 0.05)"},children:[Ne.jsx(I,{size:32,className:"mb-2"}),Ne.jsx("div",{className:"fw-semibold",children:"Drop files to upload"})]}),ts?Ne.jsxs("div",{className:"d-flex align-items-center justify-content-center py-5",children:[Ne.jsx(h,{color:"primary",style:{width:"2rem",height:"2rem"}}),Ne.jsx("span",{className:"ms-3 fw-semibold text-primary",children:"Loading folder contents..."})]}):"favorites"===ns?Ne.jsxs("div",{className:"fade-in",children:[Ne.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[Ne.jsxs("div",{children:[Ne.jsx("h4",{className:"mb-1 fw-bold",children:"My Favorites"}),Ne.jsxs("p",{className:"text-muted mb-0",children:[as.length," favorited files"]})]}),Ne.jsx("div",{className:"d-flex align-items-center gap-2",children:Ne.jsxs("button",{className:"btn btn-outline-primary btn-modern",onClick:()=>Re.current&&Re.current.click(),children:[Ne.jsx(I,{size:16,className:"me-1"})," Upload"]})})]}),0===as.length?Ne.jsx("div",{className:"text-center py-5",children:Ne.jsx(a,{className:"border-0 shadow-sm",children:Ne.jsxs(l,{className:"text-center py-5",children:[Ne.jsx(L,{size:48,className:"text-muted mb-3 opacity-50"}),Ne.jsx("h6",{className:"fw-bold mb-2",children:"No favorites yet"}),Ne.jsx("p",{className:"text-muted mb-4",children:"Star files to add them to your favorites for quick access"}),Ne.jsxs("button",{className:"btn btn-primary",onClick:()=>{rs("dashboard"),_(null)},children:[Ne.jsx(q,{size:16,className:"me-1"}),"Browse Files"]})]})})}):Ne.jsx("div",{className:"row g-3",children:as.map((e,s)=>Ne.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6",children:Ne.jsx(a,{className:"border file-preview-card h-100 hover-lift hover-glow scale-in stagger-item",role:"button",onClick:()=>he(e),style:{animationDelay:100*s+"ms"},children:Ne.jsxs(l,{className:"p-3",children:[Ne.jsx("div",{className:"rounded-2 mb-3 d-flex align-items-center justify-content-center position-relative",style:{height:"120px",backgroundColor:"#f8f9fa"},children:e.type?.startsWith("image/")&&e.url?Ne.jsx("img",{src:e.url,alt:e.name,className:"img-fluid rounded-2",style:{maxHeight:"100%",maxWidth:"100%",objectFit:"cover"}}):Ne.jsxs("div",{className:"text-center",children:[Ne.jsx(T,{className:"text-muted",size:24}),Ne.jsx("div",{className:"mt-2",children:Ne.jsx("small",{className:"text-muted text-uppercase",children:e.name?.split(".").pop()||"FILE"})})]})}),Ne.jsxs("div",{className:"mb-3",children:[Ne.jsx("div",{className:"fw-semibold text-truncate mb-1",title:e.name,children:e.name}),Ne.jsx("div",{className:"text-muted small",children:Ne.jsxs("span",{children:["Favorited on ",new Date(e.favoritedAt).toLocaleDateString()]})})]}),Ne.jsxs("div",{className:"d-flex align-items-center justify-content-between border-top pt-3",children:[Ne.jsxs("div",{className:"d-flex gap-2",children:[Ne.jsx("button",{className:"btn btn-sm btn-outline-primary d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),he(e)},title:"Preview File",children:Ne.jsx(E,{size:14})}),Ne.jsx("button",{className:"btn btn-sm btn-outline-secondary d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),Ps(e)},title:"Download File",children:Ne.jsx(A,{size:14})}),Ne.jsx("button",{className:"btn btn-sm btn-warning d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),ds(e)},title:"Remove from Favorites",children:Ne.jsx(L,{size:14,fill:"currentColor"})})]}),Ne.jsx("small",{className:"text-muted",children:e.size?`${(e.size/1048576).toFixed(1)} MB`:"0 MB"})]})]})})},e._id||e.id||s))})]}):"profile"===ns?Ne.jsxs("div",{className:"fade-in",children:[Ne.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[Ne.jsxs("div",{children:[Ne.jsx("h4",{className:"mb-1 fw-bold",children:"My Profile"}),Ne.jsx("p",{className:"text-muted mb-0",children:"Manage your account settings and personal information"})]}),Ne.jsx("div",{className:"d-flex align-items-center gap-2",children:Ne.jsxs("button",{className:"btn btn-outline-primary btn-modern",onClick:()=>rs("dashboard"),children:[Ne.jsx(q,{size:16,className:"me-1"})," Back to Dashboard"]})})]}),Ne.jsxs(b,{className:"g-4",children:[Ne.jsx(N,{lg:4,children:Ne.jsxs(a,{className:"border-0 shadow-sm h-100",children:[Ne.jsx(y,{className:"bg-transparent border-0 pb-0",children:Ne.jsx("h6",{className:"mb-0 fw-bold",children:"Profile Information"})}),Ne.jsxs(l,{className:"text-center",children:[Ne.jsx("div",{className:"mb-4",children:Ne.jsxs("div",{className:"position-relative d-inline-block",children:[e?.profilePhoto?Ne.jsx("img",{src:e.profilePhoto,alt:"Profile",className:"rounded-circle border shadow-sm",style:{width:"120px",height:"120px",objectFit:"cover",border:"4px solid var(--color-border-glass)"}}):Ne.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center border shadow-sm",style:{width:"120px",height:"120px",backgroundColor:"var(--color-primary)",color:"white",border:"4px solid var(--color-border-glass)"},children:Ne.jsx(H,{size:40})}),Ne.jsx("button",{className:"btn btn-primary btn-sm rounded-circle position-absolute",style:{bottom:"0",right:"0",width:"32px",height:"32px",padding:"0"},onClick:()=>je(!0),title:"Change profile photo",children:Ne.jsx(R,{size:14})})]})}),Ne.jsx("h5",{className:"mb-1",children:e?.name||"User Name"}),Ne.jsx("p",{className:"text-muted mb-3",children:e?.email}),Ne.jsxs("div",{className:"d-flex justify-content-center gap-2 mb-3",children:[Ne.jsx(n,{color:"success",className:"px-3 py-2",children:Ne.jsxs("div",{className:"d-flex align-items-center gap-1",children:[Ne.jsx("div",{className:"bg-light rounded-circle",style:{width:"8px",height:"8px"}}),"Online"]})}),Ne.jsx(n,{color:"info",className:"px-3 py-2",children:"Free Account"})]}),Ne.jsxs("div",{className:"text-center",children:[Ne.jsxs("button",{className:"btn btn-outline-primary btn-sm me-2",onClick:()=>je(!0),children:[Ne.jsx(ae,{size:14,className:"me-1"}),"Edit Profile"]}),Ne.jsxs("button",{className:"btn btn-success btn-sm",children:[Ne.jsx(L,{size:14,className:"me-1"}),"Upgrade to Pro"]})]})]})]})}),Ne.jsx(N,{lg:8,children:Ne.jsxs(a,{className:"border-0 shadow-sm h-100",children:[Ne.jsx(y,{className:"bg-transparent border-0 pb-0",children:Ne.jsx("h6",{className:"mb-0 fw-bold",children:"Account Details"})}),Ne.jsxs(l,{children:[Ne.jsxs(b,{className:"g-3",children:[Ne.jsx(N,{md:6,children:Ne.jsxs("div",{className:"border rounded-3 p-3",children:[Ne.jsxs("div",{className:"d-flex align-items-center gap-2 mb-2",children:[Ne.jsx(H,{size:16,className:"text-primary"}),Ne.jsx("span",{className:"fw-semibold small text-uppercase text-muted",children:"Full Name"})]}),Ne.jsx("div",{className:"fw-medium",children:e?.name||"Not set"})]})}),Ne.jsx(N,{md:6,children:Ne.jsxs("div",{className:"border rounded-3 p-3",children:[Ne.jsxs("div",{className:"d-flex align-items-center gap-2 mb-2",children:[Ne.jsx(le,{size:16,className:"text-primary"}),Ne.jsx("span",{className:"fw-semibold small text-uppercase text-muted",children:"Email Address"})]}),Ne.jsxs("div",{className:"fw-medium d-flex align-items-center gap-2",children:[e?.email,Ne.jsx(n,{color:"success",size:"sm",children:"Verified"})]})]})}),Ne.jsx(N,{md:6,children:Ne.jsxs("div",{className:"border rounded-3 p-3",children:[Ne.jsxs("div",{className:"d-flex align-items-center gap-2 mb-2",children:[Ne.jsx(ne,{size:16,className:"text-primary"}),Ne.jsx("span",{className:"fw-semibold small text-uppercase text-muted",children:"Member Since"})]}),Ne.jsx("div",{className:"fw-medium",children:(new Date).getFullYear()-1})]})}),Ne.jsx(N,{md:6,children:Ne.jsxs("div",{className:"border rounded-3 p-3",children:[Ne.jsxs("div",{className:"d-flex align-items-center gap-2 mb-2",children:[Ne.jsx(re,{size:16,className:"text-primary"}),Ne.jsx("span",{className:"fw-semibold small text-uppercase text-muted",children:"Account Type"})]}),Ne.jsx("div",{className:"fw-medium",children:"Free Account"})]})})]}),Ne.jsxs("div",{className:"mt-4 p-3 bg-light rounded-3",children:[Ne.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[Ne.jsxs("div",{className:"d-flex align-items-center gap-2",children:[Ne.jsx(v,{size:"sm",style:{width:"16px",height:"16px"}}),Ne.jsx("span",{className:"fw-semibold small text-uppercase text-muted",children:"Storage Usage"})]}),Ne.jsxs("span",{className:"small fw-medium",children:[Ns.storageUsedGB," GB / ",Ns.storageLimitGB," GB"]})]}),Ne.jsx(v,{className:"mb-2",height:8,children:Ne.jsx(w,{value:Ns.storageUsed,color:Ns.storageUsed>80?"danger":Ns.storageUsed>60?"warning":"primary"})}),Ne.jsxs("div",{className:"d-flex justify-content-between small text-muted",children:[Ne.jsxs("span",{children:[Ns.totalFiles," files • ",Ns.totalFolders," folders"]}),Ne.jsxs("span",{children:[Math.round(Ns.storageUsed),"% used"]})]})]}),Ne.jsxs("div",{className:"mt-4",children:[Ne.jsx("h6",{className:"fw-bold mb-3",children:"Quick Actions"}),Ne.jsxs("div",{className:"row g-2",children:[Ne.jsx("div",{className:"col-md-4",children:Ne.jsxs("button",{className:"btn btn-outline-primary w-100 d-flex align-items-center justify-content-center gap-2 py-3",children:[Ne.jsx(te,{size:16}),Ne.jsx("span",{className:"small fw-semibold",children:"Account Settings"})]})}),Ne.jsx("div",{className:"col-md-4",children:Ne.jsxs("button",{className:"btn btn-outline-secondary w-100 d-flex align-items-center justify-content-center gap-2 py-3",children:[Ne.jsx(se,{size:16}),Ne.jsx("span",{className:"small fw-semibold",children:"Notifications"})]})}),Ne.jsx("div",{className:"col-md-4",children:Ne.jsxs("button",{className:"btn btn-outline-danger w-100 d-flex align-items-center justify-content-center gap-2 py-3",onClick:d,children:[Ne.jsx(ie,{size:16}),Ne.jsx("span",{className:"small fw-semibold",children:"Sign Out"})]})})]})]})]})]})})]})]}):"storage"===ns?Ne.jsxs("div",{className:"fade-in",children:[Ne.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[Ne.jsxs("div",{children:[Ne.jsx("h4",{className:"mb-1 fw-bold",children:"All Folders"}),Ne.jsx("p",{className:"text-muted mb-0",children:`${[...C||[],...x||[]].filter((e,s,t)=>{const i=t.findIndex(s=>ys(s)===ys(e))===s,a=!gs(ys(e),"folder");return i&&a}).length} folders • Browse all your folders in one place`})]}),Ne.jsx("div",{className:"d-flex align-items-center gap-2",children:Ne.jsx("button",{className:"btn btn-outline-primary btn-modern",onClick:()=>ue(!0),disabled:Qe,children:Qe?Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(h,{size:"sm",className:"me-1"})," Creating..."]}):Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(oe,{size:16,className:"me-1"})," New Folder"]})})})]}),(()=>{const e=[...C||[],...x||[]].filter((e,s,t)=>{const i=t.findIndex(s=>ys(s)===ys(e))===s,a=!gs(ys(e),"folder");return i&&a});return 0===e.length?Ne.jsx("div",{className:"text-center py-5",children:Ne.jsx(a,{className:"border-0 shadow-sm",children:Ne.jsxs(l,{className:"text-center py-5",children:[Ne.jsx(X,{size:48,className:"text-muted mb-3 opacity-50"}),Ne.jsx("h6",{className:"fw-bold mb-2",children:"No folders yet"}),Ne.jsx("p",{className:"text-muted mb-4",children:"Create your first folder to organize your files"}),Ne.jsxs("button",{className:"btn btn-primary",onClick:()=>ue(!0),children:[Ne.jsx(oe,{size:16,className:"me-1"}),"Create Your First Folder"]})]})})}):Ne.jsx("div",{className:"row g-3",children:e.map((e,s)=>Ne.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6",children:Ne.jsxs("div",{className:"folder-card p-3 rounded-3 border hover-lift hover-glow position-relative scale-in stagger-item",style:{animationDelay:50*s+"ms"},children:[Ne.jsxs("div",{className:"d-flex align-items-center gap-3",role:"button",onClick:()=>_s(e),children:[Ne.jsx("div",{className:"rounded-2 d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"48px",height:"48px",backgroundColor:"#e0e7ff",color:"#4f46e5"},children:Ne.jsx(X,{size:24})}),Ne.jsxs("div",{className:"flex-grow-1 min-width-0",children:[Ne.jsxs("div",{className:"fw-semibold text-truncate mb-1",children:[e.name,(()=>{const s=Es(ys(e));return s>0?Ne.jsxs("span",{className:"text-muted fw-normal ms-2",children:["(",s," item",1!==s?"s":"",")"]}):null})()]}),Ne.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[Ne.jsxs("div",{className:"d-flex flex-column",children:[(()=>{const s=Ts(ys(e)),t=As(ys(e));return s>0||t>0?Ne.jsxs("small",{className:"text-muted",children:[s>0&&`${s} file${1!==s?"s":""}`,s>0&&t>0&&" • ",t>0&&`${t} folder${1!==t?"s":""}`]}):null})(),(()=>{const s=hs(ys(e));return s>0?Ne.jsxs("small",{className:"text-muted fw-semibold",style:{color:"#059669",fontSize:"0.8rem"},children:["📦 ",$s(s)]}):null})()]}),e.locked&&Ne.jsx(ce,{size:12,className:"text-warning"})]})]})]}),Ne.jsxs("div",{className:"folder-actions mt-3 d-flex gap-2 justify-content-center opacity-0",children:[Ne.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:s=>{s.stopPropagation(),_s(e)},title:"Open folder",children:Ne.jsx(E,{size:12})}),Ne.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:s=>{s.stopPropagation(),fe(e)},title:"Edit folder",children:Ne.jsx(ae,{size:12})}),Ne.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:s=>{s.stopPropagation(),Ds(ys(e))},title:"Delete folder",children:Ne.jsx(U,{size:12})})]})]})},ys(e)))})})()]}):"photos"===ns?Ne.jsxs("div",{className:"fade-in",children:[Ne.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[Ne.jsxs("div",{children:[Ne.jsx("h4",{className:"mb-1 fw-bold",children:"Photos"}),Ne.jsxs("p",{className:"text-muted mb-0",children:[z.filter(e=>e.type?.startsWith("image/")&&!gs(e._id||e.id,"file")).length," images"]})]}),Ne.jsx("div",{className:"d-flex align-items-center gap-2",children:Ne.jsxs("button",{className:"btn btn-outline-primary btn-modern",onClick:()=>Re.current&&Re.current.click(),children:[Ne.jsx(I,{size:16,className:"me-1"})," Upload Photos"]})})]}),0===z.filter(e=>e.type?.startsWith("image/")&&!gs(e._id||e.id,"file")).length?Ne.jsx("div",{className:"text-center py-5",children:Ne.jsx(a,{className:"border-0 shadow-sm",children:Ne.jsxs(l,{className:"text-center py-5",children:[Ne.jsx(B,{size:48,className:"text-muted mb-3 opacity-50"}),Ne.jsx("h6",{className:"fw-bold mb-2",children:"No photos yet"}),Ne.jsx("p",{className:"text-muted mb-4",children:"Upload your first photos to see them here"}),Ne.jsxs("button",{className:"btn btn-primary",onClick:()=>Re.current&&Re.current.click(),children:[Ne.jsx(I,{size:16,className:"me-1"}),"Upload Photos"]})]})})}):Ne.jsx("div",{className:"row g-3",children:z.filter(e=>e.type?.startsWith("image/")&&!gs(e._id||e.id,"file")).map((e,s)=>Ne.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6",children:Ne.jsx(a,{className:"border file-preview-card h-100 hover-lift hover-glow scale-in stagger-item",role:"button",onClick:()=>he(e),style:{animationDelay:50*s+"ms"},children:Ne.jsxs(l,{className:"p-3",children:[Ne.jsx("div",{className:"rounded-2 mb-3 d-flex align-items-center justify-content-center position-relative",style:{height:"180px",backgroundColor:"#f8f9fa"},children:Ne.jsx("img",{src:e.url,alt:e.name,className:"img-fluid rounded-2",style:{maxHeight:"100%",maxWidth:"100%",objectFit:"cover"}})}),Ne.jsxs("div",{className:"mb-3",children:[Ne.jsx("div",{className:"fw-semibold text-truncate mb-1",title:e.name,children:e.name}),Ne.jsx("div",{className:"text-muted small",children:e.size?`${(e.size/1048576).toFixed(1)} MB`:"0 MB"})]}),Ne.jsx("div",{className:"d-flex align-items-center justify-content-between border-top pt-3",children:Ne.jsxs("div",{className:"d-flex gap-2",children:[Ne.jsx("button",{className:"btn btn-sm btn-outline-primary d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),he(e)},title:"Preview",children:Ne.jsx(E,{size:14})}),Ne.jsx("button",{className:"btn btn-sm btn-outline-secondary d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),Ps(e)},title:"Download",children:Ne.jsx(A,{size:14})}),Ne.jsx("button",{className:`btn btn-sm ${ms(e)?"btn-warning":"btn-outline-warning"} d-flex align-items-center gap-1`,onClick:s=>{s.stopPropagation(),ds(e)},title:ms(e)?"Remove from Favorites":"Add to Favorites",children:Ne.jsx(L,{size:14,fill:ms(e)?"currentColor":"none"})}),Ne.jsx("button",{className:"btn btn-sm btn-outline-danger d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),Is(e._id||e.id)},title:"Delete",children:Ne.jsx(U,{size:14})})]})})]})})},e._id||e.id))})]}):"audio"===ns?Ne.jsxs("div",{className:"fade-in",children:[Ne.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[Ne.jsxs("div",{children:[Ne.jsx("h4",{className:"mb-1 fw-bold",children:"Audio Files"}),Ne.jsxs("p",{className:"text-muted mb-0",children:[z.filter(e=>e.type?.startsWith("audio/")&&!gs(e._id||e.id,"file")).length," audio files"]})]}),Ne.jsx("div",{className:"d-flex align-items-center gap-2",children:Ne.jsxs("button",{className:"btn btn-outline-primary btn-modern",onClick:()=>Re.current&&Re.current.click(),children:[Ne.jsx(I,{size:16,className:"me-1"})," Upload Audio"]})})]}),0===z.filter(e=>e.type?.startsWith("audio/")&&!gs(e._id||e.id,"file")).length?Ne.jsx("div",{className:"text-center py-5",children:Ne.jsx(a,{className:"border-0 shadow-sm",children:Ne.jsxs(l,{className:"text-center py-5",children:[Ne.jsx(W,{size:48,className:"text-muted mb-3 opacity-50"}),Ne.jsx("h6",{className:"fw-bold mb-2",children:"No audio files yet"}),Ne.jsx("p",{className:"text-muted mb-4",children:"Upload your first audio files to see them here"}),Ne.jsxs("button",{className:"btn btn-primary",onClick:()=>Re.current&&Re.current.click(),children:[Ne.jsx(I,{size:16,className:"me-1"}),"Upload Audio"]})]})})}):Ne.jsx("div",{className:"row g-3",children:z.filter(e=>e.type?.startsWith("audio/")&&!gs(e._id||e.id,"file")).map((e,s)=>Ne.jsx("div",{className:"col-xl-4 col-lg-6 col-md-6",children:Ne.jsx(a,{className:"border file-preview-card h-100 hover-lift hover-glow scale-in stagger-item",role:"button",onClick:()=>he(e),style:{animationDelay:50*s+"ms"},children:Ne.jsxs(l,{className:"p-3",children:[Ne.jsx("div",{className:"rounded-2 mb-3 d-flex align-items-center justify-content-center position-relative",style:{height:"120px",backgroundColor:"#f8f9fa"},children:Ne.jsx(W,{size:32,className:"text-primary"})}),Ne.jsxs("div",{className:"mb-3",children:[Ne.jsx("div",{className:"fw-semibold text-truncate mb-1",title:e.name,children:e.name}),Ne.jsx("div",{className:"text-muted small",children:e.size?`${(e.size/1048576).toFixed(1)} MB`:"0 MB"})]}),Ne.jsx("div",{className:"d-flex align-items-center justify-content-between border-top pt-3",children:Ne.jsxs("div",{className:"d-flex gap-2",children:[Ne.jsx("button",{className:"btn btn-sm btn-outline-primary d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),he(e)},title:"Preview",children:Ne.jsx(E,{size:14})}),Ne.jsx("button",{className:"btn btn-sm btn-outline-secondary d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),Ps(e)},title:"Download",children:Ne.jsx(A,{size:14})}),Ne.jsx("button",{className:`btn btn-sm ${ms(e)?"btn-warning":"btn-outline-warning"} d-flex align-items-center gap-1`,onClick:s=>{s.stopPropagation(),ds(e)},title:ms(e)?"Remove from Favorites":"Add to Favorites",children:Ne.jsx(L,{size:14,fill:ms(e)?"currentColor":"none"})}),Ne.jsx("button",{className:"btn btn-sm btn-outline-danger d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),Is(e._id||e.id)},title:"Delete",children:Ne.jsx(U,{size:14})})]})})]})})},e._id||e.id))})]}):"documents"===ns?Ne.jsxs("div",{className:"fade-in",children:[Ne.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[Ne.jsxs("div",{children:[Ne.jsx("h4",{className:"mb-1 fw-bold",children:"Documents"}),Ne.jsxs("p",{className:"text-muted mb-0",children:[z.filter(e=>(e.type?.includes("pdf")||e.type?.includes("doc")||e.type?.includes("text")||e.type?.includes("sheet")||e.type?.includes("presentation"))&&!gs(e._id||e.id,"file")).length," documents"]})]}),Ne.jsx("div",{className:"d-flex align-items-center gap-2",children:Ne.jsxs("button",{className:"btn btn-outline-primary btn-modern",onClick:()=>Re.current&&Re.current.click(),children:[Ne.jsx(I,{size:16,className:"me-1"})," Upload Documents"]})})]}),0===z.filter(e=>(e.type?.includes("pdf")||e.type?.includes("doc")||e.type?.includes("text")||e.type?.includes("sheet")||e.type?.includes("presentation"))&&!gs(e._id||e.id,"file")).length?Ne.jsx("div",{className:"text-center py-5",children:Ne.jsx(a,{className:"border-0 shadow-sm",children:Ne.jsxs(l,{className:"text-center py-5",children:[Ne.jsx(M,{size:48,className:"text-muted mb-3 opacity-50"}),Ne.jsx("h6",{className:"fw-bold mb-2",children:"No documents yet"}),Ne.jsx("p",{className:"text-muted mb-4",children:"Upload your first documents to see them here"}),Ne.jsxs("button",{className:"btn btn-primary",onClick:()=>Re.current&&Re.current.click(),children:[Ne.jsx(I,{size:16,className:"me-1"}),"Upload Documents"]})]})})}):Ne.jsx("div",{className:"row g-3",children:z.filter(e=>(e.type?.includes("pdf")||e.type?.includes("doc")||e.type?.includes("text")||e.type?.includes("sheet")||e.type?.includes("presentation"))&&!gs(e._id||e.id,"file")).map((e,s)=>Ne.jsx("div",{className:"col-xl-4 col-lg-6 col-md-6",children:Ne.jsx(a,{className:"border file-preview-card h-100 hover-lift hover-glow scale-in stagger-item",role:"button",onClick:()=>he(e),style:{animationDelay:50*s+"ms"},children:Ne.jsxs(l,{className:"p-3",children:[Ne.jsxs("div",{className:"rounded-2 mb-3 d-flex align-items-center justify-content-center position-relative",style:{height:"120px",backgroundColor:"#f8f9fa"},children:[Ne.jsx(M,{size:32,className:"text-success"}),Ne.jsx("div",{className:"position-absolute bottom-0 end-0 me-2 mb-2",children:Ne.jsx("small",{className:"badge bg-success text-uppercase",children:e.name?.split(".").pop()||"DOC"})})]}),Ne.jsxs("div",{className:"mb-3",children:[Ne.jsx("div",{className:"fw-semibold text-truncate mb-1",title:e.name,children:e.name}),Ne.jsx("div",{className:"text-muted small",children:e.size?`${(e.size/1048576).toFixed(1)} MB`:"0 MB"})]}),Ne.jsx("div",{className:"d-flex align-items-center justify-content-between border-top pt-3",children:Ne.jsxs("div",{className:"d-flex gap-2",children:[Ne.jsx("button",{className:"btn btn-sm btn-outline-primary d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),he(e)},title:"Preview",children:Ne.jsx(E,{size:14})}),Ne.jsx("button",{className:"btn btn-sm btn-outline-secondary d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),Ps(e)},title:"Download",children:Ne.jsx(A,{size:14})}),Ne.jsx("button",{className:`btn btn-sm ${ms(e)?"btn-warning":"btn-outline-warning"} d-flex align-items-center gap-1`,onClick:s=>{s.stopPropagation(),ds(e)},title:ms(e)?"Remove from Favorites":"Add to Favorites",children:Ne.jsx(L,{size:14,fill:ms(e)?"currentColor":"none"})}),Ne.jsx("button",{className:"btn btn-sm btn-outline-danger d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),Is(e._id||e.id)},title:"Delete",children:Ne.jsx(U,{size:14})})]})})]})})},e._id||e.id))})]}):"videos"===ns?Ne.jsxs("div",{className:"fade-in",children:[Ne.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[Ne.jsxs("div",{children:[Ne.jsx("h4",{className:"mb-1 fw-bold",children:"Videos"}),Ne.jsxs("p",{className:"text-muted mb-0",children:[z.filter(e=>e.type?.startsWith("video/")&&!gs(e._id||e.id,"file")).length," videos"]})]}),Ne.jsx("div",{className:"d-flex align-items-center gap-2",children:Ne.jsxs("button",{className:"btn btn-outline-primary btn-modern",onClick:()=>Re.current&&Re.current.click(),children:[Ne.jsx(I,{size:16,className:"me-1"})," Upload Videos"]})})]}),0===z.filter(e=>e.type?.startsWith("video/")&&!gs(e._id||e.id,"file")).length?Ne.jsx("div",{className:"text-center py-5",children:Ne.jsx(a,{className:"border-0 shadow-sm",children:Ne.jsxs(l,{className:"text-center py-5",children:[Ne.jsx(O,{size:48,className:"text-muted mb-3 opacity-50"}),Ne.jsx("h6",{className:"fw-bold mb-2",children:"No videos yet"}),Ne.jsx("p",{className:"text-muted mb-4",children:"Upload your first videos to see them here"}),Ne.jsxs("button",{className:"btn btn-primary",onClick:()=>Re.current&&Re.current.click(),children:[Ne.jsx(I,{size:16,className:"me-1"}),"Upload Videos"]})]})})}):Ne.jsx("div",{className:"row g-3",children:z.filter(e=>e.type?.startsWith("video/")&&!gs(e._id||e.id,"file")).map((e,s)=>Ne.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6",children:Ne.jsx(a,{className:"border file-preview-card h-100 hover-lift hover-glow scale-in stagger-item",role:"button",onClick:()=>he(e),style:{animationDelay:50*s+"ms"},children:Ne.jsxs(l,{className:"p-3",children:[Ne.jsxs("div",{className:"rounded-2 mb-3 d-flex align-items-center justify-content-center position-relative",style:{height:"180px",backgroundColor:"#000"},children:[e.url?Ne.jsx("video",{className:"w-100 h-100 rounded-2",style:{objectFit:"cover"},poster:e.thumbnail,children:Ne.jsx("source",{src:e.url,type:e.type})}):Ne.jsx(O,{size:32,className:"text-white"}),Ne.jsx("div",{className:"position-absolute top-50 start-50 translate-middle",children:Ne.jsx("div",{className:"bg-white bg-opacity-75 rounded-circle p-2",children:Ne.jsx(O,{size:20,className:"text-dark"})})})]}),Ne.jsxs("div",{className:"mb-3",children:[Ne.jsx("div",{className:"fw-semibold text-truncate mb-1",title:e.name,children:e.name}),Ne.jsx("div",{className:"text-muted small",children:e.size?`${(e.size/1048576).toFixed(1)} MB`:"0 MB"})]}),Ne.jsx("div",{className:"d-flex align-items-center justify-content-between border-top pt-3",children:Ne.jsxs("div",{className:"d-flex gap-2",children:[Ne.jsx("button",{className:"btn btn-sm btn-outline-primary d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),he(e)},title:"Preview",children:Ne.jsx(E,{size:14})}),Ne.jsx("button",{className:"btn btn-sm btn-outline-secondary d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),Ps(e)},title:"Download",children:Ne.jsx(A,{size:14})}),Ne.jsx("button",{className:`btn btn-sm ${ms(e)?"btn-warning":"btn-outline-warning"} d-flex align-items-center gap-1`,onClick:s=>{s.stopPropagation(),ds(e)},title:ms(e)?"Remove from Favorites":"Add to Favorites",children:Ne.jsx(L,{size:14,fill:ms(e)?"currentColor":"none"})}),Ne.jsx("button",{className:"btn btn-sm btn-outline-danger d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),Is(e._id||e.id)},title:"Delete",children:Ne.jsx(U,{size:14})})]})})]})})},e._id||e.id))})]}):"trash"===ns?Ne.jsx("div",{className:"fade-in",children:(()=>{const e=JSON.parse(localStorage.getItem("sfm_trash_items")||"[]"),s=new Date(Date.now()-6048e5),t=e.filter(e=>new Date(e.deletedAt)>s);return Ne.jsxs(Ne.Fragment,{children:[Ne.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[Ne.jsxs("div",{children:[Ne.jsx("h4",{className:"mb-1 fw-bold",children:"Trash"}),Ne.jsxs("p",{className:"text-muted mb-0",children:[t.length," items • Items are automatically deleted after 7 days"]})]}),Ne.jsx("div",{className:"d-flex align-items-center gap-2",children:t.length>0&&Ne.jsxs("button",{className:"btn btn-outline-danger btn-modern",onClick:()=>{He({show:!0,title:"Empty Trash",message:`Are you sure you want to permanently delete all ${t.length} items? This action cannot be undone.`,onConfirm:()=>{js("TRASH_EMPTY",{itemCount:t.length,itemNames:t.map(e=>e.name)}),localStorage.setItem("sfm_trash_items","[]"),ke("Trash emptied successfully",{type:"info"}),rs("trash"),He({show:!1,title:"",message:"",onConfirm:null})}})},children:[Ne.jsx(U,{size:16,className:"me-1"})," Empty Trash"]})})]}),0===t.length?Ne.jsx("div",{className:"text-center py-5",children:Ne.jsx(a,{className:"border-0 shadow-sm",children:Ne.jsxs(l,{className:"text-center py-5",children:[Ne.jsx(U,{size:48,className:"text-muted mb-3 opacity-50"}),Ne.jsx("h6",{className:"fw-bold mb-2",children:"Trash is empty"}),Ne.jsx("p",{className:"text-muted mb-4",children:"Deleted items will appear here and be automatically removed after 7 days"})]})})}):Ne.jsx("div",{className:"row g-3",children:t.map((s,t)=>{const i=Math.ceil(7-(Date.now()-new Date(s.deletedAt))/864e5);return Ne.jsx("div",{className:"col-xl-4 col-lg-6 col-md-6",children:Ne.jsx(a,{className:"border file-preview-card h-100 hover-lift hover-glow scale-in stagger-item",style:{animationDelay:50*t+"ms"},children:Ne.jsxs(l,{className:"p-3",children:[Ne.jsxs("div",{className:"rounded-2 mb-3 d-flex align-items-center justify-content-center position-relative",style:{height:"120px",backgroundColor:"#f8f9fa"},children:["folder"===s.type?Ne.jsx(X,{size:32,className:"text-primary"}):s.type?.startsWith("image/")&&s.url?Ne.jsx("img",{src:s.url,alt:s.name,className:"img-fluid rounded-2",style:{maxHeight:"100%",maxWidth:"100%",objectFit:"cover"}}):Ne.jsx(T,{size:32,className:"text-muted"}),Ne.jsx("div",{className:"position-absolute top-0 end-0 m-2",children:Ne.jsxs(n,{color:i<=1?"danger":i<=3?"warning":"info",className:"small",children:[i,"d left"]})})]}),Ne.jsxs("div",{className:"mb-3",children:[Ne.jsxs("div",{className:"fw-semibold text-truncate mb-1",title:s.name,children:[s.name,"folder"===s.type&&s.contentsInfo&&Ne.jsxs("small",{className:"text-muted ms-2",children:["(",s.contentsInfo.totalItems," items)"]})]}),Ne.jsxs("div",{className:"text-muted small",children:[Ne.jsxs("div",{children:["Deleted: ",new Date(s.deletedAt).toLocaleDateString()]}),Ne.jsxs("div",{children:["Type: ","folder"===s.type?"Folder":"File"]}),"folder"!==s.type&&s.size&&Ne.jsxs("div",{children:["Size: ",(s.size/1048576).toFixed(1)," MB"]})]})]}),Ne.jsxs("div",{className:"d-flex align-items-center justify-content-between border-top pt-3",children:[Ne.jsxs("div",{className:"d-flex gap-2",children:[Ne.jsxs("button",{className:"btn btn-sm btn-outline-success d-flex align-items-center gap-1",onClick:()=>(s=>{const t=e.filter(e=>e._id!==s._id&&e.id!==s.id);localStorage.setItem("sfm_trash_items",JSON.stringify(t)),js("TRASH_RESTORE",{itemName:s.name,itemId:s._id||s.id,itemType:s.type,originalLocation:s.originalLocation}),ke(`"${s.name}" restored successfully`,{type:"success"}),rs("trash")})(s),title:"Restore Item",children:[Ne.jsx(I,{size:14})," Restore"]}),Ne.jsxs("button",{className:"btn btn-sm btn-outline-danger d-flex align-items-center gap-1",onClick:()=>(s=>{He({show:!0,title:"Permanent Delete",message:`Are you sure you want to permanently delete "${s.name}"? This action cannot be undone.`,onConfirm:()=>{const t=e.filter(e=>e._id!==s._id&&e.id!==s.id);localStorage.setItem("sfm_trash_items",JSON.stringify(t)),js("TRASH_PERMANENT_DELETE",{itemName:s.name,itemId:s._id||s.id,itemType:s.type,deletedFromTrash:!0}),ke(`"${s.name}" permanently deleted`,{type:"info"}),rs("trash"),He({show:!1,title:"",message:"",onConfirm:null})}})})(s),title:"Delete Permanently",children:[Ne.jsx(U,{size:14})," Delete"]})]}),Ne.jsxs("small",{className:"fw-semibold "+(i<=1?"text-danger":i<=3?"text-warning":"text-muted"),children:[i," day",1!==i?"s":""," left"]})]})]})})},`${s._id||s.id}-${s.deletedAt}`)})})]})})()}):"dashboard"===ns?Ne.jsxs("div",{className:"fade-in",children:[Ne.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4 fade-in",children:[Ne.jsxs("div",{className:"slide-in-left",children:[Ne.jsx("h4",{className:"mb-1 fw-bold",children:"My Storage Dashboard"}),Ne.jsxs("p",{className:"text-muted mb-0",children:[Ns.totalFiles||0," files • ",Ns.totalFolders||0," folders • Last updated: ",Ns.lastUpdated||"Loading..."]})]}),Ne.jsxs("div",{className:"d-flex gap-3 slide-in-right",children:[Ne.jsxs("div",{className:"text-center hover-lift stagger-item",children:[Ne.jsx("div",{className:"h5 fw-bold mb-0 text-primary counter-animate",children:Ns.totalFiles||0}),Ne.jsx("small",{className:"text-muted",children:"Total Files"})]}),Ne.jsxs("div",{className:"text-center hover-lift stagger-item",children:[Ne.jsx("div",{className:"h5 fw-bold mb-0 text-success counter-animate",children:Ns.totalFolders||0}),Ne.jsx("small",{className:"text-muted",children:"Folders"})]}),Ne.jsxs("div",{className:"text-center hover-lift stagger-item",children:[Ne.jsx("div",{className:"h5 fw-bold mb-0 text-info counter-animate",children:Ns.recentFiles||0}),Ne.jsx("small",{className:"text-muted",children:"Recent (24h)"})]})]})]}),Ne.jsx(Fe,{files:z||[]}),Array.isArray(C)&&C.length>0&&Ne.jsx("div",{className:"mb-4",children:Ne.jsx(a,{className:"border-0 shadow-sm",children:Ne.jsxs(l,{className:"p-0",children:[Ne.jsx("div",{className:"p-4 border-bottom",children:Ne.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[Ne.jsx("h5",{className:"mb-0 fw-bold",children:"Folders"}),Ne.jsx("div",{className:"d-flex align-items-center gap-2",children:Ne.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>ue(!0),disabled:Qe,children:Qe?Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(h,{size:"sm",className:"me-1"})," Creating..."]}):Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(de,{size:14,className:"me-1"})," Create new"]})})})]})}),Ne.jsx("div",{className:"p-4",children:Ne.jsxs("div",{className:"row g-3",children:[C.map((e,s)=>Ne.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6",children:Ne.jsxs("div",{className:"folder-card p-3 rounded-3 border hover-lift hover-glow position-relative scale-in stagger-item",style:{animationDelay:100*s+"ms"},children:[Ne.jsxs("div",{className:"d-flex align-items-center gap-3",role:"button",onClick:()=>_s(e),children:[Ne.jsx("div",{className:"rounded-2 d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"48px",height:"48px",backgroundColor:"#e0e7ff",color:"#4f46e5"},children:Ne.jsx(X,{size:24})}),Ne.jsxs("div",{className:"flex-grow-1 min-width-0",children:[Ne.jsxs("div",{className:"fw-semibold text-truncate mb-1",children:[e.name,(()=>{const s=Es(ys(e));return s>0?Ne.jsxs("span",{className:"text-muted fw-normal ms-2",children:["(",s," item",1!==s?"s":"",")"]}):null})()]}),Ne.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[Ne.jsxs("div",{className:"d-flex flex-column",children:[(()=>{const s=Ts(ys(e)),t=As(ys(e));return s>0||t>0?Ne.jsxs("small",{className:"text-muted",children:[s>0&&`${s} file${1!==s?"s":""}`,s>0&&t>0&&" • ",t>0&&`${t} folder${1!==t?"s":""}`]}):null})(),(()=>{const s=hs(ys(e));return s>0?Ne.jsxs("small",{className:"text-muted fw-semibold",style:{color:"#059669",fontSize:"0.8rem"},children:["📦 ",$s(s)]}):null})()]}),e.locked&&Ne.jsx(ce,{size:12,className:"text-warning"})]})]})]}),Ne.jsxs("div",{className:"folder-actions mt-3 d-flex gap-2 justify-content-center opacity-0",children:[Ne.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:s=>{s.stopPropagation(),_s(e)},title:"Open folder",children:Ne.jsx(E,{size:12})}),Ne.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:s=>{s.stopPropagation(),fe(e)},title:"Edit folder",children:Ne.jsx(ae,{size:12})}),Ne.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:s=>{s.stopPropagation(),Ds(ys(e))},title:"Delete folder",children:Ne.jsx(U,{size:12})})]})]})},ys(e))),Ne.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6",children:Ne.jsx("div",{className:"folder-card add-folder p-3 rounded-3 border d-flex align-items-center justify-content-center hover-lift bounce-in float",role:"button",onClick:()=>ue(!0),style:{minHeight:"80px",animationDelay:100*C.length+200+"ms"},children:Ne.jsxs("div",{className:"text-center",children:[Ne.jsx(de,{size:24,className:"text-muted mb-2"}),Ne.jsx("div",{className:"small text-muted fw-medium",children:"Add Folder"})]})})})]})})]})})}),(!Array.isArray(C)||0===C.length)&&Ne.jsx("div",{className:"mb-4",children:Ne.jsx(a,{className:"border-0 shadow-sm",children:Ne.jsxs(l,{className:"text-center py-5",children:[Ne.jsx(X,{size:48,className:"text-muted mb-3 opacity-50"}),Ne.jsx("h6",{className:"fw-bold mb-2",children:"No folders yet"}),Ne.jsx("p",{className:"text-muted mb-4",children:"Create your first folder to organize your files"}),Ne.jsxs("button",{className:"btn btn-primary",onClick:()=>ue(!0),children:[Ne.jsx(oe,{size:16,className:"me-1"}),"Create Your First Folder"]})]})})}),Ne.jsxs("div",{className:"row g-4",children:[Ne.jsx("div",{className:"col-xl-8 col-lg-7",children:Ne.jsx(Pe,{files:z||[],onFileClick:he,onViewAll:()=>{},onUpload:()=>Re.current&&Re.current.click(),onFileDelete:Is,onToggleFavorite:ds,isFavorited:ms})}),Ne.jsx("div",{className:"col-xl-4 col-lg-5",children:Ne.jsxs("div",{className:"row g-4",children:[Ne.jsx("div",{className:"col-12",children:Ne.jsx(_e,{files:z||[]})}),Ne.jsx("div",{className:"col-12",children:Ne.jsx(Ie,{files:z||[]})})]})})]})]}):Ne.jsxs("div",{className:"fade-in",children:[Ne.jsx("nav",{className:"breadcrumb-modern mb-4",children:Ne.jsxs("div",{className:"d-flex align-items-center gap-2",children:[Ne.jsx("button",{className:"btn btn-link p-0 text-decoration-none",onClick:()=>_(null),children:"Home"}),ws.map((e,s)=>Ne.jsxs(t.Fragment,{children:[Ne.jsx("span",{className:"text-muted",children:"/"}),Ne.jsx("button",{className:"btn btn-link p-0 text-decoration-none "+(s===ws.length-1?"text-primary fw-semibold":""),onClick:()=>s===ws.length-1?null:_(ys(e)),disabled:s===ws.length-1,children:e.name})]},ys(e)))]})}),Ne.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-4",children:[Ne.jsxs("div",{className:"d-flex align-items-center gap-3",children:[Ne.jsx("h4",{className:"mb-0 fw-bold",children:vs?.name||"Folder"}),Ne.jsxs("span",{className:"text-muted small",children:["(",zs.length+Fs.length," items)"]})]}),Ne.jsxs("div",{className:"d-flex align-items-center gap-2",children:[Ne.jsxs("button",{className:"btn btn-outline-primary btn-modern",onClick:()=>Re.current&&Re.current.click(),children:[Ne.jsx(I,{size:16,className:"me-1"})," Upload"]}),Ne.jsxs("button",{className:"btn btn-primary btn-modern",onClick:()=>ue(!0),children:[Ne.jsx(oe,{size:16,className:"me-1"})," New Folder"]}),Ne.jsxs(k,{children:[Ne.jsx("button",{className:"btn btn-outline-secondary "+("grid"===ve?"active":""),onClick:()=>we("grid"),children:Ne.jsx(Y,{size:16})}),Ne.jsx("button",{className:"btn btn-outline-secondary "+("list"===ve?"active":""),onClick:()=>we("list"),children:Ne.jsx(me,{size:16})})]})]})]}),Array.isArray(Fs)&&Fs.length>0&&Ne.jsxs("div",{className:"mb-5",children:[Ne.jsx("h6",{className:"text-uppercase text-muted small mb-3 fw-semibold",children:"Folders"}),Ne.jsx("div",{className:"grid"===ve?"row g-3":"list-group",children:Fs.map(e=>Ne.jsx("div",{className:"grid"===ve?"col-md-4 col-lg-3":"",children:Ne.jsx(ze,{folder:e,onClick:_s,onEdit:e=>fe(e),onDelete:e=>Ds(ys(e)),isLocked:e.locked,isUnlocked:$.has(ys(e)),hasMembers:Math.random()>.5,fileCount:Ts(ys(e)),folderSize:hs(ys(e)),totalItems:Es(ys(e)),subfolderCount:As(ys(e))})},ys(e)))})]}),Array.isArray(zs)&&zs.length>0&&Ne.jsxs("div",{children:[Ne.jsx("h6",{className:"text-uppercase text-muted small mb-3 fw-semibold",children:"Files"}),Ne.jsx("div",{className:"grid"===ve?"row g-3":"list-group",children:zs.map(e=>Ne.jsx("div",{className:"grid"===ve?"col-md-4 col-lg-3":"list-group-item",children:Ne.jsx(a,{className:"file-card "+("grid"===ve?"h-100":""),children:Ne.jsxs(l,{className:"grid"===ve?"d-flex flex-column p-3":"d-flex align-items-center gap-3 p-3",children:[Ne.jsxs("div",{className:"d-flex align-items-center gap-2 flex-grow-1",children:[Ne.jsx(T,{className:"text-muted",size:20}),Ne.jsxs("div",{className:"flex-grow-1 min-width-0",children:[Ne.jsx("div",{className:"fw-semibold text-truncate",title:e.name,children:e.name}),Ne.jsx("div",{className:"small text-muted",children:$s(e.size||0)})]})]}),Ne.jsxs("div",{className:"grid"===ve?"mt-auto d-flex gap-2":"d-flex gap-2",children:[Ne.jsx("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>he(e),title:"Preview file",children:Ne.jsx(E,{size:14})}),Ne.jsx("button",{className:"btn btn-outline-success btn-sm",onClick:()=>Ps(e),title:"Download file",children:Ne.jsx(A,{size:14})}),Ne.jsx("button",{className:"btn btn-sm "+(ms(e)?"btn-warning":"btn-outline-warning"),onClick:()=>ds(e),title:ms(e)?"Remove from Favorites":"Add to Favorites",children:Ne.jsx(L,{size:14,fill:ms(e)?"currentColor":"none"})}),Ne.jsx("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>Is(e._id||e.id),title:"Delete file",children:Ne.jsx(U,{size:14})})]})]})})},e._id||e.id))})]}),0===zs.length&&0===Fs.length&&Ne.jsxs("div",{className:"text-center py-5 text-muted",children:[Ne.jsx(T,{size:48,className:"mb-3 opacity-50"}),Ne.jsx("div",{className:"h5",children:"This folder is empty"}),Ne.jsx("div",{children:"Upload files or create folders to get started"})]})]})]})]}),G&&Ne.jsx(Le,{folder:G,onUnlock:async(e="PIN")=>{const s=G?._id||G?.id,t=G?.name;try{J(e=>new Set([...e,s])),await js("FOLDER_UNLOCK",{folderName:t,folderId:s,unlockMethod:e}),is(!0),V(null);const[i,a]=await Promise.all([fs(`/folders?parentId=${s}`),fs(`/files?folderId=${s}`)]);u(i||[]),F(a||[]),rs("folder"),_(s),ke(`🔓 Unlocked "${t}" with ${e}`,{type:"success"})}catch(i){ke(`Failed to open folder: ${i.message}`,{type:"error"})}finally{is(!1)}},onClose:()=>V(null),token:s,user:e}),K&&Ne.jsx(Ue,{file:K,onClose:()=>he(null)}),xe&&Ne.jsx(We,{onClose:()=>ue(!1),onCreate:(e,s)=>{(async()=>{try{Ye(!0),Ee(!0),ke("Creating folder...",{type:"info"});const t={name:e,parentId:P||null,locked:!!s,pinHash:s?btoa(`hashed_${s}_salted`):null},i=await fs("/folders",{method:"POST",body:JSON.stringify(t)});u(e=>[...e,i]),P||S(e=>[...e,i]),await js("FOLDER_CREATE",{folderName:e,isLocked:!!s,parentFolderId:P||"root",parentFolderName:vs?.name||"Root"}),ke(`Folder "${e}" created successfully`,{type:"success"}),await bs()}catch(t){ke("Failed to create folder: "+t.message,{type:"error"})}finally{Ye(!1),Ee(!1)}})()}}),pe&&Ne.jsx(Oe,{folder:pe,onClose:()=>fe(null),onSave:({name:e,pin:s})=>{(async()=>{try{Ee(!0);const t={name:e};s&&s.length>0?t.pinHash=btoa(`hashed_${s}_salted`):t.pinHash="";const i=await fs(`/folders/${ys(pe)}`,{method:"PATCH",body:JSON.stringify(t)});u(e=>e.map(e=>ys(e)===ys(pe)?i:e)),ke("Folder updated",{type:"success"})}catch(t){ke("Update folder failed: "+t.message,{type:"error"})}finally{Ee(!1)}})()}}),ge&&Ne.jsx(De,{user:e,token:s,onClose:()=>je(!1),onPhotoUpdate:e=>{m({profilePhoto:e})},showToast:ke}),Ne.jsx("div",{className:"fab d-grid gap-2",children:Ne.jsxs(p,{alignment:"end",direction:"dropup",children:[Ne.jsx(f,{color:"primary",className:"rounded-circle shadow",style:{width:56,height:56,padding:0,display:"flex",alignItems:"center",justifyContent:"center"},children:Ne.jsx(de,{})}),Ne.jsxs(g,{children:[Ne.jsx(j,{onClick:()=>ue(!0),children:"New Folder"}),Ne.jsx(j,{onClick:()=>Re.current&&Re.current.click(),children:"Upload File"})]})]})}),Ne.jsx(Me,{show:es.show,folder:es.folder,contentsAnalysis:es.contentsAnalysis,onCancel:()=>ss({show:!1,folder:null,contentsAnalysis:null}),onConfirm:async()=>{const{folder:e}=es;let s;s="object"==typeof e&&null!==e?e._id||e.id:e,s=String(s);try{Ee(!0),ke("Moving folder to trash...",{type:"info"});const t=JSON.parse(localStorage.getItem("sfm_trash_items")||"[]"),{fileCount:i,subfolderCount:a}=es.contentsAnalysis,l={...e,_id:s,id:s,deletedAt:(new Date).toISOString(),type:"folder",originalLocation:e.parentId?`folder-${e.parentId}`:"root",contentsInfo:{fileCount:i,subfolderCount:a,totalItems:i+a}};t.push(l),localStorage.setItem("sfm_trash_items",JSON.stringify(t)),await fs(`/folders/${s}`,{method:"DELETE"}),u(e=>e.filter(e=>(e._id||e.id)!==s)),S(e=>e.filter(e=>(e._id||e.id)!==s)),F(e=>e.filter(e=>String(e.folderId)!==String(s))),String(P)===String(s)&&(_(null),rs("dashboard")),await js("FOLDER_DELETE",{folderName:e.name,folderId:s,isLocked:e.locked||!1,parentFolderId:e.parentId||"root",contentsInfo:{fileCount:i,subfolderCount:a,totalItems:i+a},movedToTrash:!0}),await bs();const n=i>0||a>0?` and all its contents (${i} files, ${a} subfolders)`:"";ke(`Folder "${e.name}"${n} moved to trash`,{type:"success"})}catch(t){ke(`Failed to move folder to trash: ${t.message}`,{type:"error"})}finally{Ee(!1),ss({show:!1,folder:null,contentsAnalysis:null})}}}),Ne.jsx(Be,{show:Je.show,title:Je.title,message:Je.message,onCancel:()=>He({show:!1,title:"",message:"",onConfirm:null}),onConfirm:()=>{const e=Je.onConfirm;e&&e()}})]})})}"serviceWorker"in navigator&&(window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{e.addEventListener("updatefound",()=>{const s=e.installing;s&&s.addEventListener("statechange",()=>{"installed"===s.state&&navigator.serviceWorker.controller})})}).catch(e=>{})}),navigator.serviceWorker.addEventListener("message",e=>{const{type:s,fileName:t,offline:i}=e.data})),ve.createRoot(document.getElementById("root")).render(Ne.jsx(t.StrictMode,{children:Ne.jsx(Se,{children:Ne.jsx(Re,{})})}));
