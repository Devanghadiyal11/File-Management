import{r as e,b as s,R as t}from"./vendor-react-zHXwu4Hr.js";import{S as i,A as a,U as l,a as n,F as r,b as o,E as c,D as d,c as m,T as h,V as x,M as u,I as p,d as f,C as g,X as j,e as b,P as N,f as y,R as v,H as w,u as k,G as C,g as S,h as z,i as F,B as P,j as _,L as I,k as D,l as $,m as T,n as E,o as A,p as L,q as U,r as O,s as W,t as B,v as M}from"./vendor-utils-CRE_FECv.js";import{C as R,a as J,b as H,c as G,d as V,e as K,f as q,g as Q,h as Y,i as X,j as Z,k as ee,l as se,m as te,n as ie,o as ae,p as le,q as ne,r as re,s as oe,t as ce,u as de,v as me,w as he,x as xe}from"./vendor-ui-DWnkR9l5.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)}).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();var ue={exports:{}},pe={},fe=e,ge=Symbol.for("react.element"),je=Symbol.for("react.fragment"),be=Object.prototype.hasOwnProperty,Ne=fe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ye={key:!0,ref:!0,__self:!0,__source:!0};function ve(e,s,t){var i,a={},l=null,n=null;for(i in void 0!==t&&(l=""+t),void 0!==s.key&&(l=""+s.key),void 0!==s.ref&&(n=s.ref),s)be.call(s,i)&&!ye.hasOwnProperty(i)&&(a[i]=s[i]);if(e&&e.defaultProps)for(i in s=e.defaultProps)void 0===a[i]&&(a[i]=s[i]);return{$$typeof:ge,type:e,key:l,ref:n,props:a,_owner:Ne.current}}pe.Fragment=je,pe.jsx=ve,pe.jsxs=ve,ue.exports=pe;var we,ke=ue.exports,Ce=s;we=Ce.createRoot,Ce.hydrateRoot;const Se=[{key:"title",getter:e=>e.getTitle()},{key:"html",getter:e=>e.getHtmlContainer()},{key:"confirmButtonText",getter:e=>e.getConfirmButton()},{key:"denyButtonText",getter:e=>e.getDenyButton()},{key:"cancelButtonText",getter:e=>e.getCancelButton()},{key:"footer",getter:e=>e.getFooter()},{key:"closeButtonHtml",getter:e=>e.getCloseButton()},{key:"iconHtml",getter:e=>e.getIconContent()},{key:"loaderHtml",getter:e=>e.getLoader()}],ze=()=>{};const Fe=e.createContext(null),Pe=({children:s})=>{const a=e.useMemo(()=>function(e){function s(e){const s={},i={},a=Se.map(e=>e.key);return Object.entries(e).forEach(e=>{let[l,n]=e;a.includes(l)&&t.isValidElement(n)?(s[l]=n,i[l]=" "):i[l]=n}),[s,i]}function i(s,t){Object.entries(t).forEach(t=>{let[i,a]=t;const l=Se.find(e=>e.key===i).getter(e),n=we(l);n.render(a),s.__roots.push(n)})}function a(e){e.__roots.forEach(e=>{e.unmount()}),e.__roots=[]}return class extends e{static argsToParams(s){if(t.isValidElement(s[0])||t.isValidElement(s[1])){const e={};return["title","html","icon"].forEach((t,i)=>{void 0!==s[i]&&(e[t]=s[i])}),e}return e.argsToParams(s)}_main(e,t){this.__roots=[],this.__params=Object.assign({},t,e);const[l,n]=s(this.__params),r=n.willOpen||ze,o=n.didOpen||ze,c=n.didDestroy||ze;return super._main(Object.assign({},n,{willOpen:e=>{i(this,l),r(e)},didOpen:e=>{setTimeout(()=>{o(e)})},didDestroy:e=>{c(e),a(this)}}))}update(e){Object.assign(this.__params,e),a(this);const[t,l]=s(this.__params);super.update(l),i(this,t)}}}(i),[]),l=e.useMemo(()=>a.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timerProgressBar:!0,didOpen:e=>{e.addEventListener("mouseenter",i.stopTimer),e.addEventListener("mouseleave",i.resumeTimer)}}),[a]),n=e.useCallback((e,{type:s="info",duration:t=4e3}={})=>{const i="error"===s?"error":"success"===s?"success":"warning"===s?"warning":"info",a="success"===s?Math.min(t,3e3):t;l.fire({icon:i,title:e,timer:a})},[l]),r=e.useCallback(()=>{},[]);return ke.jsx(Fe.Provider,{value:{showToast:n,removeToast:r},children:s})},_e=({folder:e,onClick:s,onEdit:t,onDelete:i,isLocked:l,hasMembers:n,fileCount:r,folderSize:o,totalItems:c,subfolderCount:d,isUnlocked:m})=>{const h=n?Math.floor(10*Math.random())+1:0;return ke.jsx(R,{className:"folder-card h-100 fade-in",role:"button",onClick:()=>s(e),children:ke.jsxs(J,{className:"p-3",children:[ke.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[ke.jsxs("div",{className:"d-flex align-items-center gap-2",children:[ke.jsx("div",{className:"storage-icon documents",children:ke.jsx(a,{size:18})}),ke.jsxs("div",{className:"flex-grow-1 min-width-0",children:[ke.jsxs("h6",{className:"mb-0 fw-semibold text-truncate",children:[e.name,c>0&&ke.jsxs("span",{className:"text-muted fw-normal ms-2",children:["(",c," item",1!==c?"s":"",")"]})]}),ke.jsxs("div",{className:"d-flex flex-column",children:[(r>0||d>0)&&ke.jsxs("small",{className:"text-muted",children:[r>0&&`${r} file${1!==r?"s":""}`,r>0&&d>0&&" â€¢ ",d>0&&`${d} folder${1!==d?"s":""}`]}),o>0&&ke.jsxs("small",{className:"text-muted fw-semibold",style:{color:"#059669",fontSize:"0.8rem"},children:["ðŸ“¦ ",(x=o,x&&0!==x?x<1024?`${Math.round(x)} B`:x<1048576?`${(x/1024).toFixed(1)} KB`:x<1073741824?`${(x/1048576).toFixed(1)} MB`:`${(x/1073741824).toFixed(1)} GB`:"0 B")]})]})]})]}),l&&ke.jsx(H,{color:"warning",className:"small",children:"Locked"})]}),h>0&&ke.jsx("div",{className:"d-flex align-items-center justify-content-between",children:ke.jsxs("div",{className:"d-flex align-items-center gap-1",children:[ke.jsx("div",{className:"d-flex",style:{marginLeft:"-4px"},children:[...Array(Math.min(h,3))].map((e,s)=>ke.jsx("div",{className:"rounded-circle bg-primary d-flex align-items-center justify-content-center text-white",style:{width:"24px",height:"24px",fontSize:"10px",marginLeft:s>0?"-4px":"0",zIndex:3-s,border:"2px solid white"},children:String.fromCharCode(65+s)},s))}),h>3&&ke.jsxs("span",{className:"small text-muted ms-1",children:["+",h-3]})]})})]})});var x},Ie=({files:e=[]})=>{const s=(e=>{const s={documents:{count:0,size:0,icon:f,color:"#6B7280",bgColor:"#F3F4F6"},photos:{count:0,size:0,icon:p,color:"#3B82F6",bgColor:"#DBEAFE"},audio:{count:0,size:0,icon:u,color:"#10B981",bgColor:"#D1FAE5"},videos:{count:0,size:0,icon:x,color:"#F59E0B",bgColor:"#FEF3C7"}};return e.forEach(e=>{const t=e.type||"",i=e.size||0;t.startsWith("image/")?(s.photos.count++,s.photos.size+=i):t.startsWith("audio/")?(s.audio.count++,s.audio.size+=i):t.startsWith("video/")?(s.videos.count++,s.videos.size+=i):(s.documents.count++,s.documents.size+=i)}),s})(e);return ke.jsx("div",{className:"row g-3 mb-4",children:Object.entries(s).map(([e,s],t)=>{const i=s.icon,a=(l=s.size)<1024?`${l} B`:l<1048576?`${(l/1024).toFixed(1)} KB`:l<1073741824?`${(l/1048576).toFixed(1)} MB`:`${(l/1073741824).toFixed(1)} GB`;var l;return ke.jsx("div",{className:"col-md-3 col-sm-6",children:ke.jsx(R,{className:"h-100 border-0 shadow-sm hover-lift hover-glow scale-in stagger-item",style:{animationDelay:150*t+"ms"},children:ke.jsxs(J,{className:"p-4",children:[ke.jsx("div",{className:"d-flex align-items-center justify-content-between mb-3",children:ke.jsx("div",{className:"rounded-3 p-3 d-flex align-items-center justify-content-center",style:{backgroundColor:s.bgColor,width:"56px",height:"56px"},children:ke.jsx(i,{size:24,style:{color:s.color}})})}),ke.jsxs("div",{children:[ke.jsxs("div",{className:"h5 fw-bold mb-1 counter-animate",style:{color:s.color},children:["Total ",a]}),ke.jsx("div",{className:"text-capitalize fw-semibold mb-0 slide-up",children:e}),ke.jsxs("small",{className:"text-muted fade-in",children:[s.count," files"]})]})]})})},e)})})},De=({files:e=[],onFileClick:s,onViewAll:t,onUpload:i,onFileDelete:a,onToggleFavorite:g,isFavorited:j})=>{const b=e.sort((e,s)=>new Date(s.uploadDate||s.createdAt)-new Date(e.uploadDate||e.createdAt)).slice(0,6),N=e=>{const s=e.type||"";return s.startsWith("image/")?ke.jsx(p,{size:16,className:"text-primary"}):s.includes("pdf")?ke.jsx(f,{size:16,className:"text-danger"}):s.includes("document")?ke.jsx(f,{size:16,className:"text-primary"}):s.startsWith("video/")?ke.jsx(x,{size:16,className:"text-warning"}):s.startsWith("audio/")?ke.jsx(u,{size:16,className:"text-success"}):ke.jsx(o,{size:16,className:"text-muted"})};return ke.jsx(R,{className:"border-0 shadow-sm",children:ke.jsxs(J,{className:"p-0",children:[ke.jsx("div",{className:"p-4 border-bottom",children:ke.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[ke.jsx("h5",{className:"mb-0 fw-bold",children:"Recent Files"}),ke.jsxs("div",{className:"d-flex align-items-center gap-2",children:[ke.jsxs("button",{className:"btn btn-sm btn-primary hover-lift",onClick:i,title:"Upload Files",children:[ke.jsx(l,{size:14,className:"me-1",style:{transition:"transform 0.2s ease"},onMouseEnter:e=>e.target.style.transform="rotate(10deg)",onMouseLeave:e=>e.target.style.transform="rotate(0deg)"}),"Upload"]}),ke.jsx("button",{className:"btn btn-sm btn-outline-secondary",children:ke.jsx(n,{size:14})}),ke.jsx("button",{className:"btn btn-sm btn-outline-secondary",children:ke.jsx(r,{size:14})})]})]})}),ke.jsx("div",{className:"p-4",children:ke.jsx("div",{className:"row g-3",children:0===b.length?ke.jsxs("div",{className:"col-12 text-center py-4 text-muted",children:[ke.jsx(o,{size:32,className:"mb-2 opacity-50"}),ke.jsx("div",{children:"No recent files"})]}):b.map((e,t)=>{return ke.jsx("div",{className:"col-md-6 col-lg-4",children:ke.jsx(R,{className:"border file-preview-card h-100 hover-lift hover-glow scale-in stagger-item",role:"button",onClick:()=>s&&s(e),style:{animationDelay:100*t+"ms"},children:ke.jsxs(J,{className:"p-3",children:[ke.jsx("div",{className:"rounded-2 mb-3 d-flex align-items-center justify-content-center position-relative",style:{height:"120px",backgroundColor:"#f8f9fa"},children:e.type?.startsWith("image/")&&e.url?ke.jsx("img",{src:e.url,alt:e.name,className:"img-fluid rounded-2",style:{maxHeight:"100%",maxWidth:"100%",objectFit:"cover"}}):ke.jsxs("div",{className:"text-center",children:[N(e),ke.jsx("div",{className:"mt-2",children:ke.jsx("small",{className:"text-muted text-uppercase",children:e.name?.split(".").pop()||"FILE"})})]})}),ke.jsxs("div",{className:"mb-3",children:[ke.jsx("div",{className:"fw-semibold text-truncate mb-1",title:e.name,children:e.name}),ke.jsx("div",{className:"text-muted small",children:ke.jsxs("span",{children:["Last Modified on ",(i=e.uploadDate||e.createdAt,i?new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(new Date(i)):"Unknown")]})})]}),ke.jsxs("div",{className:"d-flex align-items-center justify-content-between border-top pt-3",children:[ke.jsxs("div",{className:"d-flex gap-2",children:[ke.jsx("button",{className:"btn btn-sm btn-outline-primary d-flex align-items-center gap-1",onClick:t=>{t.stopPropagation(),s&&s(e)},title:"Preview File",children:ke.jsx(c,{size:14})}),ke.jsx("button",{className:"btn btn-sm btn-outline-secondary d-flex align-items-center gap-1",onClick:e=>e.stopPropagation(),title:"Download File",children:ke.jsx(d,{size:14})}),ke.jsx("button",{className:"btn btn-sm d-flex align-items-center gap-1 "+(j&&j(e)?"btn-warning":"btn-outline-warning"),onClick:s=>{s.stopPropagation(),g&&g(e)},title:j&&j(e)?"Remove from Favorites":"Add to Favorites",children:ke.jsx(m,{size:14,fill:j&&j(e)?"currentColor":"none"})}),ke.jsx("button",{className:"btn btn-sm btn-outline-danger d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),a&&a(e)},title:"Delete File",children:ke.jsx(h,{size:14})})]}),ke.jsx("small",{className:"text-muted",children:e.size?`${(e.size/1048576).toFixed(1)} MB`:"0 MB"})]})]})})},e._id||e.id||t);var i})})})]})})},$e=({files:e=[]})=>{const s=e=>e<1073741824?`${(e/1048576).toFixed(1)} MB`:`${(e/1073741824).toFixed(1)} GB`,t=e.reduce((e,s)=>e+(s.size||0),0);const i=t/21474836480*100,a=e.reduce((e,s)=>{const t=s.type||"",i=s.size||0;return t.startsWith("video/")?e.video+=i:t.startsWith("audio/")?e.audio+=i:t.startsWith("image/")?e.photos+=i:e.documents+=i,e},{video:0,audio:0,photos:0,documents:0});return ke.jsx(R,{className:"border-0 shadow-sm",children:ke.jsxs(J,{className:"p-4",children:[ke.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-4",children:[ke.jsxs("div",{children:[ke.jsx("h6",{className:"mb-1",children:"Storage Usage"}),ke.jsx(H,{color:"success",className:"small",children:ke.jsxs("div",{className:"d-flex align-items-center gap-1",children:[ke.jsx("div",{className:"bg-success rounded-circle",style:{width:"6px",height:"6px"}}),"Live"]})})]}),ke.jsxs("div",{className:"text-muted small",children:[i.toFixed(1),"% of 20GB used"]})]}),ke.jsx("div",{className:"text-center mb-4",children:ke.jsxs("div",{className:"position-relative d-inline-block",children:[ke.jsxs("svg",{width:"200",height:"200",className:"donut-chart",children:[ke.jsx("circle",{cx:"100",cy:"100",r:"70",fill:"none",stroke:"#f1f5f9",strokeWidth:"20"}),ke.jsx("circle",{cx:"100",cy:"100",r:"70",fill:"none",stroke:"url(#gradient1)",strokeWidth:"20",strokeDasharray:`${2*Math.PI*70*(i/100)} ${2*Math.PI*70}`,strokeLinecap:"round",transform:"rotate(-90 100 100)"}),ke.jsx("defs",{children:ke.jsxs("linearGradient",{id:"gradient1",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[ke.jsx("stop",{offset:"0%",stopColor:"var(--color-primary)"}),ke.jsx("stop",{offset:"50%",stopColor:"var(--color-accent)"}),ke.jsx("stop",{offset:"100%",stopColor:"#059669"})]})})]}),ke.jsxs("div",{className:"position-absolute top-50 start-50 translate-middle text-center",children:[ke.jsxs("div",{className:"h5 fw-bold mb-1",children:[i.toFixed(1),"%"]}),ke.jsx("small",{className:"text-muted",children:"Used"}),ke.jsx("div",{className:"mt-1",children:ke.jsx("small",{className:"text-muted",children:s(t)})})]})]})}),ke.jsxs("div",{className:"mb-4",children:[ke.jsx("h6",{className:"fw-bold mb-3",children:"Overview"}),ke.jsx("div",{className:"row g-2",children:[{label:"Videos",value:s(a.video),color:"var(--color-danger)"},{label:"Audio",value:s(a.audio),color:"var(--color-primary)"},{label:"Photos",value:s(a.photos),color:"var(--color-accent)"},{label:"Documents",value:s(a.documents),color:"var(--color-warning)"}].map((e,s)=>ke.jsx("div",{className:"col-6",children:ke.jsxs("div",{className:"d-flex align-items-center gap-2",children:[ke.jsx("div",{className:"rounded-circle",style:{width:"12px",height:"12px",backgroundColor:e.color}}),ke.jsxs("div",{className:"flex-grow-1 min-width-0",children:[ke.jsx("small",{className:"text-muted",children:e.label}),ke.jsx("div",{className:"fw-semibold small",children:e.value})]})]})},s))})]})]})})},Te=({files:e=[]})=>{const s=e.sort((e,s)=>(s.size||0)-(e.size||0)).slice(0,5),t=e=>{const s=e.type||"";return s.startsWith("video/")?ke.jsx(x,{size:16,className:"text-warning"}):s.startsWith("image/")?ke.jsx(p,{size:16,className:"text-primary"}):s.startsWith("audio/")?ke.jsx(u,{size:16,className:"text-success"}):ke.jsx(f,{size:16,className:"text-muted"})};return ke.jsx(R,{className:"border-0 shadow-sm",children:ke.jsxs(J,{className:"p-0",children:[ke.jsx("div",{className:"p-4 border-bottom",children:ke.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[ke.jsx("h6",{className:"mb-0 fw-bold",children:"Largest files"}),ke.jsx("button",{className:"btn btn-sm btn-outline-secondary",children:ke.jsx(n,{size:14})})]})}),ke.jsx("div",{className:"p-4",children:0===s.length?ke.jsxs("div",{className:"text-center py-4 text-muted",children:[ke.jsx(o,{size:32,className:"mb-2 opacity-50"}),ke.jsx("div",{children:"No files"})]}):ke.jsx("div",{className:"d-flex flex-column gap-3",children:s.map((e,s)=>{return ke.jsxs("div",{className:"d-flex align-items-center gap-3 p-2 rounded-2 hover-bg-light",role:"button",children:[t(e),ke.jsx("div",{className:"flex-grow-1 min-width-0",children:ke.jsx("div",{className:"fw-semibold text-truncate small",children:e.name})}),ke.jsx("div",{className:"text-end",children:ke.jsx("div",{className:"fw-semibold small",children:(i=e.size||0,i<1048576?`${Math.round(i/1024)} KB`:i<1073741824?`${Math.round(i/1048576)} MB`:`${(i/1073741824).toFixed(1)} GB`)})})]},e._id||e.id||s);var i})})})]})})},Ee=({user:s,onClose:t,onPhotoUpdate:i,showToast:a,token:n})=>{const[r,o]=e.useState(null),[c,d]=e.useState(s?.profilePhoto||null),[m,x]=e.useState(!1),[u,p]=e.useState(""),f=e.useRef(null),y="/api",v=e.useCallback(e=>{const s=e.target.files?.[0];if(!s)return;const t=[".jpg",".jpeg",".png",".gif",".webp",".bmp",".heic",".heif"],i=s.name.toLowerCase(),a=i.substring(i.lastIndexOf(".")),l=s.type&&["image/jpeg","image/jpg","image/png","image/gif","image/webp","image/bmp","image/heic","image/heif"].includes(s.type.toLowerCase()),n=t.includes(a);if(!l&&!n)return void p(`Please select a valid image file (${t.join(", ")})`);if(s.size>20971520)return void p("Image size must be less than 20MB");p(""),o(s);const r=new FileReader;r.onload=e=>{d(e.target.result)},r.readAsDataURL(s)},[]),w=e.useCallback(e=>{e.preventDefault(),e.stopPropagation();const s=e.dataTransfer.files;if(s.length>0){const e=s[0],t=["image/jpeg","image/jpg","image/png","image/gif","image/webp","image/bmp","image/heic","image/heif"],i=[".jpg",".jpeg",".png",".gif",".webp",".bmp",".heic",".heif"],a=e.name.toLowerCase(),l=a.substring(a.lastIndexOf(".")),n=e.type&&t.includes(e.type.toLowerCase()),r=i.includes(l);n||r?v({target:{files:[e]}}):p(`Please drop a valid image file (${i.join(", ")})`)}},[v]),k=e=>new Promise(s=>{const t=new FileReader;t.onload=e=>s(e.target.result),t.readAsDataURL(e)}),C=e=>new Promise(s=>{const t=document.createElement("canvas"),i=t.getContext("2d"),a=new Image;a.onload=()=>{const e=1024;let{width:l,height:n}=a;l>n?l>e&&(n=n*e/l,l=e):n>e&&(l=l*e/n,n=e);const r=window.devicePixelRatio||1;t.width=l*r,t.height=n*r,t.style.width=l+"px",t.style.height=n+"px",i.scale(r,r),i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(a,0,0,l,n),t.toBlob(s,"image/jpeg",.95)},a.src=URL.createObjectURL(e)});return ke.jsxs(G,{visible:!0,onClose:t,alignment:"center",size:"lg",children:[ke.jsx(V,{children:ke.jsxs(K,{className:"d-flex align-items-center gap-2",children:[ke.jsx(g,{size:20}),"Profile Photo"]})}),ke.jsx(q,{children:ke.jsxs("div",{className:"text-center",children:[ke.jsx("div",{className:"mb-4",children:ke.jsx("div",{className:"position-relative d-inline-block",children:c?ke.jsxs("div",{className:"position-relative",children:[ke.jsx("img",{src:c,alt:"Profile preview",className:"rounded-circle border",style:{width:"180px",height:"180px",objectFit:"cover",border:"3px solid var(--color-border-glass)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.1)",imageRendering:"high-quality"}}),r&&ke.jsx("div",{className:"position-absolute top-0 end-0",children:ke.jsx("button",{type:"button",className:"btn btn-sm btn-danger rounded-circle p-1",onClick:()=>{o(null),d(s?.profilePhoto||null),p(""),f.current&&(f.current.value="")},style:{width:"24px",height:"24px"},children:ke.jsx(j,{size:12})})})]}):ke.jsx("div",{className:"rounded-circle border d-flex align-items-center justify-content-center bg-light",style:{width:"180px",height:"180px",border:"3px solid var(--color-border-glass)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.1)"},children:ke.jsx(b,{size:72,className:"text-muted"})})})}),ke.jsxs("div",{className:"border-2 border-dashed rounded-3 p-4 mb-3 text-center",style:{borderColor:r?"var(--color-primary)":"var(--color-border)",backgroundColor:r?"rgba(102, 126, 234, 0.05)":"var(--color-bg-light)"},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:w,children:[ke.jsx("input",{ref:f,type:"file",accept:"image/*,.heic,.heif",onChange:v,className:"d-none"}),ke.jsx(l,{size:32,className:"text-muted mb-2"}),ke.jsx("div",{className:"h6 mb-2",children:r?"New photo selected":"Choose a profile photo"}),ke.jsx("div",{className:"text-muted small mb-3",children:"Drag and drop an image here, or click to browse"}),ke.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>f.current?.click(),disabled:m,children:[ke.jsx(l,{size:16,className:"me-1"}),"Browse Files"]}),ke.jsx("div",{className:"text-muted small mt-2",children:"Supports JPG, JPEG, PNG, GIF, WebP, BMP, HEIC, HEIF. Max size 20MB."})]}),u&&ke.jsx(Q,{color:"danger",className:"py-2 text-start",children:u}),ke.jsxs("div",{className:"d-flex gap-2 justify-content-center",children:[r&&ke.jsx("button",{type:"button",className:"btn btn-success",onClick:async()=>{if(r||c){x(!0),p("");try{let l=c;if(r){const e=await C(r);l=await k(e)}try{const e=new FormData;if(r){const s=await C(r);e.append("profilePhoto",s)}const s=await fetch(`${y}/auth/profile-photo`,{method:"POST",headers:{Authorization:`Bearer ${n}`},body:e});if(s.ok){const e=await s.json();return i&&i(e.profilePhoto),a?.("Profile photo updated successfully!",{type:"success"}),void t()}}catch(e){}const o=`profilePhoto_${s?.email||s?.id||"default"}`;localStorage.setItem(o,l),i&&i(l),a?.("Profile photo updated successfully! (Stored locally)",{type:"success"}),t()}catch(err){p(err.message||"Failed to upload profile photo"),a?.(`Upload failed: ${err.message}`,{type:"error"})}finally{x(!1)}}else p("Please select an image first")},disabled:m,children:m?ke.jsxs(ke.Fragment,{children:[ke.jsx(Y,{size:"sm",className:"me-1"}),"Uploading..."]}):ke.jsxs(ke.Fragment,{children:[ke.jsx(l,{size:16,className:"me-1"}),"Upload Photo"]})}),c&&s?.profilePhoto&&!r&&ke.jsxs(ke.Fragment,{children:[ke.jsxs("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>f.current?.click(),disabled:m,children:[ke.jsx(N,{size:16,className:"me-1"}),"Change Photo"]}),ke.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:async()=>{x(!0),p("");try{try{if((await fetch(`${y}/auth/profile-photo`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}})).ok)return i&&i(null),a?.("Profile photo deleted successfully!",{type:"success"}),void t()}catch(e){}const l=`profilePhoto_${s?.email||s?.id||"default"}`;localStorage.removeItem(l),i&&i(null),a?.("Profile photo deleted successfully! (Removed locally)",{type:"success"}),t()}catch(err){p(err.message||"Failed to delete profile photo"),a?.(`Delete failed: ${err.message}`,{type:"error"})}finally{x(!1)}},disabled:m,children:m?ke.jsxs(ke.Fragment,{children:[ke.jsx(Y,{size:"sm",className:"me-1"}),"Deleting..."]}):ke.jsxs(ke.Fragment,{children:[ke.jsx(h,{size:16,className:"me-1"}),"Delete Photo"]})})]})]}),ke.jsx("div",{className:"text-muted small mt-3",children:"Your profile photo will be visible to other team members and in shared folders."})]})}),ke.jsx(X,{children:ke.jsx(Z,{color:"secondary",variant:"outline",onClick:t,children:"Cancel"})})]})};class Ae extends t.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,s){this.setState({error:e,errorInfo:s})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){if(this.state.hasError){const e=!1;return ke.jsx("div",{className:"min-vh-100 d-flex align-items-center justify-content-center p-4",children:ke.jsx(R,{className:"shadow-sm",style:{maxWidth:"500px",width:"100%"},children:ke.jsxs(J,{className:"text-center p-4",children:[ke.jsxs("div",{className:"mb-4",children:[ke.jsx(y,{size:64,className:"text-warning mb-3"}),ke.jsx("h3",{className:"text-danger mb-2",children:"Oops! Something went wrong"}),ke.jsx("p",{className:"text-muted",children:"We encountered an unexpected error. This usually happens when there's a problem loading data or rendering the interface."})]}),e,ke.jsxs("div",{className:"d-flex gap-2 justify-content-center",children:[ke.jsxs(Z,{color:"primary",onClick:this.handleReset,className:"d-flex align-items-center gap-2",children:[ke.jsx(v,{size:16}),"Try Again"]}),ke.jsxs(Z,{color:"outline-secondary",onClick:()=>window.location.reload(),className:"d-flex align-items-center gap-2",children:[ke.jsx(w,{size:16}),"Reload Page"]})]}),ke.jsx("div",{className:"mt-4",children:ke.jsx("small",{className:"text-muted",children:"If this problem persists, try refreshing the page or clearing your browser cache."})})]})})})}return this.props.children}}const Le=new class{constructor(){this.workers=new Map,this.workerPools=new Map,this.taskQueue=new Map,this.activeJobs=new Map,this.workerStats=new Map,this.cpuCores=navigator.hardwareConcurrency||4,this.workerConfigs={fileProcessor:{script:new URL("/assets/fileProcessor-FUSmGNhb.js",import.meta.url),poolSize:Math.min(this.cpuCores,4),maxRetries:3,timeout:3e4}},this.initialized=!1,this.initPromise=null}async initialize(){if(!this.initialized){if(this.initPromise)return this.initPromise;this.initPromise=this.doInitialize(),await this.initPromise,this.initialized=!0}}async doInitialize(){for(const[e,s]of Object.entries(this.workerConfigs))await this.createWorkerPool(e,s);this.startPerformanceMonitoring()}async createWorkerPool(e,s){const t=[],i={created:Date.now(),tasksCompleted:0,tasksErrored:0,totalProcessingTime:0,averageProcessingTime:0,activeWorkers:0};for(let l=0;l<s.poolSize;l++)try{const i={id:`${e}-${l}`,worker:new Worker(s.script,{type:"module",name:`${e}-${l}`}),busy:!1,tasksProcessed:0,errors:0,created:Date.now(),lastUsed:null};this.setupWorkerHandlers(i,e),t.push(i)}catch(a){}this.workerPools.set(e,t),this.workerStats.set(e,i),this.taskQueue.set(e,[])}setupWorkerHandlers(e,s){const{worker:t,id:i}=e;t.addEventListener("message",e=>{const{type:t,taskId:a,result:l,error:n,processingTime:r}=e.data;switch(t){case"result":case"task_complete":this.handleTaskComplete(i,s,a,l,r);break;case"error":case"task_error":this.handleTaskError(i,s,a,n,r)}}),t.addEventListener("error",t=>{this.handleWorkerError(e,s,t)}),t.addEventListener("messageerror",e=>{})}async executeTask(e,s,t,i={}){await this.initialize();const a=`${e}_${s}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l=i.timeout||this.workerConfigs[e]?.timeout||3e4;return new Promise((n,r)=>{const o={taskId:a,workerType:e,operation:s,data:t,options:i,resolve:n,reject:r,created:Date.now(),retries:0,maxRetries:this.workerConfigs[e]?.maxRetries||3};o.timeoutId=setTimeout(()=>{this.handleTaskTimeout(o)},l),this.activeJobs.set(a,o);if(!this.tryAssignTask(o)){(this.taskQueue.get(e)||[]).push(o)}})}tryAssignTask(e){const s=this.workerPools.get(e.workerType);if(!s)return!1;const t=s.find(e=>!e.busy);return!!t&&(this.assignTaskToWorker(e,t),!0)}assignTaskToWorker(e,s){s.busy=!0,s.lastUsed=Date.now(),s.currentTask=e.taskId;const t={type:e.operation,data:e.data,options:e.options,taskId:e.taskId};s.worker.postMessage(t)}handleTaskComplete(e,s,t,i,a){const l=this.activeJobs.get(t);l&&(l.timeoutId&&clearTimeout(l.timeoutId),this.updateWorkerStats(s,e,a,!1),this.markWorkerAvailable(s,e),l.resolve(i),this.activeJobs.delete(t),this.processNextTask(s))}handleTaskError(e,s,t,i,a){const l=this.activeJobs.get(t);if(l){if(this.updateWorkerStats(s,e,a,!0),this.markWorkerAvailable(s,e),l.retries<l.maxRetries){l.retries++;if(!this.tryAssignTask(l)){(this.taskQueue.get(s)||[]).unshift(l)}return}l.timeoutId&&clearTimeout(l.timeoutId),l.reject(new Error(`Task failed after ${l.maxRetries} retries: ${i}`)),this.activeJobs.delete(t),this.processNextTask(s)}}handleTaskTimeout(e){const s=this.workerPools.get(e.workerType);if(s){const t=s.find(s=>s.currentTask===e.taskId);t&&this.markWorkerAvailable(e.workerType,t.id)}if(e.retries<e.maxRetries){e.retries++;if(!this.tryAssignTask(e)){(this.taskQueue.get(e.workerType)||[]).unshift(e)}}else e.reject(new Error(`Task timed out after ${e.maxRetries} retries`)),this.activeJobs.delete(e.taskId)}markWorkerAvailable(e,s){const t=this.workerPools.get(e);if(!t)return;const i=t.find(e=>e.id===s);i&&(i.busy=!1,i.currentTask=null)}processNextTask(e){const s=this.taskQueue.get(e);if(!s||0===s.length)return;const t=s.shift();this.tryAssignTask(t)||s.unshift(t)}updateWorkerStats(e,s,t,i){const a=this.workerStats.get(e),l=this.workerPools.get(e);if(a&&l){i?a.tasksErrored++:(a.tasksCompleted++,a.totalProcessingTime+=t||0,a.averageProcessingTime=a.totalProcessingTime/a.tasksCompleted);const e=l.find(e=>e.id===s);e&&(i?e.errors++:e.tasksProcessed++)}}handleWorkerError(e,s,t){this.recreateWorker(e,s)}async recreateWorker(e,s){const t=this.workerConfigs[s],i=this.workerPools.get(s);if(t&&i)try{e.worker.terminate();const a=new Worker(t.script,{type:"module",name:e.id}),l={...e,worker:a,busy:!1,currentTask:null,created:Date.now()};this.setupWorkerHandlers(l,s);const n=i.findIndex(s=>s.id===e.id);-1!==n&&(i[n]=l)}catch(a){}}startPerformanceMonitoring(){setInterval(()=>{this.logPerformanceStats()},3e4)}logPerformanceStats(){for(const[e,s]of this.workerStats.entries()){const s=this.workerPools.get(e);s&&s.filter(e=>e.busy).length,this.taskQueue.get(e)}}getStats(){const e={};for(const[s,t]of this.workerStats.entries()){const i=this.workerPools.get(s),a=i?i.filter(e=>e.busy).length:0,l=this.taskQueue.get(s)?.length||0;e[s]={...t,activeWorkers:a,queueLength:l,totalWorkers:i?.length||0,successRate:t.tasksCompleted/(t.tasksCompleted+t.tasksErrored)||0}}return e}async processFile(e,s,t){return this.executeTask("fileProcessor","process_file",{file:s,operation:e,options:t},t)}destroy(){for(const e of this.activeJobs.values())e.timeoutId&&clearTimeout(e.timeoutId);for(const e of this.workerPools.values())for(const s of e)s.worker.terminate();this.workers.clear(),this.workerPools.clear(),this.taskQueue.clear(),this.activeJobs.clear(),this.workerStats.clear(),this.initialized=!1}};(()=>{const e=[];for(let s=0;s<localStorage.length;s++){const t=localStorage.key(s);t&&(t.includes("sfm_face_")||t.includes("face_descriptor")||t.includes("face_profile")||t.includes("face_mongodb"))&&e.push(t)}e.forEach(e=>{localStorage.removeItem(e)}),e.length})();const Ue=(e,s)=>(e=>btoa(`hashed_${e}_salted`))(e)===s,Oe=({onSignIn:s,onSignUp:t})=>{const[i,a]=e.useState(!1),[l,n]=e.useState(""),[r,o]=e.useState(""),[c,d]=e.useState(""),m=async()=>{if(l&&r)try{i?await t(l,r):await s(l,r)}catch(e){d(e.message)}};return ke.jsx(de,{className:"min-vh-100 d-flex align-items-center justify-content-center py-4",children:ke.jsx(ae,{className:"w-100 justify-content-center",children:ke.jsx(le,{xs:12,sm:10,md:8,lg:5,xl:4,children:ke.jsxs(R,{className:"shadow-sm",children:[ke.jsxs(ne,{className:"text-center py-4",children:[ke.jsx(me,{color:"primary",textColor:"white",children:"SFM"}),ke.jsx("h3",{className:"mt-2 mb-0",children:"Secure File Manager"}),ke.jsx("small",{className:"text-body-secondary",children:"Your files, protected and organized"})]}),ke.jsx(J,{children:ke.jsxs(he,{onSubmit:e=>{e.preventDefault(),m()},children:[ke.jsxs("div",{className:"mb-3",children:[ke.jsx("label",{className:"form-label",children:"Email"}),ke.jsx(xe,{type:"email",value:l,onChange:e=>n(e.target.value),onKeyDown:e=>"Enter"===e.key&&m(),required:!0,autoFocus:!0})]}),ke.jsxs("div",{className:"mb-3",children:[ke.jsx("label",{className:"form-label",children:"Password"}),ke.jsx(xe,{type:"password",value:r,onChange:e=>o(e.target.value),onKeyDown:e=>"Enter"===e.key&&m(),required:!0})]}),c&&ke.jsx(Q,{color:"danger",className:"text-center py-2",children:c}),ke.jsx(Z,{color:"primary",className:"w-100 mt-2",size:"lg",onClick:m,children:i?"Sign Up":"Sign In"}),ke.jsx("div",{className:"text-center mt-3",children:ke.jsx(Z,{color:"link",className:"text-decoration-none",onClick:()=>a(!i),children:i?"Already have an account? Sign In":"Don't have an account? Sign Up"})})]})})]})})})})},We=({folder:s,onClose:t,onUnlock:i,user:a,token:l})=>{const[n,r]=e.useState(""),[o,c]=e.useState(0),[d,m]=e.useState(""),[h,x]=e.useState(!1),u=async()=>{if(4===n.length){x(!0),m("");try{const e=Ue(n,s.pinHash);if(l&&await fetch("/api/unlock-attempts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({folderId:s._id||s.id,success:e,method:"pin"})}).catch(()=>{}),e)i();else{const e=o+1;c(e),r(""),e>=5?(m("â›” Too many failed attempts. Access blocked."),setTimeout(t,3e3)):m(`âŒ Incorrect PIN. ${5-e} attempts remaining`)}}catch(e){m("âŒ Unlock failed. Please try again.")}finally{x(!1)}}else m("âš ï¸ PIN must be exactly 4 digits")};return ke.jsxs(G,{visible:!0,onClose:t,alignment:"center",children:[ke.jsx(V,{children:ke.jsxs(K,{children:['\\ud83d\\udd12 Unlock "',s.name,'"']})}),ke.jsxs(q,{children:[ke.jsxs("div",{className:"text-center mb-4",children:[ke.jsx(L,{size:48,className:"text-primary mb-2"}),ke.jsx("h5",{className:"text-primary",children:"Secure Folder Access"}),ke.jsx("p",{className:"text-muted small",children:"Enter your 4-digit PIN to access this protected folder"})]}),ke.jsxs("div",{className:"mb-3",children:[ke.jsxs("label",{className:"form-label fw-semibold d-flex align-items-center justify-content-center gap-2",children:["\\ud83d\\udd22 Enter 4-Digit PIN",ke.jsxs("small",{className:"text-muted",children:["(",n.length,"/4)"]})]}),ke.jsx(xe,{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:n,onChange:e=>{const s=e.target.value.replace(/\D/g,"");s.length<=4&&(r(s),m(""))},onKeyDown:e=>"Enter"===e.key&&4===n.length&&u(),maxLength:4,placeholder:"0000",className:"text-center fs-4 fw-bold "+(4===n.length?"border-success":n.length>0?"border-warning":""),style:{letterSpacing:"0.5rem",fontFamily:"monospace"},autoFocus:!0,disabled:h}),ke.jsx("div",{className:"d-flex justify-content-center gap-2 mt-2",children:[0,1,2,3].map(e=>ke.jsx("div",{className:"rounded-circle "+(e<n.length?"bg-primary":"bg-light border"),style:{width:"12px",height:"12px"}},e))}),d&&ke.jsx(Q,{color:"danger",className:"mt-3 py-2 text-center",children:d})]}),ke.jsx("div",{className:"d-grid",children:ke.jsx(Z,{color:"primary",size:"lg",onClick:u,disabled:4!==n.length||h,children:h?ke.jsxs(ke.Fragment,{children:[ke.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Unlocking..."]}):ke.jsxs(ke.Fragment,{children:[ke.jsx(W,{size:16,className:"me-1"}),"Unlock Folder"]})})}),o>0&&ke.jsx("div",{className:"text-center mt-3",children:ke.jsxs("small",{className:"text-warning",children:["\\u26a0\\ufe0f ",o," failed attempt",o>1?"s":""," | ",5-o," remaining"]})})]}),ke.jsx(X,{children:ke.jsx(Z,{color:"secondary",variant:"outline",onClick:t,children:"Cancel"})})]})},Be=({file:e,onClose:s})=>{const i=e.type?.startsWith("image/"),a="application/pdf"===e.type,l=e.type?.startsWith("video/"),n=e.type?.startsWith("audio/"),r=e.type?.startsWith("text/")||["application/json","application/xml","application/xhtml+xml"].includes(e.type||""),c=e.url?.startsWith("http")?e.url:e.url||"",[d,m]=t.useState(null),[h,x]=t.useState(null);t.useEffect(()=>{let e=!1;return(async()=>{if(r)try{const s=await fetch(c);if(!s.ok)throw new Error(`HTTP ${s.status}`);const t=await s.text();if(!e){const e=204800;m(t.length>e?t.slice(0,e)+"\n\nâ€¦(truncated)â€¦":t)}}catch(s){e||x(s.message)}})(),()=>{e=!0}},[c,r]);return ke.jsxs(G,{visible:!0,onClose:s,size:"lg",fullscreen:"sm",children:[ke.jsx(V,{children:ke.jsx(K,{children:e.name})}),ke.jsxs(q,{style:{maxHeight:"80vh",overflow:"auto"},children:[ke.jsxs("div",{className:"d-flex gap-2 justify-content-end mb-3",children:[ke.jsx(Z,{color:"secondary",variant:"outline",size:"sm",onClick:()=>window.open(c,"_blank"),children:"Open"}),ke.jsx(Z,{color:"success",variant:"outline",size:"sm",onClick:()=>{const s=document.createElement("a");s.href=c,s.download=e.name||"download",document.body.appendChild(s),s.click(),document.body.removeChild(s)},children:"Download"}),ke.jsx(Z,{color:"primary",variant:"outline",size:"sm",onClick:async()=>{try{await navigator.clipboard.writeText(c)}catch(e){}},children:"Copy Link"})]}),i&&ke.jsx("img",{src:c,alt:e.name,className:"img-fluid rounded",style:{width:"100%",height:"auto",maxHeight:"75vh",objectFit:"contain"}}),l&&ke.jsx("video",{src:c,controls:!0,className:"w-100 rounded",style:{width:"100%",height:"auto",maxHeight:"75vh"}}),n&&ke.jsx("audio",{src:c,controls:!0,className:"w-100"}),a&&ke.jsx("iframe",{src:c,className:"w-100",style:{height:"75vh"},title:e.name}),r&&ke.jsx("div",{className:"border rounded p-3 bg-light",style:{maxHeight:"75vh",overflow:"auto"},children:h?ke.jsxs("div",{className:"text-danger",children:["Failed to load text: ",h]}):ke.jsx("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",margin:0},children:d??"Loadingâ€¦"})}),!i&&!l&&!n&&!a&&!r&&ke.jsxs("div",{className:"text-center py-5 text-muted",children:[ke.jsx(o,{size:64,className:"mb-3"}),ke.jsx("div",{children:"Preview not available for this file type"})]})]}),ke.jsx(X,{children:ke.jsx(Z,{color:"secondary",onClick:s,children:"Close"})})]})},Me=({folder:s,onClose:t,onSave:i})=>{const[a,l]=e.useState(s?.name||""),[n,r]=e.useState(""),[o,c]=e.useState(!s?.locked),d=()=>{i({name:a,pin:n}),t()};return ke.jsxs(G,{visible:!0,onClose:t,alignment:"center",children:[ke.jsx(V,{children:ke.jsx(K,{children:"Edit Folder"})}),ke.jsxs(q,{children:[ke.jsxs("div",{className:"mb-3",children:[ke.jsx("label",{className:"form-label",children:"Folder Name"}),ke.jsx(xe,{type:"text",value:a,onChange:e=>l(e.target.value),onKeyDown:e=>"Enter"===e.key&&d(),autoFocus:!0})]}),ke.jsxs("div",{className:"mb-2 form-check",children:[ke.jsx("input",{id:"removePinChk",className:"form-check-input",type:"checkbox",checked:o,onChange:e=>c(e.target.checked)}),ke.jsx("label",{className:"form-check-label",htmlFor:"removePinChk",children:"No PIN (unlocked)"})]}),!o&&ke.jsxs("div",{children:[ke.jsx("label",{className:"form-label",children:"New PIN (4 digits)"}),ke.jsx(xe,{type:"password",value:n,onChange:e=>r(e.target.value),onKeyDown:e=>"Enter"===e.key&&d(),placeholder:"â€¢â€¢â€¢â€¢",maxLength:4})]})]}),ke.jsxs(X,{children:[ke.jsx(Z,{color:"secondary",variant:"outline",onClick:t,children:"Cancel"}),ke.jsx(Z,{color:"primary",onClick:d,children:"Save"})]})]})},Re=({onClose:s,onCreate:t})=>{const[i,a]=e.useState(""),[l,n]=e.useState(""),[r,o]=e.useState(""),[c,d]=e.useState(!1),m=()=>c&&4!==l.length?(o("PIN must be exactly 4 digits"),!1):(o(""),!0),h=()=>{i.trim()&&(c&&!m()||(t(i,c?l:""),s()))},x=i.trim()&&(!c||c&&4===l.length);return ke.jsxs(G,{visible:!0,onClose:s,alignment:"center",children:[ke.jsx(V,{children:ke.jsx(K,{children:"Create New Folder"})}),ke.jsxs(q,{children:[ke.jsxs("div",{className:"mb-3",children:[ke.jsx("label",{className:"form-label",children:"Folder Name"}),ke.jsx(xe,{type:"text",value:i,onChange:e=>a(e.target.value),onKeyDown:e=>"Enter"===e.key&&h(),placeholder:"Enter folder name...",autoFocus:!0})]}),ke.jsxs("div",{className:"mb-3",children:[ke.jsxs("div",{className:"form-check",children:[ke.jsx("input",{className:"form-check-input",type:"checkbox",id:"wantsLock",checked:c,onChange:e=>{d(e.target.checked),e.target.checked||(n(""),o(""))}}),ke.jsx("label",{className:"form-check-label",htmlFor:"wantsLock",children:"ðŸ”’ Lock this folder with a PIN"})]}),ke.jsx("small",{className:"text-muted",children:"Check this to require a 4-digit PIN to access this folder"})]}),c&&ke.jsxs("div",{className:"fade-in",children:[ke.jsx("label",{className:"form-label",children:"4-Digit PIN"}),ke.jsxs("div",{className:"position-relative",children:[ke.jsx(xe,{type:"password",value:l,onChange:e=>{const s=e.target.value.replace(/\D/g,"");s.length<=4&&(n(s),o(""))},onKeyDown:e=>"Enter"===e.key&&h(),onBlur:m,placeholder:"Enter 4 digits...",maxLength:4,className:"pin-input "+(r?"is-invalid":4===l.length?"is-valid":""),style:{fontSize:"1.2rem",letterSpacing:"0.5rem",textAlign:"center",paddingRight:"2.5rem"}}),ke.jsx("div",{className:"position-absolute",style:{right:"0.75rem",top:"50%",transform:"translateY(-50%)",pointerEvents:"none"},children:4===l.length?ke.jsx(B,{size:20,className:"text-success"}):c?ke.jsx(L,{size:20,className:"text-muted"}):null})]}),r&&ke.jsxs("div",{className:"invalid-feedback d-block",children:[ke.jsx(M,{size:16,className:"me-1"}),r]}),ke.jsx("div",{className:"form-text mt-2",children:ke.jsxs("div",{className:"d-flex align-items-center gap-2",children:[ke.jsx("span",{children:"PIN strength: "}),ke.jsx("div",{className:"flex-grow-1",style:{maxWidth:"100px"},children:ke.jsx("div",{className:"progress",style:{height:"4px"},children:ke.jsx("div",{className:"progress-bar "+(0===l.length?"bg-light":l.length<4?"bg-warning":"bg-success"),style:{width:l.length/4*100+"%"}})})}),ke.jsxs("small",{className:"text-muted",children:[l.length,"/4"]})]})})]})]}),ke.jsxs(X,{children:[ke.jsx(Z,{color:"secondary",variant:"outline",onClick:s,children:"Cancel"}),ke.jsx(Z,{color:"primary",onClick:h,disabled:!x,children:"Create Folder"})]})]})};function Je({show:e,title:s,message:t,onCancel:i,onConfirm:a}){return ke.jsxs(G,{visible:e,onClose:i,alignment:"center",children:[ke.jsx(V,{children:ke.jsx(K,{children:s||"Confirm"})}),ke.jsx(q,{children:ke.jsxs("div",{className:"d-flex align-items-start gap-2",children:[ke.jsx(M,{className:"text-danger flex-shrink-0"}),ke.jsx("div",{children:t||"Are you sure?"})]})}),ke.jsxs(X,{children:[ke.jsx(Z,{color:"secondary",variant:"outline",onClick:i,children:"Cancel"}),ke.jsx(Z,{color:"danger",onClick:a,children:"Delete"})]})]})}function He({show:e,folder:s,contentsAnalysis:t,onCancel:i,onConfirm:a}){const l=e=>e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":e<1073741824?(e/1048576).toFixed(1)+" MB":(e/1073741824).toFixed(1)+" GB";if(!e||!s||!t)return null;const{fileCount:n,subfolderCount:r,totalSize:c,fileTypes:d,isEmpty:m}=t;return ke.jsxs(G,{visible:e,onClose:i,alignment:"center",size:"lg",children:[ke.jsx(V,{children:ke.jsxs(K,{className:"text-danger",children:[ke.jsx(M,{size:20,className:"me-2"}),'Delete Folder "',s.name,'"']})}),ke.jsx(q,{children:m?ke.jsxs("div",{className:"text-center py-3",children:[ke.jsx(S,{size:48,className:"text-muted mb-3 opacity-50"}),ke.jsx("h5",{className:"fw-bold mb-2",children:"Delete Empty Folder?"}),ke.jsx("p",{className:"text-muted mb-0",children:"This folder is empty and can be safely deleted."})]}):ke.jsxs("div",{children:[ke.jsxs("div",{className:"d-flex align-items-center gap-3 mb-4 p-3 bg-danger-subtle border border-danger-subtle rounded",children:[ke.jsx(M,{size:32,className:"text-danger flex-shrink-0"}),ke.jsxs("div",{children:[ke.jsx("h5",{className:"fw-bold mb-1 text-danger",children:"âš ï¸ Warning: This folder contains data!"}),ke.jsxs("p",{className:"mb-0 text-danger-emphasis",children:["Deleting this folder will ",ke.jsx("strong",{children:"permanently remove all its contents"}),". This action cannot be undone."]})]})]}),ke.jsxs("div",{className:"mb-4",children:[ke.jsx("h6",{className:"fw-bold mb-3",children:"ðŸ“Š Folder Contents Summary:"}),ke.jsxs("div",{className:"row g-3 mb-3",children:[n>0&&ke.jsx("div",{className:"col-md-6",children:ke.jsxs("div",{className:"d-flex align-items-center gap-2 p-2 bg-light rounded",children:[ke.jsx(o,{size:20,className:"text-primary"}),ke.jsxs("div",{children:[ke.jsxs("div",{className:"fw-semibold",children:[n," File",1!==n?"s":""]}),ke.jsx("small",{className:"text-muted",children:l(c)})]})]})}),r>0&&ke.jsx("div",{className:"col-md-6",children:ke.jsxs("div",{className:"d-flex align-items-center gap-2 p-2 bg-light rounded",children:[ke.jsx(S,{size:20,className:"text-warning"}),ke.jsxs("div",{children:[ke.jsxs("div",{className:"fw-semibold",children:[r," Subfolder",1!==r?"s":""]}),ke.jsx("small",{className:"text-muted",children:"May contain additional files"})]})]})})]}),n>0&&ke.jsxs("div",{className:"mb-3",children:[ke.jsx("h6",{className:"small fw-semibold mb-2",children:"ðŸ“ File Types:"}),ke.jsx("div",{className:"p-2 bg-light rounded",children:ke.jsx("small",{className:"text-muted",children:(e=>{const s=[];return e.images>0&&s.push(`${e.images} image${e.images>1?"s":""}`),e.documents>0&&s.push(`${e.documents} document${e.documents>1?"s":""}`),e.videos>0&&s.push(`${e.videos} video${e.videos>1?"s":""}`),e.audio>0&&s.push(`${e.audio} audio file${e.audio>1?"s":""}`),e.other>0&&s.push(`${e.other} other file${e.other>1?"s":""}`),s.join(", ")})(d)})})]})]}),ke.jsx(Q,{color:"danger",className:"mb-0",children:ke.jsxs("div",{className:"d-flex align-items-start gap-2",children:[ke.jsx(M,{size:16,className:"flex-shrink-0 mt-1"}),ke.jsxs("div",{children:[ke.jsx("strong",{children:"Are you absolutely sure?"}),ke.jsxs("div",{className:"mt-1",children:["This will delete:",ke.jsxs("ul",{className:"mb-1 mt-1",children:[n>0&&ke.jsxs("li",{children:[n," file",1!==n?"s":""," (",l(c),")"]}),r>0&&ke.jsxs("li",{children:[r," subfolder",1!==r?"s":""," and all their contents"]})]}),ke.jsx("strong",{children:"This action cannot be undone!"})]})]})]})})]})}),ke.jsxs(X,{children:[ke.jsx(Z,{color:"secondary",variant:"outline",onClick:i,children:"Cancel"}),ke.jsx(Z,{color:"danger",onClick:a,children:m?"Delete Empty Folder":"Delete Folder & All Contents"})]})]})}function Ge(){const{user:s,token:i,loading:a,signIn:r,signUp:j,signOut:N,updateUserProfile:y}=(()=>{const[s,t]=e.useState(null),[i,a]=e.useState(null),[l,n]=e.useState(!0);e.useEffect(()=>{const e=sessionStorage.getItem("sfm_user"),s=sessionStorage.getItem("sfm_token");if(e&&s){const i=JSON.parse(e),l=`profilePhoto_${i?.email||i?.id||"default"}`,n=localStorage.getItem(l);n&&!i.profilePhoto&&(i.profilePhoto=n),t(i),a(s)}n(!1)},[]);const r="/api/auth";return{user:s,token:i,loading:l,signIn:async(e,s)=>{const i=await fetch(`${r}/signin`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:s})});if(!i.ok){const e=await i.json().catch(()=>({}));throw new Error(e.error||"Sign in failed")}const l=await i.json();return sessionStorage.setItem("sfm_user",JSON.stringify(l.user)),sessionStorage.setItem("sfm_token",l.token),t(l.user),a(l.token),l.user},signUp:async(e,s)=>{const i=await fetch(`${r}/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:s})});if(!i.ok){const e=await i.json().catch(()=>({}));throw new Error(e.error||"Sign up failed")}const l=await i.json();return sessionStorage.setItem("sfm_user",JSON.stringify(l.user)),sessionStorage.setItem("sfm_token",l.token),t(l.user),a(l.token),l.user},signOut:()=>{t(null),a(null),sessionStorage.removeItem("sfm_user"),sessionStorage.removeItem("sfm_token")},updateUserProfile:e=>{const i={...s,...e};if(t(i),sessionStorage.setItem("sfm_user",JSON.stringify(i)),void 0!==e.profilePhoto){const s=`profilePhoto_${i?.email||i?.id||"default"}`;e.profilePhoto?localStorage.setItem(s,e.profilePhoto):localStorage.removeItem(s)}}}})(),[v,W]=e.useState([]),[B,M]=e.useState([]),[G,V]=e.useState([]),[K,q]=e.useState(null),[Q,X]=e.useState(new Set),[Z,de]=e.useState(null),[me,he]=e.useState(null),[xe,ue]=e.useState(!1),[pe,fe]=e.useState(null),[ge,je]=e.useState(!1),[be,Ne]=e.useState(""),[ye,ve]=e.useState("grid"),we=(()=>{const s=e.useContext(Fe);if(!s)throw new Error("useToast must be used within ToastProvider");return s.showToast})(),[Ce,Se]=e.useState(!1),ze=e.useRef(null),[Pe,Ue]=e.useState({show:!1,title:"",message:"",onConfirm:null}),[Ge,Ve]=e.useState(!1),[Ke,qe]=e.useState(0),[Qe,Ye]=e.useState(!1),[Xe,Ze]=e.useState(!1),[es,ss]=e.useState({show:!1,folder:null,contentsAnalysis:null}),[ts,is]=e.useState(!1),[as,ls]=e.useState([]),[ns,rs]=e.useState("dashboard"),os="/api";e.useCallback(()=>{if(s)try{const e=`sfm_favorites_${s?.id||s?.email||"anon"}`,t=localStorage.getItem(e);t&&ls(JSON.parse(t))}catch(e){ls([])}},[s]);const cs=e.useCallback(e=>{if(s)try{const t=`sfm_favorites_${s?.id||s?.email||"anon"}`;localStorage.setItem(t,JSON.stringify(e)),ls(e)}catch(t){}},[s]),ds=e.useCallback(e=>{const s=e._id||e.id,t=as.some(e=>(e._id||e.id)===s);let i;t?(i=as.filter(e=>(e._id||e.id)!==s),we(`Removed "${e.name}" from favorites`,{type:"info"})):(i=[...as,{...e,favoritedAt:(new Date).toISOString()}],we(`Added "${e.name}" to favorites`,{type:"success"})),cs(i),js(t?"FILE_UNFAVORITE":"FILE_FAVORITE",{fileName:e.name,fileId:s,fileType:e.type||"unknown"})},[as,cs,we]),ms=e.useCallback(e=>{const s=e._id||e.id;return as.some(e=>(e._id||e.id)===s)},[as]),hs=e.useCallback(e=>{if(!e||!G||!v)return 0;try{let s=G.filter(s=>s&&String(s.folderId)===String(e)).reduce((e,s)=>e+(s.size||0),0);const t=v.filter(s=>s&&String(s.parentId)===String(e)),i=10;return t.length>0&&i>0&&t.forEach(t=>{t&&(t._id||t.id)!==e&&(s+=hs(t._id||t.id))}),s}catch(s){return 0}},[G,v]),{getRootProps:xs,getInputProps:us,isDragActive:ps}=k({onDrop:e=>{(async e=>{if(!e||0===e.length)return;Ve(!0),Se(!0),qe(0);const s=e.length,t=Array.from(e).map(e=>e.name).join(", ");try{we(`Processing and uploading ${s} file${s>1?"s":""} using multicore processing...`,{type:"info"}),await Le.initialize();const a=[],l=[];let n=0;const r=()=>{n++;const e=Math.floor(n/s*50);qe(e)};for(const s of e){const e=(async()=>{try{const t=await Le.processFile("analyze",s,{timeout:15e3});let i=s;if(s.type.startsWith("image/")&&s.size>1048576)try{const e=await Le.processFile("compress",s,{quality:.8,format:"webp",timeout:3e4});i=new o([e],s.name.replace(/\.[^/.]+$/,".webp"),{type:"image/webp"})}catch(e){}return r(),{original:s,processed:i,analysis:t}}catch(t){return r(),{original:s,processed:s,analysis:null}}})();l.push(e)}const c=await Promise.all(l);a.push(...c),qe(50);const d=new FormData;for(const e of a)d.append("files",e.processed),e.analysis&&d.append(`analysis_${e.processed.name}`,JSON.stringify(e.analysis));d.append("folderId",K||"");const m=setInterval(()=>{qe(e=>{const s=e+2;return s>=95?95:s})},200),h=await fetch(`${os}/files/upload`,{method:"POST",headers:{Authorization:`Bearer ${i}`},body:d});if(clearInterval(m),qe(100),!h.ok){const e=await h.text();throw new Error(e||`Upload failed (${h.status})`)}const x=await h.json();V(e=>[...e,...x]);const u=Array.from(e).reduce((e,s)=>e+s.size,0),p=a.reduce((e,s)=>e+s.processed.size,0),f=u-p;await js("FILE_UPLOAD",{fileCount:s,fileNames:t,folderId:K||"root",folderName:vs?.name||"Root",originalSize:u,processedSize:p,compressionSavings:f,multicore:!0}),await bs();const g=f>0?` (saved ${Math.round(f/1024)}KB through optimization)`:"";we(`Successfully uploaded: ${t}${g}`,{type:"success"})}catch(a){we(`Upload failed: ${a.message}`,{type:"error"})}finally{Ve(!1),Se(!1),qe(0)}})(e)},noClick:!0,noKeyboard:!0,multiple:!0}),fs=async(e,s={})=>{const t=s.headers||{};i&&(t.Authorization=`Bearer ${i}`),!s.body||s.body instanceof FormData||(t["Content-Type"]="application/json");const a=await fetch(`${os}${e}`,{...s,headers:t});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.error||`Request failed: ${a.status}`)}return a.json().catch(()=>({}))},gs=(e,s="file")=>{const t=JSON.parse(localStorage.getItem("sfm_trash_items")||"[]"),i=new Date(Date.now()-6048e5);return t.some(t=>{const a=t._id||t.id,l=new Date(t.deletedAt)>i,n=t.type===s;return String(a)===String(e)&&n&&l})},js=async(e,t={})=>{if(s&&i)try{const a={userId:s.id||s._id,userEmail:s.email,userName:s.name||s.username,action:e,details:t,timestamp:(new Date).toISOString(),sessionId:sessionStorage.getItem("sfm_session_id")||"unknown",userAgent:navigator.userAgent,ipAddress:"client-side"};await fetch(`${os}/activity-logs`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(a)}).catch(e=>{const s=JSON.parse(localStorage.getItem("sfm_activity_logs_backup")||"[]");s.push(a),s.length>100&&s.shift(),localStorage.setItem("sfm_activity_logs_backup",JSON.stringify(s))})}catch(a){}},bs=e.useCallback(async(e=!1)=>{if(s&&i){Ze(!0);try{e&&we("Refreshing data...",{type:"info"});const s=K?`?parentId=${K}`:"",t=await fs(`/folders${s}`);W(t||[]);const i=K?`/files?folderId=${K}`:"/files",a=await fs(i);if(V(a||[]),!K){const e=await fs("/folders");M(e||[])}e&&we("Data refreshed successfully",{type:"success"})}catch(t){e&&we("Failed to refresh data",{type:"error"})}finally{Ze(!1)}}},[s,i,K,we]);e.useEffect(()=>{if(!s||!i)return;const e=setInterval(()=>{bs()},3e4);return()=>clearInterval(e)},[bs,s,i]),e.useEffect(()=>{s&&i&&(js("USER_LOGIN",{loginTime:(new Date).toISOString(),userAgent:navigator.userAgent}),(async()=>{try{const e=await fs("/folders");M(e||[])}catch(e){}})())},[s,i]),e.useEffect(()=>{if(!s||!i)return;if(ts)return;(async()=>{try{Ze(!0);const e=K?`?parentId=${K}`:"",s=await fs(`/folders${e}`);Array.isArray(s),W(s||[]);const t=K?`/files?folderId=${K}`:"/files",i=await fs(t);Array.isArray(i),V(i||[])}catch(e){we(`Failed to load folder contents: ${e.message}`,{type:"error"}),W([]),V([])}finally{Ze(!1)}})()},[s,i,K,ts]);const Ns=e.useMemo(()=>{const e=G.length,s=v.filter(e=>!e.parentId).length,t=G.reduce((e,s)=>e+(s.size||0),0),i=new Date(Date.now()-864e5),a=G.filter(e=>new Date(e.uploadDate||e.createdAt||e.dateModified)>i).length,l={images:G.filter(e=>e.type?.startsWith("image/")).length,documents:G.filter(e=>e.type?.includes("pdf")||e.type?.includes("doc")||e.type?.includes("text")).length,videos:G.filter(e=>e.type?.startsWith("video/")).length,audio:G.filter(e=>e.type?.startsWith("audio/")).length,other:G.filter(e=>!(e.type&&(e.type.startsWith("image/")||e.type.startsWith("video/")||e.type.startsWith("audio/")||e.type.includes("pdf")||e.type.includes("doc")||e.type.includes("text")))).length},n=t/21474836480*100;return{totalFiles:e,totalFolders:s,totalSize:t,recentFiles:a,fileTypes:l,storageUsed:Math.min(n,100),storageUsedGB:(t/1073741824).toFixed(2),storageLimitGB:20,lastUpdated:(new Date).toLocaleTimeString()}},[G,v]);if(a)return ke.jsxs("div",{className:"d-flex align-items-center justify-content-center vh-100",children:[ke.jsx(Y,{color:"primary",style:{width:"3rem",height:"3rem"}}),ke.jsx("span",{className:"ms-3 fw-semibold text-primary",children:"Loading..."})]});if(!s)return ke.jsx(Oe,{onSignIn:r,onSignUp:j});const ys=e=>e?._id||e?.id||null,vs=v.find(e=>ys(e)===K),ws=[];let ks=vs;for(;ks;){ws.unshift(ks);const e=ks.parentId||null;ks=v.find(s=>String(ys(s))===String(e))}const Cs=G.filter(e=>K?String(e.folderId)===String(K):!e.folderId).filter(e=>!gs(e._id||e.id,"file")),Ss=v.filter(e=>K?String(e.parentId)===String(K):!e.parentId).filter(e=>!gs(e._id||e.id,"folder")),zs=Cs.filter(e=>e.name.toLowerCase().includes(be.toLowerCase())),Fs=Ss.filter(e=>e.name.toLowerCase().includes(be.toLowerCase()));ws.map(e=>e.name);const Ps=async e=>{try{const s=await fetch(`${os}/files/${e._id||e.id}/download`,{headers:i?{Authorization:`Bearer ${i}`}:{}});if(!s.ok){if(404===s.status&&e.url){const s=(e.url.startsWith("http"),e.url);return void window.open(s,"_blank")}const t=await s.text();throw new Error(t||`HTTP ${s.status}`)}const t=await s.blob(),a=window.URL.createObjectURL(t),l=document.createElement("a");l.href=a,l.download=e.name||"download",document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(a),await js("FILE_DOWNLOAD",{fileName:e.name||"download",fileId:e._id||e.id,fileSize:e.size||0,fileType:e.type||"unknown"})}catch(s){we(`Download failed: ${s.message}`,{type:"error"})}},_s=e=>{try{if(!e)return void we("Invalid folder selected",{type:"error"});const s=e._id||e.id;if(!s)return void we("Folder ID is missing",{type:"error"});e.locked&&!Q.has(s)?de(e):(is(!0),rs("folder"),q(s),we(`Opening folder "${e.name}"...`,{type:"info"}))}catch(s){we(`Failed to open folder: ${s.message}`,{type:"error"})}},Is=e=>{let s;if(s="object"==typeof e&&null!==e?e._id||e.id:e,s=String(s),!/^[0-9a-fA-F]{24}$/.test(s))return void we("Invalid file ID format",{type:"error"});const t=G.find(e=>String(e._id||e.id)===s),i=t?.name||"this file";Ue({show:!0,title:"Move to trash",message:`Are you sure you want to move "${i}" to trash? You can restore it within 7 days.`,onConfirm:async()=>{try{Se(!0),we("Moving to trash...",{type:"info"});const a=JSON.parse(localStorage.getItem("sfm_trash_items")||"[]"),l={...t,_id:s,id:s,deletedAt:(new Date).toISOString(),type:"file",originalLocation:K?`folder-${K}`:"root"};a.push(l),localStorage.setItem("sfm_trash_items",JSON.stringify(a)),await fs(`/files/${e}`,{method:"DELETE"}),V(s=>s.filter(s=>(s._id||s.id)!==e)),await js("FILE_DELETE",{fileName:i,fileId:s,fileSize:t.size||0,fileType:t.type||"unknown",folderId:K||"root",folderName:vs?.name||"Root",movedToTrash:!0}),await fs(`/files/${s}`,{method:"DELETE"}),V(e=>e.filter(e=>(e._id||e.id)!==s)),we(`Failed to move file to trash: ${err.message}`,{type:"error"})}finally{Se(!1),Ue({show:!1,title:"",message:"",onConfirm:null})}}})},Ds=e=>{let s;if(s="object"==typeof e&&null!==e?e._id||e.id:e,s=String(s),!/^[0-9a-fA-F]{24}$/.test(s))return void we("Invalid folder ID format",{type:"error"});const t=[...v,...B].find(e=>String(e._id||e.id)===s);if(!t)return void we("Folder not found",{type:"error"});const i=Ls(s);ss({show:!0,folder:t,contentsAnalysis:i})},$s=e=>e&&0!==e?e<1024?Math.round(e)+" B":e<1048576?(e/1024).toFixed(1)+" KB":e<1073741824?(e/1048576).toFixed(1)+" MB":(e/1073741824).toFixed(1)+" GB":"0 B",Ts=e=>{if(!e||!G)return 0;try{return G.filter(s=>s&&String(s.folderId)===String(e)).length}catch(s){return 0}},Es=e=>{if(!e||!G||!v)return 0;try{const s=G.filter(s=>s&&String(s.folderId)===String(e)).length;return s+v.filter(s=>s&&String(s.parentId)===String(e)).length}catch(s){return 0}},As=e=>{if(!e||!v)return 0;try{return v.filter(s=>s&&String(s.parentId)===String(e)).length}catch(s){return 0}},Ls=e=>{const s=G.filter(s=>String(s.folderId)===String(e)),t=v.filter(s=>String(s.parentId)===String(e)),i=s.reduce((e,s)=>e+(s.size||0),0),a={images:s.filter(e=>e.type?.startsWith("image/")).length,documents:s.filter(e=>e.type?.includes("pdf")||e.type?.includes("doc")||e.type?.includes("text")).length,videos:s.filter(e=>e.type?.startsWith("video/")).length,audio:s.filter(e=>e.type?.startsWith("audio/")).length,other:s.filter(e=>!(e.type&&(e.type.startsWith("image/")||e.type.startsWith("video/")||e.type.startsWith("audio/")||e.type.includes("pdf")||e.type.includes("doc")||e.type.includes("text")))).length};return{fileCount:s.length,subfolderCount:t.length,totalSize:i,fileTypes:a,isEmpty:0===s.length&&0===t.length}};return ke.jsx(Ae,{children:ke.jsxs("div",{className:"filearlo-container d-flex",children:[ke.jsxs("div",{className:"filearlo-sidebar d-flex flex-column",style:{width:"380px",minWidth:"380px"},children:[ke.jsxs("div",{className:"p-4",children:[ke.jsx("div",{className:"d-flex align-items-center gap-3 mb-5",children:ke.jsx("div",{className:"fw-bold h3 mb-0",style:{color:"var(--color-text-primary)"},children:"FileArlo"})}),ke.jsxs("div",{className:"position-relative mb-0",children:[ke.jsx(n,{size:16,className:"position-absolute",style:{left:"12px",top:"12px",color:"var(--color-text-muted)"}}),ke.jsx("input",{type:"text",className:"search-input-enhanced w-100",placeholder:"Search anything..",value:be,onChange:e=>Ne(e.target.value)})]})]}),ke.jsxs("div",{className:"flex-grow-1 overflow-auto px-4 py-3",children:[ke.jsx("div",{className:"mb-4",children:ke.jsxs("button",{className:"sidebar-nav-item btn w-100 text-start d-flex align-items-center gap-4 px-4 py-3 "+("dashboard"===ns?"active":""),onClick:()=>{js("VIEW_CHANGE",{from:ns,to:"dashboard"}),rs("dashboard"),q(null)},children:[ke.jsx(C,{size:20}),ke.jsx("span",{className:"fw-semibold",style:{fontSize:"1rem"},children:"Dashboard"})]})}),ke.jsxs("div",{className:"mb-4",children:[ke.jsxs("button",{className:"sidebar-nav-item btn w-100 text-start d-flex align-items-center gap-4 px-4 py-3 "+("storage"===ns?"active":""),onClick:()=>{js("VIEW_CHANGE",{from:ns,to:"storage"}),rs("storage"),q(null)},children:[ke.jsx(S,{size:20}),ke.jsx("span",{className:"fw-semibold",style:{fontSize:"1rem"},children:"My Storage"}),ke.jsx(H,{color:"info",className:"ms-auto",children:(()=>{const e=[...B||[],...v||[]].filter((e,s,t)=>{const i=t.findIndex(s=>ys(s)===ys(e))===s,a=!gs(ys(e),"folder");return i&&a});return e.length})()})]}),ke.jsxs("button",{className:"sidebar-nav-item btn w-100 text-start d-flex align-items-center gap-4 px-4 py-3 "+("photos"===ns?"active":""),onClick:()=>{rs("photos"),q(null)},children:[ke.jsx(p,{size:20}),ke.jsx("span",{className:"fw-semibold",style:{fontSize:"1rem"},children:"Photos"}),ke.jsx(H,{color:"danger",className:"ms-auto",children:G.filter(e=>e.type?.startsWith("image/")&&!gs(e._id||e.id,"file")).length})]}),ke.jsxs("button",{className:"sidebar-nav-item btn w-100 text-start d-flex align-items-center gap-4 px-4 py-3 "+("audio"===ns?"active":""),onClick:()=>{rs("audio"),q(null)},children:[ke.jsx(u,{size:20}),ke.jsx("span",{className:"fw-semibold",style:{fontSize:"1rem"},children:"Audio"}),ke.jsx(H,{color:"info",className:"ms-auto",children:G.filter(e=>e.type?.startsWith("audio/")&&!gs(e._id||e.id,"file")).length})]}),ke.jsxs("button",{className:"sidebar-nav-item btn w-100 text-start d-flex align-items-center gap-4 px-4 py-3 "+("documents"===ns?"active":""),onClick:()=>{rs("documents"),q(null)},children:[ke.jsx(f,{size:20}),ke.jsx("span",{className:"fw-semibold",style:{fontSize:"1rem"},children:"Documents"}),ke.jsx(H,{color:"primary",className:"ms-auto",children:G.filter(e=>(e.type?.includes("pdf")||e.type?.includes("doc")||e.type?.includes("text")||e.type?.includes("sheet")||e.type?.includes("presentation"))&&!gs(e._id||e.id,"file")).length})]}),ke.jsxs("button",{className:"sidebar-nav-item btn w-100 text-start d-flex align-items-center gap-4 px-4 py-3 "+("videos"===ns?"active":""),onClick:()=>{rs("videos"),q(null)},children:[ke.jsx(x,{size:20}),ke.jsx("span",{className:"fw-semibold",style:{fontSize:"1rem"},children:"Videos"}),ke.jsx(H,{color:"warning",className:"ms-auto",children:G.filter(e=>e.type?.startsWith("video/")&&!gs(e._id||e.id,"file")).length})]})]}),ke.jsxs("div",{className:"mb-4",children:[ke.jsxs("button",{className:"sidebar-nav-item btn w-100 text-start d-flex align-items-center gap-4 px-4 py-3",children:[ke.jsx(z,{size:20}),ke.jsx("span",{className:"fw-semibold",style:{fontSize:"1rem"},children:"Recent"})]}),ke.jsxs("button",{className:"sidebar-nav-item btn w-100 text-start d-flex align-items-center gap-4 px-4 py-3",children:[ke.jsx(F,{size:20}),ke.jsx("span",{className:"fw-semibold",style:{fontSize:"1rem"},children:"Shared Link"})]}),ke.jsxs("button",{className:"sidebar-nav-item btn w-100 text-start d-flex align-items-center gap-4 px-4 py-3 "+("favorites"===ns?"active":""),onClick:()=>{rs("favorites"),q(null)},children:[ke.jsx(m,{size:20}),ke.jsx("span",{className:"fw-semibold",style:{fontSize:"1rem"},children:"Favorites"}),ke.jsx(H,{color:"primary",className:"ms-auto",children:as.length})]}),ke.jsxs("button",{className:"sidebar-nav-item btn w-100 text-start d-flex align-items-center gap-4 px-4 py-3 "+("trash"===ns?"active":""),onClick:()=>{rs("trash"),q(null)},children:[ke.jsx(h,{size:20}),ke.jsx("span",{className:"fw-semibold",style:{fontSize:"1rem"},children:"Trash"}),ke.jsx(H,{color:"danger",className:"ms-auto",children:(()=>{const e=JSON.parse(localStorage.getItem("sfm_trash_items")||"[]"),s=new Date(Date.now()-6048e5);return e.filter(e=>new Date(e.deletedAt)>s).length})()})]})]})]}),ke.jsxs("div",{className:"p-4 border-top",children:[ke.jsxs("div",{className:"mb-4",children:[ke.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[ke.jsx("span",{className:"fw-semibold",children:"Storage"}),ke.jsxs("span",{className:"small text-muted",children:[Math.round(Ns.storageUsed),"%"]})]}),ke.jsxs("div",{className:"text-muted small mb-2",children:[Ns.storageUsedGB," GB out of ",Ns.storageLimitGB," GB used"]}),ke.jsx("div",{className:"storage-progress",children:ke.jsx("div",{className:"storage-progress-bar",style:{width:`${Ns.storageUsed}%`,background:Ns.storageUsed>80?"linear-gradient(90deg, #ef4444, #dc2626)":Ns.storageUsed>60?"linear-gradient(90deg, #f59e0b, #d97706)":"linear-gradient(90deg, var(--color-primary), var(--color-primary-light))",transition:"all 0.3s ease"}})}),ke.jsxs("div",{className:"d-flex justify-content-between mt-2",children:[ke.jsxs("small",{className:"text-muted",children:[Ns.totalFiles," files"]}),ke.jsxs("small",{className:"text-muted",children:[Ns.totalFolders," folders"]})]})]}),ke.jsx("button",{className:"btn btn-primary w-100 fw-semibold py-2",children:"Upgrade Now"})]})]}),ke.jsxs("div",{className:"flex-grow-1 d-flex flex-column",children:[ke.jsxs("div",{className:"filearlo-header d-flex align-items-center justify-content-between",style:{padding:"1.5rem 2.5rem"},children:[ke.jsxs("div",{className:"d-flex align-items-center gap-4",children:[ke.jsx("h1",{className:"filearlo-title mb-0",children:"favorites"===ns?"My Favorites":"dashboard"===ns?"My Storage":"profile"===ns?"My Profile":"storage"===ns?"All Folders":"photos"===ns?"Photos":"audio"===ns?"Audio Files":"documents"===ns?"Documents":"videos"===ns?"Videos":"trash"===ns?"Trash":vs?.name||"Folder"}),Xe&&ke.jsxs("div",{className:"d-flex align-items-center gap-2 text-primary",children:[ke.jsx(Y,{size:"sm"}),ke.jsx("small",{className:"fw-medium",children:"Refreshing..."})]})]}),ke.jsxs("div",{className:"d-flex align-items-center gap-3",children:[Ge&&ke.jsxs("div",{className:"d-flex align-items-center gap-3 me-3",children:[ke.jsxs("div",{className:"d-flex align-items-center gap-2",children:[ke.jsx(Y,{size:"sm",color:"primary"}),ke.jsx("span",{className:"small text-primary",children:"Uploading..."})]}),ke.jsx("div",{className:"progress",style:{width:"120px",height:"6px"},children:ke.jsx("div",{className:"progress-bar bg-primary",role:"progressbar",style:{width:`${Ke}%`,transition:"width 0.3s ease"},"aria-valuenow":Ke,"aria-valuemin":"0","aria-valuemax":"100"})})]}),ke.jsx("div",{className:"position-relative",children:ke.jsxs("button",{className:"btn btn-link p-2",children:[ke.jsx(P,{size:20,style:{color:"var(--color-text-secondary)"}}),ke.jsx("div",{className:"notification-badge",children:Ns.recentFiles})]})}),ke.jsxs("div",{className:"d-flex align-items-center gap-3",children:[ke.jsxs("div",{className:"text-end",children:[ke.jsx("div",{className:"fw-medium",style:{fontSize:"0.875rem",color:"var(--color-text-primary)"},children:s?.email}),ke.jsx("small",{className:"text-muted",children:"Free Account"})]}),ke.jsxs(ee,{alignment:"end",children:[ke.jsx(se,{caret:!1,className:"p-0 border-0 bg-transparent",style:{position:"relative"},children:ke.jsx("div",{className:"position-relative",children:s?.profilePhoto?ke.jsx("img",{src:s.profilePhoto,alt:"Profile",className:"rounded-circle",style:{width:"56px",height:"56px",objectFit:"cover",border:"3px solid var(--color-border-glass)",transition:"all 0.2s ease",cursor:"pointer"}}):ke.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center",style:{width:"56px",height:"56px",backgroundColor:"var(--color-primary)",color:"white",border:"3px solid var(--color-border-glass)",transition:"all 0.2s ease",cursor:"pointer"},children:ke.jsx(b,{size:24})})})}),ke.jsxs(te,{children:[ke.jsxs(ie,{onClick:()=>{rs("profile"),q(null)},children:[ke.jsx(b,{size:16,className:"me-2"})," View Profile"]}),ke.jsxs(ie,{href:"#",children:[ke.jsx(_,{size:16,className:"me-2"})," Account Settings"]}),ke.jsxs(ie,{href:"#",children:[ke.jsx(P,{size:16,className:"me-2"})," Notifications"]}),ke.jsx(ie,{divider:!0}),ke.jsxs(ie,{onClick:N,children:[ke.jsx(I,{size:16,className:"me-2"})," Sign Out"]})]})]})]})]})]}),ke.jsxs("main",{className:"flex-grow-1",...xs(),style:{backgroundColor:"var(--color-bg-primary)",padding:"2.5rem"},children:[ke.jsx("input",{...us()}),ke.jsx("input",{type:"file",multiple:!0,accept:"*/*",ref:ze,style:{display:"none"},onChange:e=>{const s=e.target.files?Array.from(e.target.files):[];if(!s.length)return;const t=new FormData;for(const i of s)t.append("files",i);t.append("folderId",K||""),Se(!0),fetch(`${os}/files/upload`,{method:"POST",headers:{Authorization:`Bearer ${i}`},body:t}).then(async e=>{if(!e.ok){const s=await e.text();throw new Error(s||`Upload failed (${e.status})`)}return e.json()}).then(e=>{V(s=>[...s,...e]),we("Upload successful",{type:"success"})}).catch(e=>{we(`Upload failed: ${e.message}`,{type:"error"})}).finally(()=>{Se(!1),e&&e.target&&(e.target.value=null)})}}),ps&&ke.jsxs("div",{className:"border border-primary border-2 rounded-3 p-4 text-primary text-center mb-4",style:{backgroundColor:"rgba(79, 70, 229, 0.05)"},children:[ke.jsx(l,{size:32,className:"mb-2"}),ke.jsx("div",{className:"fw-semibold",children:"Drop files to upload"})]}),ts?ke.jsxs("div",{className:"d-flex align-items-center justify-content-center py-5",children:[ke.jsx(Y,{color:"primary",style:{width:"2rem",height:"2rem"}}),ke.jsx("span",{className:"ms-3 fw-semibold text-primary",children:"Loading folder contents..."})]}):"favorites"===ns?ke.jsxs("div",{className:"fade-in",children:[ke.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[ke.jsxs("div",{children:[ke.jsx("h4",{className:"mb-1 fw-bold",children:"My Favorites"}),ke.jsxs("p",{className:"text-muted mb-0",children:[as.length," favorited files"]})]}),ke.jsx("div",{className:"d-flex align-items-center gap-2",children:ke.jsxs("button",{className:"btn btn-outline-primary btn-modern",onClick:()=>ze.current&&ze.current.click(),children:[ke.jsx(l,{size:16,className:"me-1"})," Upload"]})})]}),0===as.length?ke.jsx("div",{className:"text-center py-5",children:ke.jsx(R,{className:"border-0 shadow-sm",children:ke.jsxs(J,{className:"text-center py-5",children:[ke.jsx(m,{size:48,className:"text-muted mb-3 opacity-50"}),ke.jsx("h6",{className:"fw-bold mb-2",children:"No favorites yet"}),ke.jsx("p",{className:"text-muted mb-4",children:"Star files to add them to your favorites for quick access"}),ke.jsxs("button",{className:"btn btn-primary",onClick:()=>{rs("dashboard"),q(null)},children:[ke.jsx(w,{size:16,className:"me-1"}),"Browse Files"]})]})})}):ke.jsx("div",{className:"row g-3",children:as.map((e,s)=>ke.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6",children:ke.jsx(R,{className:"border file-preview-card h-100 hover-lift hover-glow scale-in stagger-item",role:"button",onClick:()=>he(e),style:{animationDelay:100*s+"ms"},children:ke.jsxs(J,{className:"p-3",children:[ke.jsx("div",{className:"rounded-2 mb-3 d-flex align-items-center justify-content-center position-relative",style:{height:"120px",backgroundColor:"#f8f9fa"},children:e.type?.startsWith("image/")&&e.url?ke.jsx("img",{src:e.url,alt:e.name,className:"img-fluid rounded-2",style:{maxHeight:"100%",maxWidth:"100%",objectFit:"cover"}}):ke.jsxs("div",{className:"text-center",children:[ke.jsx(o,{className:"text-muted",size:24}),ke.jsx("div",{className:"mt-2",children:ke.jsx("small",{className:"text-muted text-uppercase",children:e.name?.split(".").pop()||"FILE"})})]})}),ke.jsxs("div",{className:"mb-3",children:[ke.jsx("div",{className:"fw-semibold text-truncate mb-1",title:e.name,children:e.name}),ke.jsx("div",{className:"text-muted small",children:ke.jsxs("span",{children:["Favorited on ",new Date(e.favoritedAt).toLocaleDateString()]})})]}),ke.jsxs("div",{className:"d-flex align-items-center justify-content-between border-top pt-3",children:[ke.jsxs("div",{className:"d-flex gap-2",children:[ke.jsx("button",{className:"btn btn-sm btn-outline-primary d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),he(e)},title:"Preview File",children:ke.jsx(c,{size:14})}),ke.jsx("button",{className:"btn btn-sm btn-outline-secondary d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),Ps(e)},title:"Download File",children:ke.jsx(d,{size:14})}),ke.jsx("button",{className:"btn btn-sm btn-warning d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),ds(e)},title:"Remove from Favorites",children:ke.jsx(m,{size:14,fill:"currentColor"})})]}),ke.jsx("small",{className:"text-muted",children:e.size?`${(e.size/1048576).toFixed(1)} MB`:"0 MB"})]})]})})},e._id||e.id||s))})]}):"profile"===ns?ke.jsxs("div",{className:"fade-in",children:[ke.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[ke.jsxs("div",{children:[ke.jsx("h4",{className:"mb-1 fw-bold",children:"My Profile"}),ke.jsx("p",{className:"text-muted mb-0",children:"Manage your account settings and personal information"})]}),ke.jsx("div",{className:"d-flex align-items-center gap-2",children:ke.jsxs("button",{className:"btn btn-outline-primary btn-modern",onClick:()=>rs("dashboard"),children:[ke.jsx(w,{size:16,className:"me-1"})," Back to Dashboard"]})})]}),ke.jsxs(ae,{className:"g-4",children:[ke.jsx(le,{lg:4,children:ke.jsxs(R,{className:"border-0 shadow-sm h-100",children:[ke.jsx(ne,{className:"bg-transparent border-0 pb-0",children:ke.jsx("h6",{className:"mb-0 fw-bold",children:"Profile Information"})}),ke.jsxs(J,{className:"text-center",children:[ke.jsx("div",{className:"mb-4",children:ke.jsxs("div",{className:"position-relative d-inline-block",children:[s?.profilePhoto?ke.jsx("img",{src:s.profilePhoto,alt:"Profile",className:"rounded-circle border shadow-sm",style:{width:"120px",height:"120px",objectFit:"cover",border:"4px solid var(--color-border-glass)"}}):ke.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center border shadow-sm",style:{width:"120px",height:"120px",backgroundColor:"var(--color-primary)",color:"white",border:"4px solid var(--color-border-glass)"},children:ke.jsx(b,{size:40})}),ke.jsx("button",{className:"btn btn-primary btn-sm rounded-circle position-absolute",style:{bottom:"0",right:"0",width:"32px",height:"32px",padding:"0"},onClick:()=>je(!0),title:"Change profile photo",children:ke.jsx(g,{size:14})})]})}),ke.jsx("h5",{className:"mb-1",children:s?.name||"User Name"}),ke.jsx("p",{className:"text-muted mb-3",children:s?.email}),ke.jsxs("div",{className:"d-flex justify-content-center gap-2 mb-3",children:[ke.jsx(H,{color:"success",className:"px-3 py-2",children:ke.jsxs("div",{className:"d-flex align-items-center gap-1",children:[ke.jsx("div",{className:"bg-light rounded-circle",style:{width:"8px",height:"8px"}}),"Online"]})}),ke.jsx(H,{color:"info",className:"px-3 py-2",children:"Free Account"})]}),ke.jsxs("div",{className:"text-center",children:[ke.jsxs("button",{className:"btn btn-outline-primary btn-sm me-2",onClick:()=>je(!0),children:[ke.jsx(D,{size:14,className:"me-1"}),"Edit Profile"]}),ke.jsxs("button",{className:"btn btn-success btn-sm",children:[ke.jsx(m,{size:14,className:"me-1"}),"Upgrade to Pro"]})]})]})]})}),ke.jsx(le,{lg:8,children:ke.jsxs(R,{className:"border-0 shadow-sm h-100",children:[ke.jsx(ne,{className:"bg-transparent border-0 pb-0",children:ke.jsx("h6",{className:"mb-0 fw-bold",children:"Account Details"})}),ke.jsxs(J,{children:[ke.jsxs(ae,{className:"g-3",children:[ke.jsx(le,{md:6,children:ke.jsxs("div",{className:"border rounded-3 p-3",children:[ke.jsxs("div",{className:"d-flex align-items-center gap-2 mb-2",children:[ke.jsx(b,{size:16,className:"text-primary"}),ke.jsx("span",{className:"fw-semibold small text-uppercase text-muted",children:"Full Name"})]}),ke.jsx("div",{className:"fw-medium",children:s?.name||"Not set"})]})}),ke.jsx(le,{md:6,children:ke.jsxs("div",{className:"border rounded-3 p-3",children:[ke.jsxs("div",{className:"d-flex align-items-center gap-2 mb-2",children:[ke.jsx($,{size:16,className:"text-primary"}),ke.jsx("span",{className:"fw-semibold small text-uppercase text-muted",children:"Email Address"})]}),ke.jsxs("div",{className:"fw-medium d-flex align-items-center gap-2",children:[s?.email,ke.jsx(H,{color:"success",size:"sm",children:"Verified"})]})]})}),ke.jsx(le,{md:6,children:ke.jsxs("div",{className:"border rounded-3 p-3",children:[ke.jsxs("div",{className:"d-flex align-items-center gap-2 mb-2",children:[ke.jsx(T,{size:16,className:"text-primary"}),ke.jsx("span",{className:"fw-semibold small text-uppercase text-muted",children:"Member Since"})]}),ke.jsx("div",{className:"fw-medium",children:(new Date).getFullYear()-1})]})}),ke.jsx(le,{md:6,children:ke.jsxs("div",{className:"border rounded-3 p-3",children:[ke.jsxs("div",{className:"d-flex align-items-center gap-2 mb-2",children:[ke.jsx(E,{size:16,className:"text-primary"}),ke.jsx("span",{className:"fw-semibold small text-uppercase text-muted",children:"Account Type"})]}),ke.jsx("div",{className:"fw-medium",children:"Free Account"})]})})]}),ke.jsxs("div",{className:"mt-4 p-3 bg-light rounded-3",children:[ke.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[ke.jsxs("div",{className:"d-flex align-items-center gap-2",children:[ke.jsx(re,{size:"sm",style:{width:"16px",height:"16px"}}),ke.jsx("span",{className:"fw-semibold small text-uppercase text-muted",children:"Storage Usage"})]}),ke.jsxs("span",{className:"small fw-medium",children:[Ns.storageUsedGB," GB / ",Ns.storageLimitGB," GB"]})]}),ke.jsx(re,{className:"mb-2",height:8,children:ke.jsx(oe,{value:Ns.storageUsed,color:Ns.storageUsed>80?"danger":Ns.storageUsed>60?"warning":"primary"})}),ke.jsxs("div",{className:"d-flex justify-content-between small text-muted",children:[ke.jsxs("span",{children:[Ns.totalFiles," files â€¢ ",Ns.totalFolders," folders"]}),ke.jsxs("span",{children:[Math.round(Ns.storageUsed),"% used"]})]})]}),ke.jsxs("div",{className:"mt-4",children:[ke.jsx("h6",{className:"fw-bold mb-3",children:"Quick Actions"}),ke.jsxs("div",{className:"row g-2",children:[ke.jsx("div",{className:"col-md-4",children:ke.jsxs("button",{className:"btn btn-outline-primary w-100 d-flex align-items-center justify-content-center gap-2 py-3",children:[ke.jsx(_,{size:16}),ke.jsx("span",{className:"small fw-semibold",children:"Account Settings"})]})}),ke.jsx("div",{className:"col-md-4",children:ke.jsxs("button",{className:"btn btn-outline-secondary w-100 d-flex align-items-center justify-content-center gap-2 py-3",children:[ke.jsx(P,{size:16}),ke.jsx("span",{className:"small fw-semibold",children:"Notifications"})]})}),ke.jsx("div",{className:"col-md-4",children:ke.jsxs("button",{className:"btn btn-outline-danger w-100 d-flex align-items-center justify-content-center gap-2 py-3",onClick:N,children:[ke.jsx(I,{size:16}),ke.jsx("span",{className:"small fw-semibold",children:"Sign Out"})]})})]})]})]})]})})]})]}):"storage"===ns?ke.jsxs("div",{className:"fade-in",children:[ke.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[ke.jsxs("div",{children:[ke.jsx("h4",{className:"mb-1 fw-bold",children:"All Folders"}),ke.jsx("p",{className:"text-muted mb-0",children:(()=>{const e=[...B||[],...v||[]].filter((e,s,t)=>{const i=t.findIndex(s=>ys(s)===ys(e))===s,a=!gs(ys(e),"folder");return i&&a});return`${e.length} folders â€¢ Browse all your folders in one place`})()})]}),ke.jsx("div",{className:"d-flex align-items-center gap-2",children:ke.jsx("button",{className:"btn btn-outline-primary btn-modern",onClick:()=>ue(!0),disabled:Qe,children:Qe?ke.jsxs(ke.Fragment,{children:[ke.jsx(Y,{size:"sm",className:"me-1"})," Creating..."]}):ke.jsxs(ke.Fragment,{children:[ke.jsx(A,{size:16,className:"me-1"})," New Folder"]})})})]}),(()=>{const e=[...B||[],...v||[]].filter((e,s,t)=>{const i=t.findIndex(s=>ys(s)===ys(e))===s,a=!gs(ys(e),"folder");return i&&a});return 0===e.length?ke.jsx("div",{className:"text-center py-5",children:ke.jsx(R,{className:"border-0 shadow-sm",children:ke.jsxs(J,{className:"text-center py-5",children:[ke.jsx(S,{size:48,className:"text-muted mb-3 opacity-50"}),ke.jsx("h6",{className:"fw-bold mb-2",children:"No folders yet"}),ke.jsx("p",{className:"text-muted mb-4",children:"Create your first folder to organize your files"}),ke.jsxs("button",{className:"btn btn-primary",onClick:()=>ue(!0),children:[ke.jsx(A,{size:16,className:"me-1"}),"Create Your First Folder"]})]})})}):ke.jsx("div",{className:"row g-3",children:e.map((e,s)=>ke.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6",children:ke.jsxs("div",{className:"folder-card p-3 rounded-3 border hover-lift hover-glow position-relative scale-in stagger-item",style:{animationDelay:50*s+"ms"},children:[ke.jsxs("div",{className:"d-flex align-items-center gap-3",role:"button",onClick:()=>_s(e),children:[ke.jsx("div",{className:"rounded-2 d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"48px",height:"48px",backgroundColor:"#e0e7ff",color:"#4f46e5"},children:ke.jsx(S,{size:24})}),ke.jsxs("div",{className:"flex-grow-1 min-width-0",children:[ke.jsxs("div",{className:"fw-semibold text-truncate mb-1",children:[e.name,(()=>{const s=Es(ys(e));return s>0?ke.jsxs("span",{className:"text-muted fw-normal ms-2",children:["(",s," item",1!==s?"s":"",")"]}):null})()]}),ke.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[ke.jsxs("div",{className:"d-flex flex-column",children:[(()=>{const s=Ts(ys(e)),t=As(ys(e));return s>0||t>0?ke.jsxs("small",{className:"text-muted",children:[s>0&&`${s} file${1!==s?"s":""}`,s>0&&t>0&&" â€¢ ",t>0&&`${t} folder${1!==t?"s":""}`]}):null})(),(()=>{const s=hs(ys(e));return s>0?ke.jsxs("small",{className:"text-muted fw-semibold",style:{color:"#059669",fontSize:"0.8rem"},children:["ðŸ“¦ ",$s(s)]}):null})()]}),e.locked&&ke.jsx(L,{size:12,className:"text-warning"})]})]})]}),ke.jsxs("div",{className:"folder-actions mt-3 d-flex gap-2 justify-content-center opacity-0",children:[ke.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:s=>{s.stopPropagation(),_s(e)},title:"Open folder",children:ke.jsx(c,{size:12})}),ke.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:s=>{s.stopPropagation(),fe(e)},title:"Edit folder",children:ke.jsx(D,{size:12})}),ke.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:s=>{s.stopPropagation(),Ds(ys(e))},title:"Delete folder",children:ke.jsx(h,{size:12})})]})]})},ys(e)))})})()]}):"photos"===ns?ke.jsxs("div",{className:"fade-in",children:[ke.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[ke.jsxs("div",{children:[ke.jsx("h4",{className:"mb-1 fw-bold",children:"Photos"}),ke.jsxs("p",{className:"text-muted mb-0",children:[G.filter(e=>e.type?.startsWith("image/")&&!gs(e._id||e.id,"file")).length," images"]})]}),ke.jsx("div",{className:"d-flex align-items-center gap-2",children:ke.jsxs("button",{className:"btn btn-outline-primary btn-modern",onClick:()=>ze.current&&ze.current.click(),children:[ke.jsx(l,{size:16,className:"me-1"})," Upload Photos"]})})]}),0===G.filter(e=>e.type?.startsWith("image/")&&!gs(e._id||e.id,"file")).length?ke.jsx("div",{className:"text-center py-5",children:ke.jsx(R,{className:"border-0 shadow-sm",children:ke.jsxs(J,{className:"text-center py-5",children:[ke.jsx(p,{size:48,className:"text-muted mb-3 opacity-50"}),ke.jsx("h6",{className:"fw-bold mb-2",children:"No photos yet"}),ke.jsx("p",{className:"text-muted mb-4",children:"Upload your first photos to see them here"}),ke.jsxs("button",{className:"btn btn-primary",onClick:()=>ze.current&&ze.current.click(),children:[ke.jsx(l,{size:16,className:"me-1"}),"Upload Photos"]})]})})}):ke.jsx("div",{className:"row g-3",children:G.filter(e=>e.type?.startsWith("image/")&&!gs(e._id||e.id,"file")).map((e,s)=>ke.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6",children:ke.jsx(R,{className:"border file-preview-card h-100 hover-lift hover-glow scale-in stagger-item",role:"button",onClick:()=>he(e),style:{animationDelay:50*s+"ms"},children:ke.jsxs(J,{className:"p-3",children:[ke.jsx("div",{className:"rounded-2 mb-3 d-flex align-items-center justify-content-center position-relative",style:{height:"180px",backgroundColor:"#f8f9fa"},children:ke.jsx("img",{src:e.url,alt:e.name,className:"img-fluid rounded-2",style:{maxHeight:"100%",maxWidth:"100%",objectFit:"cover"}})}),ke.jsxs("div",{className:"mb-3",children:[ke.jsx("div",{className:"fw-semibold text-truncate mb-1",title:e.name,children:e.name}),ke.jsx("div",{className:"text-muted small",children:e.size?`${(e.size/1048576).toFixed(1)} MB`:"0 MB"})]}),ke.jsx("div",{className:"d-flex align-items-center justify-content-between border-top pt-3",children:ke.jsxs("div",{className:"d-flex gap-2",children:[ke.jsx("button",{className:"btn btn-sm btn-outline-primary d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),he(e)},title:"Preview",children:ke.jsx(c,{size:14})}),ke.jsx("button",{className:"btn btn-sm btn-outline-secondary d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),Ps(e)},title:"Download",children:ke.jsx(d,{size:14})}),ke.jsx("button",{className:`btn btn-sm ${ms(e)?"btn-warning":"btn-outline-warning"} d-flex align-items-center gap-1`,onClick:s=>{s.stopPropagation(),ds(e)},title:ms(e)?"Remove from Favorites":"Add to Favorites",children:ke.jsx(m,{size:14,fill:ms(e)?"currentColor":"none"})}),ke.jsx("button",{className:"btn btn-sm btn-outline-danger d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),Is(e._id||e.id)},title:"Delete",children:ke.jsx(h,{size:14})})]})})]})})},e._id||e.id))})]}):"audio"===ns?ke.jsxs("div",{className:"fade-in",children:[ke.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[ke.jsxs("div",{children:[ke.jsx("h4",{className:"mb-1 fw-bold",children:"Audio Files"}),ke.jsxs("p",{className:"text-muted mb-0",children:[G.filter(e=>e.type?.startsWith("audio/")&&!gs(e._id||e.id,"file")).length," audio files"]})]}),ke.jsx("div",{className:"d-flex align-items-center gap-2",children:ke.jsxs("button",{className:"btn btn-outline-primary btn-modern",onClick:()=>ze.current&&ze.current.click(),children:[ke.jsx(l,{size:16,className:"me-1"})," Upload Audio"]})})]}),0===G.filter(e=>e.type?.startsWith("audio/")&&!gs(e._id||e.id,"file")).length?ke.jsx("div",{className:"text-center py-5",children:ke.jsx(R,{className:"border-0 shadow-sm",children:ke.jsxs(J,{className:"text-center py-5",children:[ke.jsx(u,{size:48,className:"text-muted mb-3 opacity-50"}),ke.jsx("h6",{className:"fw-bold mb-2",children:"No audio files yet"}),ke.jsx("p",{className:"text-muted mb-4",children:"Upload your first audio files to see them here"}),ke.jsxs("button",{className:"btn btn-primary",onClick:()=>ze.current&&ze.current.click(),children:[ke.jsx(l,{size:16,className:"me-1"}),"Upload Audio"]})]})})}):ke.jsx("div",{className:"row g-3",children:G.filter(e=>e.type?.startsWith("audio/")&&!gs(e._id||e.id,"file")).map((e,s)=>ke.jsx("div",{className:"col-xl-4 col-lg-6 col-md-6",children:ke.jsx(R,{className:"border file-preview-card h-100 hover-lift hover-glow scale-in stagger-item",role:"button",onClick:()=>he(e),style:{animationDelay:50*s+"ms"},children:ke.jsxs(J,{className:"p-3",children:[ke.jsx("div",{className:"rounded-2 mb-3 d-flex align-items-center justify-content-center position-relative",style:{height:"120px",backgroundColor:"#f8f9fa"},children:ke.jsx(u,{size:32,className:"text-primary"})}),ke.jsxs("div",{className:"mb-3",children:[ke.jsx("div",{className:"fw-semibold text-truncate mb-1",title:e.name,children:e.name}),ke.jsx("div",{className:"text-muted small",children:e.size?`${(e.size/1048576).toFixed(1)} MB`:"0 MB"})]}),ke.jsx("div",{className:"d-flex align-items-center justify-content-between border-top pt-3",children:ke.jsxs("div",{className:"d-flex gap-2",children:[ke.jsx("button",{className:"btn btn-sm btn-outline-primary d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),he(e)},title:"Preview",children:ke.jsx(c,{size:14})}),ke.jsx("button",{className:"btn btn-sm btn-outline-secondary d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),Ps(e)},title:"Download",children:ke.jsx(d,{size:14})}),ke.jsx("button",{className:`btn btn-sm ${ms(e)?"btn-warning":"btn-outline-warning"} d-flex align-items-center gap-1`,onClick:s=>{s.stopPropagation(),ds(e)},title:ms(e)?"Remove from Favorites":"Add to Favorites",children:ke.jsx(m,{size:14,fill:ms(e)?"currentColor":"none"})}),ke.jsx("button",{className:"btn btn-sm btn-outline-danger d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),Is(e._id||e.id)},title:"Delete",children:ke.jsx(h,{size:14})})]})})]})})},e._id||e.id))})]}):"documents"===ns?ke.jsxs("div",{className:"fade-in",children:[ke.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[ke.jsxs("div",{children:[ke.jsx("h4",{className:"mb-1 fw-bold",children:"Documents"}),ke.jsxs("p",{className:"text-muted mb-0",children:[G.filter(e=>(e.type?.includes("pdf")||e.type?.includes("doc")||e.type?.includes("text")||e.type?.includes("sheet")||e.type?.includes("presentation"))&&!gs(e._id||e.id,"file")).length," documents"]})]}),ke.jsx("div",{className:"d-flex align-items-center gap-2",children:ke.jsxs("button",{className:"btn btn-outline-primary btn-modern",onClick:()=>ze.current&&ze.current.click(),children:[ke.jsx(l,{size:16,className:"me-1"})," Upload Documents"]})})]}),0===G.filter(e=>(e.type?.includes("pdf")||e.type?.includes("doc")||e.type?.includes("text")||e.type?.includes("sheet")||e.type?.includes("presentation"))&&!gs(e._id||e.id,"file")).length?ke.jsx("div",{className:"text-center py-5",children:ke.jsx(R,{className:"border-0 shadow-sm",children:ke.jsxs(J,{className:"text-center py-5",children:[ke.jsx(f,{size:48,className:"text-muted mb-3 opacity-50"}),ke.jsx("h6",{className:"fw-bold mb-2",children:"No documents yet"}),ke.jsx("p",{className:"text-muted mb-4",children:"Upload your first documents to see them here"}),ke.jsxs("button",{className:"btn btn-primary",onClick:()=>ze.current&&ze.current.click(),children:[ke.jsx(l,{size:16,className:"me-1"}),"Upload Documents"]})]})})}):ke.jsx("div",{className:"row g-3",children:G.filter(e=>(e.type?.includes("pdf")||e.type?.includes("doc")||e.type?.includes("text")||e.type?.includes("sheet")||e.type?.includes("presentation"))&&!gs(e._id||e.id,"file")).map((e,s)=>ke.jsx("div",{className:"col-xl-4 col-lg-6 col-md-6",children:ke.jsx(R,{className:"border file-preview-card h-100 hover-lift hover-glow scale-in stagger-item",role:"button",onClick:()=>he(e),style:{animationDelay:50*s+"ms"},children:ke.jsxs(J,{className:"p-3",children:[ke.jsxs("div",{className:"rounded-2 mb-3 d-flex align-items-center justify-content-center position-relative",style:{height:"120px",backgroundColor:"#f8f9fa"},children:[ke.jsx(f,{size:32,className:"text-success"}),ke.jsx("div",{className:"position-absolute bottom-0 end-0 me-2 mb-2",children:ke.jsx("small",{className:"badge bg-success text-uppercase",children:e.name?.split(".").pop()||"DOC"})})]}),ke.jsxs("div",{className:"mb-3",children:[ke.jsx("div",{className:"fw-semibold text-truncate mb-1",title:e.name,children:e.name}),ke.jsx("div",{className:"text-muted small",children:e.size?`${(e.size/1048576).toFixed(1)} MB`:"0 MB"})]}),ke.jsx("div",{className:"d-flex align-items-center justify-content-between border-top pt-3",children:ke.jsxs("div",{className:"d-flex gap-2",children:[ke.jsx("button",{className:"btn btn-sm btn-outline-primary d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),he(e)},title:"Preview",children:ke.jsx(c,{size:14})}),ke.jsx("button",{className:"btn btn-sm btn-outline-secondary d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),Ps(e)},title:"Download",children:ke.jsx(d,{size:14})}),ke.jsx("button",{className:`btn btn-sm ${ms(e)?"btn-warning":"btn-outline-warning"} d-flex align-items-center gap-1`,onClick:s=>{s.stopPropagation(),ds(e)},title:ms(e)?"Remove from Favorites":"Add to Favorites",children:ke.jsx(m,{size:14,fill:ms(e)?"currentColor":"none"})}),ke.jsx("button",{className:"btn btn-sm btn-outline-danger d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),Is(e._id||e.id)},title:"Delete",children:ke.jsx(h,{size:14})})]})})]})})},e._id||e.id))})]}):"videos"===ns?ke.jsxs("div",{className:"fade-in",children:[ke.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[ke.jsxs("div",{children:[ke.jsx("h4",{className:"mb-1 fw-bold",children:"Videos"}),ke.jsxs("p",{className:"text-muted mb-0",children:[G.filter(e=>e.type?.startsWith("video/")&&!gs(e._id||e.id,"file")).length," videos"]})]}),ke.jsx("div",{className:"d-flex align-items-center gap-2",children:ke.jsxs("button",{className:"btn btn-outline-primary btn-modern",onClick:()=>ze.current&&ze.current.click(),children:[ke.jsx(l,{size:16,className:"me-1"})," Upload Videos"]})})]}),0===G.filter(e=>e.type?.startsWith("video/")&&!gs(e._id||e.id,"file")).length?ke.jsx("div",{className:"text-center py-5",children:ke.jsx(R,{className:"border-0 shadow-sm",children:ke.jsxs(J,{className:"text-center py-5",children:[ke.jsx(x,{size:48,className:"text-muted mb-3 opacity-50"}),ke.jsx("h6",{className:"fw-bold mb-2",children:"No videos yet"}),ke.jsx("p",{className:"text-muted mb-4",children:"Upload your first videos to see them here"}),ke.jsxs("button",{className:"btn btn-primary",onClick:()=>ze.current&&ze.current.click(),children:[ke.jsx(l,{size:16,className:"me-1"}),"Upload Videos"]})]})})}):ke.jsx("div",{className:"row g-3",children:G.filter(e=>e.type?.startsWith("video/")&&!gs(e._id||e.id,"file")).map((e,s)=>ke.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6",children:ke.jsx(R,{className:"border file-preview-card h-100 hover-lift hover-glow scale-in stagger-item",role:"button",onClick:()=>he(e),style:{animationDelay:50*s+"ms"},children:ke.jsxs(J,{className:"p-3",children:[ke.jsxs("div",{className:"rounded-2 mb-3 d-flex align-items-center justify-content-center position-relative",style:{height:"180px",backgroundColor:"#000"},children:[e.url?ke.jsx("video",{className:"w-100 h-100 rounded-2",style:{objectFit:"cover"},poster:e.thumbnail,children:ke.jsx("source",{src:e.url,type:e.type})}):ke.jsx(x,{size:32,className:"text-white"}),ke.jsx("div",{className:"position-absolute top-50 start-50 translate-middle",children:ke.jsx("div",{className:"bg-white bg-opacity-75 rounded-circle p-2",children:ke.jsx(x,{size:20,className:"text-dark"})})})]}),ke.jsxs("div",{className:"mb-3",children:[ke.jsx("div",{className:"fw-semibold text-truncate mb-1",title:e.name,children:e.name}),ke.jsx("div",{className:"text-muted small",children:e.size?`${(e.size/1048576).toFixed(1)} MB`:"0 MB"})]}),ke.jsx("div",{className:"d-flex align-items-center justify-content-between border-top pt-3",children:ke.jsxs("div",{className:"d-flex gap-2",children:[ke.jsx("button",{className:"btn btn-sm btn-outline-primary d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),he(e)},title:"Preview",children:ke.jsx(c,{size:14})}),ke.jsx("button",{className:"btn btn-sm btn-outline-secondary d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),Ps(e)},title:"Download",children:ke.jsx(d,{size:14})}),ke.jsx("button",{className:`btn btn-sm ${ms(e)?"btn-warning":"btn-outline-warning"} d-flex align-items-center gap-1`,onClick:s=>{s.stopPropagation(),ds(e)},title:ms(e)?"Remove from Favorites":"Add to Favorites",children:ke.jsx(m,{size:14,fill:ms(e)?"currentColor":"none"})}),ke.jsx("button",{className:"btn btn-sm btn-outline-danger d-flex align-items-center gap-1",onClick:s=>{s.stopPropagation(),Is(e._id||e.id)},title:"Delete",children:ke.jsx(h,{size:14})})]})})]})})},e._id||e.id))})]}):"trash"===ns?ke.jsx("div",{className:"fade-in",children:(()=>{const e=JSON.parse(localStorage.getItem("sfm_trash_items")||"[]"),s=new Date(Date.now()-6048e5),t=e.filter(e=>new Date(e.deletedAt)>s);return ke.jsxs(ke.Fragment,{children:[ke.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[ke.jsxs("div",{children:[ke.jsx("h4",{className:"mb-1 fw-bold",children:"Trash"}),ke.jsxs("p",{className:"text-muted mb-0",children:[t.length," items â€¢ Items are automatically deleted after 7 days"]})]}),ke.jsx("div",{className:"d-flex align-items-center gap-2",children:t.length>0&&ke.jsxs("button",{className:"btn btn-outline-danger btn-modern",onClick:()=>{Ue({show:!0,title:"Empty Trash",message:`Are you sure you want to permanently delete all ${t.length} items? This action cannot be undone.`,onConfirm:()=>{js("TRASH_EMPTY",{itemCount:t.length,itemNames:t.map(e=>e.name)}),localStorage.setItem("sfm_trash_items","[]"),we("Trash emptied successfully",{type:"info"}),rs("trash"),Ue({show:!1,title:"",message:"",onConfirm:null})}})},children:[ke.jsx(h,{size:16,className:"me-1"})," Empty Trash"]})})]}),0===t.length?ke.jsx("div",{className:"text-center py-5",children:ke.jsx(R,{className:"border-0 shadow-sm",children:ke.jsxs(J,{className:"text-center py-5",children:[ke.jsx(h,{size:48,className:"text-muted mb-3 opacity-50"}),ke.jsx("h6",{className:"fw-bold mb-2",children:"Trash is empty"}),ke.jsx("p",{className:"text-muted mb-4",children:"Deleted items will appear here and be automatically removed after 7 days"})]})})}):ke.jsx("div",{className:"row g-3",children:t.map((s,t)=>{const i=Math.ceil(7-(Date.now()-new Date(s.deletedAt))/864e5);return ke.jsx("div",{className:"col-xl-4 col-lg-6 col-md-6",children:ke.jsx(R,{className:"border file-preview-card h-100 hover-lift hover-glow scale-in stagger-item",style:{animationDelay:50*t+"ms"},children:ke.jsxs(J,{className:"p-3",children:[ke.jsxs("div",{className:"rounded-2 mb-3 d-flex align-items-center justify-content-center position-relative",style:{height:"120px",backgroundColor:"#f8f9fa"},children:["folder"===s.type?ke.jsx(S,{size:32,className:"text-primary"}):s.type?.startsWith("image/")&&s.url?ke.jsx("img",{src:s.url,alt:s.name,className:"img-fluid rounded-2",style:{maxHeight:"100%",maxWidth:"100%",objectFit:"cover"}}):ke.jsx(o,{size:32,className:"text-muted"}),ke.jsx("div",{className:"position-absolute top-0 end-0 m-2",children:ke.jsxs(H,{color:i<=1?"danger":i<=3?"warning":"info",className:"small",children:[i,"d left"]})})]}),ke.jsxs("div",{className:"mb-3",children:[ke.jsxs("div",{className:"fw-semibold text-truncate mb-1",title:s.name,children:[s.name,"folder"===s.type&&s.contentsInfo&&ke.jsxs("small",{className:"text-muted ms-2",children:["(",s.contentsInfo.totalItems," items)"]})]}),ke.jsxs("div",{className:"text-muted small",children:[ke.jsxs("div",{children:["Deleted: ",new Date(s.deletedAt).toLocaleDateString()]}),ke.jsxs("div",{children:["Type: ","folder"===s.type?"Folder":"File"]}),"folder"!==s.type&&s.size&&ke.jsxs("div",{children:["Size: ",(s.size/1048576).toFixed(1)," MB"]})]})]}),ke.jsxs("div",{className:"d-flex align-items-center justify-content-between border-top pt-3",children:[ke.jsxs("div",{className:"d-flex gap-2",children:[ke.jsxs("button",{className:"btn btn-sm btn-outline-success d-flex align-items-center gap-1",onClick:()=>(s=>{const t=e.filter(e=>e._id!==s._id&&e.id!==s.id);localStorage.setItem("sfm_trash_items",JSON.stringify(t)),js("TRASH_RESTORE",{itemName:s.name,itemId:s._id||s.id,itemType:s.type,originalLocation:s.originalLocation}),we(`"${s.name}" restored successfully`,{type:"success"}),rs("trash")})(s),title:"Restore Item",children:[ke.jsx(l,{size:14})," Restore"]}),ke.jsxs("button",{className:"btn btn-sm btn-outline-danger d-flex align-items-center gap-1",onClick:()=>(s=>{Ue({show:!0,title:"Permanent Delete",message:`Are you sure you want to permanently delete "${s.name}"? This action cannot be undone.`,onConfirm:()=>{const t=e.filter(e=>e._id!==s._id&&e.id!==s.id);localStorage.setItem("sfm_trash_items",JSON.stringify(t)),js("TRASH_PERMANENT_DELETE",{itemName:s.name,itemId:s._id||s.id,itemType:s.type,deletedFromTrash:!0}),we(`"${s.name}" permanently deleted`,{type:"info"}),rs("trash"),Ue({show:!1,title:"",message:"",onConfirm:null})}})})(s),title:"Delete Permanently",children:[ke.jsx(h,{size:14})," Delete"]})]}),ke.jsxs("small",{className:"fw-semibold "+(i<=1?"text-danger":i<=3?"text-warning":"text-muted"),children:[i," day",1!==i?"s":""," left"]})]})]})})},`${s._id||s.id}-${s.deletedAt}`)})})]})})()}):"dashboard"===ns?ke.jsxs("div",{className:"fade-in",children:[ke.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4 fade-in",children:[ke.jsxs("div",{className:"slide-in-left",children:[ke.jsx("h4",{className:"mb-1 fw-bold",children:"My Storage Dashboard"}),ke.jsxs("p",{className:"text-muted mb-0",children:[Ns.totalFiles||0," files â€¢ ",Ns.totalFolders||0," folders â€¢ Last updated: ",Ns.lastUpdated||"Loading..."]})]}),ke.jsxs("div",{className:"d-flex gap-3 slide-in-right",children:[ke.jsxs("div",{className:"text-center hover-lift stagger-item",children:[ke.jsx("div",{className:"h5 fw-bold mb-0 text-primary counter-animate",children:Ns.totalFiles||0}),ke.jsx("small",{className:"text-muted",children:"Total Files"})]}),ke.jsxs("div",{className:"text-center hover-lift stagger-item",children:[ke.jsx("div",{className:"h5 fw-bold mb-0 text-success counter-animate",children:Ns.totalFolders||0}),ke.jsx("small",{className:"text-muted",children:"Folders"})]}),ke.jsxs("div",{className:"text-center hover-lift stagger-item",children:[ke.jsx("div",{className:"h5 fw-bold mb-0 text-info counter-animate",children:Ns.recentFiles||0}),ke.jsx("small",{className:"text-muted",children:"Recent (24h)"})]})]})]}),ke.jsx(Ie,{files:G||[]}),Array.isArray(B)&&B.length>0&&ke.jsx("div",{className:"mb-4",children:ke.jsx(R,{className:"border-0 shadow-sm",children:ke.jsxs(J,{className:"p-0",children:[ke.jsx("div",{className:"p-4 border-bottom",children:ke.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[ke.jsx("h5",{className:"mb-0 fw-bold",children:"Folders"}),ke.jsx("div",{className:"d-flex align-items-center gap-2",children:ke.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>ue(!0),disabled:Qe,children:Qe?ke.jsxs(ke.Fragment,{children:[ke.jsx(Y,{size:"sm",className:"me-1"})," Creating..."]}):ke.jsxs(ke.Fragment,{children:[ke.jsx(U,{size:14,className:"me-1"})," Create new"]})})})]})}),ke.jsx("div",{className:"p-4",children:ke.jsxs("div",{className:"row g-3",children:[B.map((e,s)=>ke.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6",children:ke.jsxs("div",{className:"folder-card p-3 rounded-3 border hover-lift hover-glow position-relative scale-in stagger-item",style:{animationDelay:100*s+"ms"},children:[ke.jsxs("div",{className:"d-flex align-items-center gap-3",role:"button",onClick:()=>_s(e),children:[ke.jsx("div",{className:"rounded-2 d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"48px",height:"48px",backgroundColor:"#e0e7ff",color:"#4f46e5"},children:ke.jsx(S,{size:24})}),ke.jsxs("div",{className:"flex-grow-1 min-width-0",children:[ke.jsxs("div",{className:"fw-semibold text-truncate mb-1",children:[e.name,(()=>{const s=Es(ys(e));return s>0?ke.jsxs("span",{className:"text-muted fw-normal ms-2",children:["(",s," item",1!==s?"s":"",")"]}):null})()]}),ke.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[ke.jsxs("div",{className:"d-flex flex-column",children:[(()=>{const s=Ts(ys(e)),t=As(ys(e));return s>0||t>0?ke.jsxs("small",{className:"text-muted",children:[s>0&&`${s} file${1!==s?"s":""}`,s>0&&t>0&&" â€¢ ",t>0&&`${t} folder${1!==t?"s":""}`]}):null})(),(()=>{const s=hs(ys(e));return s>0?ke.jsxs("small",{className:"text-muted fw-semibold",style:{color:"#059669",fontSize:"0.8rem"},children:["ðŸ“¦ ",$s(s)]}):null})()]}),e.locked&&ke.jsx(L,{size:12,className:"text-warning"})]})]})]}),ke.jsxs("div",{className:"folder-actions mt-3 d-flex gap-2 justify-content-center opacity-0",children:[ke.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:s=>{s.stopPropagation(),_s(e)},title:"Open folder",children:ke.jsx(c,{size:12})}),ke.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:s=>{s.stopPropagation(),fe(e)},title:"Edit folder",children:ke.jsx(D,{size:12})}),ke.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:s=>{s.stopPropagation(),Ds(ys(e))},title:"Delete folder",children:ke.jsx(h,{size:12})})]})]})},ys(e))),ke.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6",children:ke.jsx("div",{className:"folder-card add-folder p-3 rounded-3 border d-flex align-items-center justify-content-center hover-lift bounce-in float",role:"button",onClick:()=>ue(!0),style:{minHeight:"80px",animationDelay:100*B.length+200+"ms"},children:ke.jsxs("div",{className:"text-center",children:[ke.jsx(U,{size:24,className:"text-muted mb-2"}),ke.jsx("div",{className:"small text-muted fw-medium",children:"Add Folder"})]})})})]})})]})})}),(!Array.isArray(B)||0===B.length)&&ke.jsx("div",{className:"mb-4",children:ke.jsx(R,{className:"border-0 shadow-sm",children:ke.jsxs(J,{className:"text-center py-5",children:[ke.jsx(S,{size:48,className:"text-muted mb-3 opacity-50"}),ke.jsx("h6",{className:"fw-bold mb-2",children:"No folders yet"}),ke.jsx("p",{className:"text-muted mb-4",children:"Create your first folder to organize your files"}),ke.jsxs("button",{className:"btn btn-primary",onClick:()=>ue(!0),children:[ke.jsx(A,{size:16,className:"me-1"}),"Create Your First Folder"]})]})})}),ke.jsxs("div",{className:"row g-4",children:[ke.jsx("div",{className:"col-xl-8 col-lg-7",children:ke.jsx(De,{files:G||[],onFileClick:he,onViewAll:()=>{},onUpload:()=>ze.current&&ze.current.click(),onFileDelete:Is,onToggleFavorite:ds,isFavorited:ms})}),ke.jsx("div",{className:"col-xl-4 col-lg-5",children:ke.jsxs("div",{className:"row g-4",children:[ke.jsx("div",{className:"col-12",children:ke.jsx($e,{files:G||[]})}),ke.jsx("div",{className:"col-12",children:ke.jsx(Te,{files:G||[]})})]})})]})]}):ke.jsxs("div",{className:"fade-in",children:[ke.jsx("nav",{className:"breadcrumb-modern mb-4",children:ke.jsxs("div",{className:"d-flex align-items-center gap-2",children:[ke.jsx("button",{className:"btn btn-link p-0 text-decoration-none",onClick:()=>q(null),children:"Home"}),ws.map((e,s)=>ke.jsxs(t.Fragment,{children:[ke.jsx("span",{className:"text-muted",children:"/"}),ke.jsx("button",{className:"btn btn-link p-0 text-decoration-none "+(s===ws.length-1?"text-primary fw-semibold":""),onClick:()=>s===ws.length-1?null:q(ys(e)),disabled:s===ws.length-1,children:e.name})]},ys(e)))]})}),ke.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-4",children:[ke.jsxs("div",{className:"d-flex align-items-center gap-3",children:[ke.jsx("h4",{className:"mb-0 fw-bold",children:vs?.name||"Folder"}),ke.jsxs("span",{className:"text-muted small",children:["(",zs.length+Fs.length," items)"]})]}),ke.jsxs("div",{className:"d-flex align-items-center gap-2",children:[ke.jsxs("button",{className:"btn btn-outline-primary btn-modern",onClick:()=>ze.current&&ze.current.click(),children:[ke.jsx(l,{size:16,className:"me-1"})," Upload"]}),ke.jsxs("button",{className:"btn btn-primary btn-modern",onClick:()=>ue(!0),children:[ke.jsx(A,{size:16,className:"me-1"})," New Folder"]}),ke.jsxs(ce,{children:[ke.jsx("button",{className:"btn btn-outline-secondary "+("grid"===ye?"active":""),onClick:()=>ve("grid"),children:ke.jsx(C,{size:16})}),ke.jsx("button",{className:"btn btn-outline-secondary "+("list"===ye?"active":""),onClick:()=>ve("list"),children:ke.jsx(O,{size:16})})]})]})]}),Array.isArray(Fs)&&Fs.length>0&&ke.jsxs("div",{className:"mb-5",children:[ke.jsx("h6",{className:"text-uppercase text-muted small mb-3 fw-semibold",children:"Folders"}),ke.jsx("div",{className:"grid"===ye?"row g-3":"list-group",children:Fs.map(e=>ke.jsx("div",{className:"grid"===ye?"col-md-4 col-lg-3":"",children:ke.jsx(_e,{folder:e,onClick:_s,onEdit:e=>fe(e),onDelete:e=>Ds(ys(e)),isLocked:e.locked,isUnlocked:Q.has(ys(e)),hasMembers:Math.random()>.5,fileCount:Ts(ys(e)),folderSize:hs(ys(e)),totalItems:Es(ys(e)),subfolderCount:As(ys(e))})},ys(e)))})]}),Array.isArray(zs)&&zs.length>0&&ke.jsxs("div",{children:[ke.jsx("h6",{className:"text-uppercase text-muted small mb-3 fw-semibold",children:"Files"}),ke.jsx("div",{className:"grid"===ye?"row g-3":"list-group",children:zs.map(e=>ke.jsx("div",{className:"grid"===ye?"col-md-4 col-lg-3":"list-group-item",children:ke.jsx(R,{className:"file-card "+("grid"===ye?"h-100":""),children:ke.jsxs(J,{className:"grid"===ye?"d-flex flex-column p-3":"d-flex align-items-center gap-3 p-3",children:[ke.jsxs("div",{className:"d-flex align-items-center gap-2 flex-grow-1",children:[ke.jsx(o,{className:"text-muted",size:20}),ke.jsxs("div",{className:"flex-grow-1 min-width-0",children:[ke.jsx("div",{className:"fw-semibold text-truncate",title:e.name,children:e.name}),ke.jsx("div",{className:"small text-muted",children:$s(e.size||0)})]})]}),ke.jsxs("div",{className:"grid"===ye?"mt-auto d-flex gap-2":"d-flex gap-2",children:[ke.jsx("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>he(e),title:"Preview file",children:ke.jsx(c,{size:14})}),ke.jsx("button",{className:"btn btn-outline-success btn-sm",onClick:()=>Ps(e),title:"Download file",children:ke.jsx(d,{size:14})}),ke.jsx("button",{className:"btn btn-sm "+(ms(e)?"btn-warning":"btn-outline-warning"),onClick:()=>ds(e),title:ms(e)?"Remove from Favorites":"Add to Favorites",children:ke.jsx(m,{size:14,fill:ms(e)?"currentColor":"none"})}),ke.jsx("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>Is(e._id||e.id),title:"Delete file",children:ke.jsx(h,{size:14})})]})]})})},e._id||e.id))})]}),0===zs.length&&0===Fs.length&&ke.jsxs("div",{className:"text-center py-5 text-muted",children:[ke.jsx(o,{size:48,className:"mb-3 opacity-50"}),ke.jsx("div",{className:"h5",children:"This folder is empty"}),ke.jsx("div",{children:"Upload files or create folders to get started"})]})]})]})]}),Z&&ke.jsx(We,{folder:Z,onUnlock:async(e="PIN")=>{const s=Z?._id||Z?.id,t=Z?.name;try{X(e=>new Set([...e,s])),await js("FOLDER_UNLOCK",{folderName:t,folderId:s,unlockMethod:e}),is(!0),de(null);const[i,a]=await Promise.all([fs(`/folders?parentId=${s}`),fs(`/files?folderId=${s}`)]);W(i||[]),V(a||[]),rs("folder"),q(s),we(`ðŸ”“ Unlocked "${t}" with ${e}`,{type:"success"})}catch(i){we(`Failed to open folder: ${i.message}`,{type:"error"})}finally{is(!1)}},onClose:()=>de(null),token:i,user:s}),me&&ke.jsx(Be,{file:me,onClose:()=>he(null)}),xe&&ke.jsx(Re,{onClose:()=>ue(!1),onCreate:(e,s)=>{(async()=>{try{Ye(!0),Se(!0),we("Creating folder...",{type:"info"});const t={name:e,parentId:K||null,locked:!!s,pinHash:s?btoa(`hashed_${s}_salted`):null},i=await fs("/folders",{method:"POST",body:JSON.stringify(t)});W(e=>[...e,i]),K||M(e=>[...e,i]),await js("FOLDER_CREATE",{folderName:e,isLocked:!!s,parentFolderId:K||"root",parentFolderName:vs?.name||"Root"}),we(`Folder "${e}" created successfully`,{type:"success"}),await bs()}catch(t){we("Failed to create folder: "+t.message,{type:"error"})}finally{Ye(!1),Se(!1)}})()}}),pe&&ke.jsx(Me,{folder:pe,onClose:()=>fe(null),onSave:({name:e,pin:s})=>{(async()=>{try{Se(!0);const t={name:e};s&&s.length>0?t.pinHash=btoa(`hashed_${s}_salted`):t.pinHash="";const i=await fs(`/folders/${ys(pe)}`,{method:"PATCH",body:JSON.stringify(t)});W(e=>e.map(e=>ys(e)===ys(pe)?i:e)),we("Folder updated",{type:"success"})}catch(t){we("Update folder failed: "+t.message,{type:"error"})}finally{Se(!1)}})()}}),ge&&ke.jsx(Ee,{user:s,token:i,onClose:()=>je(!1),onPhotoUpdate:e=>{y({profilePhoto:e})},showToast:we}),ke.jsx("div",{className:"fab d-grid gap-2",children:ke.jsxs(ee,{alignment:"end",direction:"dropup",children:[ke.jsx(se,{color:"primary",className:"rounded-circle shadow",style:{width:56,height:56,padding:0,display:"flex",alignItems:"center",justifyContent:"center"},children:ke.jsx(U,{})}),ke.jsxs(te,{children:[ke.jsx(ie,{onClick:()=>ue(!0),children:"New Folder"}),ke.jsx(ie,{onClick:()=>ze.current&&ze.current.click(),children:"Upload File"})]})]})}),ke.jsx(He,{show:es.show,folder:es.folder,contentsAnalysis:es.contentsAnalysis,onCancel:()=>ss({show:!1,folder:null,contentsAnalysis:null}),onConfirm:async()=>{const{folder:e}=es;let s;s="object"==typeof e&&null!==e?e._id||e.id:e,s=String(s);try{Se(!0),we("Moving folder to trash...",{type:"info"});const t=JSON.parse(localStorage.getItem("sfm_trash_items")||"[]"),{fileCount:i,subfolderCount:a}=es.contentsAnalysis,l={...e,_id:s,id:s,deletedAt:(new Date).toISOString(),type:"folder",originalLocation:e.parentId?`folder-${e.parentId}`:"root",contentsInfo:{fileCount:i,subfolderCount:a,totalItems:i+a}};t.push(l),localStorage.setItem("sfm_trash_items",JSON.stringify(t)),await fs(`/folders/${s}`,{method:"DELETE"}),W(e=>e.filter(e=>(e._id||e.id)!==s)),M(e=>e.filter(e=>(e._id||e.id)!==s)),V(e=>e.filter(e=>String(e.folderId)!==String(s))),String(K)===String(s)&&(q(null),rs("dashboard")),await js("FOLDER_DELETE",{folderName:e.name,folderId:s,isLocked:e.locked||!1,parentFolderId:e.parentId||"root",contentsInfo:{fileCount:i,subfolderCount:a,totalItems:i+a},movedToTrash:!0}),await bs();const n=i>0||a>0?` and all its contents (${i} files, ${a} subfolders)`:"";we(`Folder "${e.name}"${n} moved to trash`,{type:"success"})}catch(t){we(`Failed to move folder to trash: ${t.message}`,{type:"error"})}finally{Se(!1),ss({show:!1,folder:null,contentsAnalysis:null})}}}),ke.jsx(Je,{show:Pe.show,title:Pe.title,message:Pe.message,onCancel:()=>Ue({show:!1,title:"",message:"",onConfirm:null}),onConfirm:()=>{const e=Pe.onConfirm;e&&e()}})]})})}"serviceWorker"in navigator&&(window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{e.addEventListener("updatefound",()=>{const s=e.installing;s&&s.addEventListener("statechange",()=>{"installed"===s.state&&navigator.serviceWorker.controller})})}).catch(e=>{})}),navigator.serviceWorker.addEventListener("message",e=>{const{type:s,fileName:t,offline:i}=e.data})),we(document.getElementById("root")).render(ke.jsx(t.StrictMode,{children:ke.jsx(Pe,{children:ke.jsx(Ge,{})})}));
